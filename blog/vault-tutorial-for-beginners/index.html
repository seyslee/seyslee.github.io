<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Vault 튜토리얼 &#183; seyslee</title><meta name=title content="Vault 튜토리얼 &#183; seyslee"><meta name=description content="seyslee"><link rel=canonical href=https://seyslee.github.io/blog/vault-tutorial-for-beginners/><link type=text/css rel=stylesheet href=/css/main.bundle.min.4237a54696344545847852e66642dc3be0dbc6296c3890031b5dfb8c9aaf683fc56c227436ecf341b430c4c690554013087987403de93d86e94529f0f48a3ab8.css integrity="sha512-QjelRpY0RUWEeFLmZkLcO+DbxilsOJADG137jJqvaD/FbCJ0NuzzQbQwxMaQVUATCHmHQD3pPYbpRSnw9Io6uA=="><script type=text/javascript src=/js/appearance.min.12e98742cd283574d030a7fe55f29597df4ee214f7ff7075b4d19a64d046a602753c715295550be7899b661619cec89c679049d36c624681671a8013c1249896.js integrity="sha512-EumHQs0oNXTQMKf+VfKVl99O4hT3/3B1tNGaZNBGpgJ1PHFSlVUL54mbZhYZzsicZ5BJ02xiRoFnGoATwSSYlg=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9ae0a991bb442898e9bc60cf318b4de3ff878325ff3821625a5564b32b2f66aec0e7f7d0e00ca3ac7df59d9f01c18c88b6bdd213184f86ac9ce06d7bdffbadf8.js integrity="sha512-muCpkbtEKJjpvGDPMYtN4/+HgyX/OCFiWlVksysvZq7A5/fQ4AyjrH31nZ8BwYyItr3SExhPhqyc4G173/ut+A==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Vault 튜토리얼"><meta property="og:description" content="Hashicorp Vault를 사용해보는 간단한 튜토리얼. Vault의 인증정보를 사용해서 테라폼으로 EC2 인스턴스를 배포하는 법을 알아보겠습니다."><meta property="og:type" content="article"><meta property="og:url" content="https://seyslee.github.io/blog/vault-tutorial-for-beginners/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-06-14T21:51:10+09:00"><meta property="article:modified_time" content="2022-06-14T22:55:15+09:00"><meta property="og:site_name" content="seyslee"><meta name=twitter:card content="summary"><meta name=twitter:title content="Vault 튜토리얼"><meta name=twitter:description content="Hashicorp Vault를 사용해보는 간단한 튜토리얼. Vault의 인증정보를 사용해서 테라폼으로 EC2 인스턴스를 배포하는 법을 알아보겠습니다."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blogs","name":"Vault 튜토리얼","headline":"Vault 튜토리얼","description":"Hashicorp Vault를 사용해보는 간단한 튜토리얼. Vault의 인증정보를 사용해서 테라폼으로 EC2 인스턴스를 배포하는 법을 알아보겠습니다.","abstract":"개요 # Vault라는 솔루션이 어떤 건지 감이 안잡히는 분들을 위해 이 글을 작성합니다.","inLanguage":"en","url":"https:\/\/seyslee.github.io\/blog\/vault-tutorial-for-beginners\/","author":{"@type":"Person","name":"Younsung Lee"},"copyrightYear":"2022","dateCreated":"2022-06-14T21:51:10\u002b09:00","datePublished":"2022-06-14T21:51:10\u002b09:00","dateModified":"2022-06-14T22:55:15\u002b09:00","keywords":["terraform","vault"],"mainEntityOfPage":"true","wordCount":"1455"}]</script><meta name=author content="Younsung Lee"><link href=mailto:ivecloudblack@gmail.com rel=me><link href=https://github.com/seyslee rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>seyslee</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/ title=Blogs>post</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>tag</a></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Vault 튜토리얼</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-06-14 21:51:10 +0900 +0900">Jun 14, 2022</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2022-06-14 22:55:15 +0900 +0900">Updated: Jun 14, 2022</time></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#개요>개요</a></li><li><a href=#환경>환경</a></li><li><a href=#전제조건>전제조건</a></li><li><a href=#배경지식>배경지식</a></li><li><a href=#데모>데모</a><ul><li><a href=#vault-설치>Vault 설치</a></li><li><a href=#로컬-vault-서버-시작>로컬 Vault 서버 시작</a></li><li><a href=#시크릿-구성>시크릿 구성</a></li><li><a href=#테라폼-코드-작성>테라폼 코드 작성</a></li><li><a href=#테라폼-배포>테라폼 배포</a></li><li><a href=#실습환경-정리>실습환경 정리</a></li></ul></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><h2 id=개요 class="relative group">개요 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b0%9c%ec%9a%94 aria-label=Anchor>#</a></span></h2><p>Vault라는 솔루션이 어떤 건지 감이 안잡히는 분들을 위해 이 글을 작성합니다. 이 튜토리얼로 직접 실습해보면서 볼트에 대해 어렴풋이 이해할 수 있기를 바랍니다.</p><p>이 글에 작성된 실습 예제에서는 다음과 같은 내용을 다룹니다.</p><ul><li>로컬 환경에 vault를 설치하고 개발 서버를 구축합니다.</li><li>vault에 키를 생성하고 저장합니다.</li><li>테라폼으로 EC2 인스턴스를 배포할 때 Vault의 키를 가져오도록 설정하는 방법을 소개합니다.</li></ul><p> </p><h2 id=환경 class="relative group">환경 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%99%98%ea%b2%bd aria-label=Anchor>#</a></span></h2><ul><li><strong>OS</strong> : macOS Monterey 12.4</li><li><strong>Shell</strong> : zsh + oh-my-zsh</li><li>Homebrew 3.5.2</li></ul><p> </p><h2 id=전제조건 class="relative group">전제조건 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%a0%84%ec%a0%9c%ec%a1%b0%ea%b1%b4 aria-label=Anchor>#</a></span></h2><ul><li>macOS용 패키지 관리자인 brew가 설치되어 있어야 합니다.</li><li>테라폼을 실행할 AWS IAM의 Administrator 권한과 Access Key, Secret Key가 있어야 합니다.</li></ul><p> </p><h2 id=배경지식 class="relative group">배경지식 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%b0%b0%ea%b2%bd%ec%a7%80%ec%8b%9d aria-label=Anchor>#</a></span></h2><p>Vault는 HashiCorp 사가 개발한 크로스플랫폼 패스워드 및 인증 관리 시스템입니다. 공개되면 안되는 비밀번호, API 키, 토큰 등을 저장하고 관리합니다.</p><p>볼트의 장점은 다양한 Cloud Provider와 Secret 종류들을 중앙에서 제공할 수 있다는 점입니다.</p><p>아래는 볼트의 아키텍처입니다.</p><p><figure><img class="my-0 rounded-md" src=./0.png alt="Vault architecture"></figure></p><p>‘Manage Secrets and Protect Sensitive Data, Secure dynamic infrastructure across clouds and environments’ 라는 컨셉으로 다양하게 변화하는 Cloud 환경에서 민감하게 제어되어야 하는 Secrets (Token, 암호, 인증서, SSH Key 등)을 안전하게 보관하고 제어할 수 있도록 해주는 저장소 서비스라고 이해하면 될 듯 합니다.</p><p> </p><h2 id=데모 class="relative group">데모 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%8d%b0%eb%aa%a8 aria-label=Anchor>#</a></span></h2><h3 id=vault-설치 class="relative group">Vault 설치 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#vault-%ec%84%a4%ec%b9%98 aria-label=Anchor>#</a></span></h3><p>brew를 사용해서 최신 버전의 볼트를 로컬에 설치합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ brew install vault
</span></span></code></pre></div><p><code>vault</code> 명령어가 동작하는지 확인합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ vault version
</span></span><span class=line><span class=cl>Vault v1.10.1 <span class=o>(</span><span class=s1>&#39;e452e9b30a9c2c8adfa1611c26eb472090adc767+CHANGES&#39;</span><span class=o>)</span>
</span></span></code></pre></div><p> </p><h3 id=로컬-vault-서버-시작 class="relative group">로컬 Vault 서버 시작 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%a1%9c%ec%bb%ac-vault-%ec%84%9c%eb%b2%84-%ec%8b%9c%ec%9e%91 aria-label=Anchor>#</a></span></h3><p>개발용 Vault 서버를 로컬에 띄우겠습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ vault server -dev -dev-root-token-id<span class=o>=</span><span class=s2>&#34;environment&#34;</span>
</span></span></code></pre></div><p>정상 실행된 결과값은 아래와 같습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ vault server -dev -dev-root-token-id<span class=o>=</span><span class=s2>&#34;environment&#34;</span>
</span></span><span class=line><span class=cl><span class=o>==</span>&gt; Vault server configuration:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>             Api Address: http://127.0.0.1:8200
</span></span><span class=line><span class=cl>                     Cgo: disabled
</span></span><span class=line><span class=cl>         Cluster Address: https://127.0.0.1:8201
</span></span><span class=line><span class=cl>              Go Version: go1.18.1
</span></span><span class=line><span class=cl>              Listener 1: tcp <span class=o>(</span>addr: <span class=s2>&#34;127.0.0.1:8200&#34;</span>, cluster address: <span class=s2>&#34;127.0.0.1:8201&#34;</span>, max_request_duration: <span class=s2>&#34;1m30s&#34;</span>, max_request_size: <span class=s2>&#34;33554432&#34;</span>, tls: <span class=s2>&#34;disabled&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>               Log Level: info
</span></span><span class=line><span class=cl>                   Mlock: supported: false, enabled: <span class=nb>false</span>
</span></span><span class=line><span class=cl>           Recovery Mode: <span class=nb>false</span>
</span></span><span class=line><span class=cl>                 Storage: inmem
</span></span><span class=line><span class=cl>                 Version: Vault v1.10.1
</span></span><span class=line><span class=cl>             Version Sha: e452e9b30a9c2c8adfa1611c26eb472090adc767+CHANGES
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>==</span>&gt; Vault server started! Log data will stream in below:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.810+0900 <span class=o>[</span>INFO<span class=o>]</span>  proxy environment: <span class=nv>http_proxy</span><span class=o>=</span><span class=s2>&#34;&#34;</span> <span class=nv>https_proxy</span><span class=o>=</span><span class=s2>&#34;&#34;</span> <span class=nv>no_proxy</span><span class=o>=</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.810+0900 <span class=o>[</span>WARN<span class=o>]</span>  no <span class=sb>`</span>api_addr<span class=sb>`</span> value specified in config or in VAULT_API_ADDR<span class=p>;</span> falling back to detection <span class=k>if</span> possible, but this value should be manually <span class=nb>set</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.811+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: Initializing versionTimestamps <span class=k>for</span> core
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.811+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: security barrier not initialized
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.811+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: security barrier initialized: <span class=nv>stored</span><span class=o>=</span><span class=m>1</span> <span class=nv>shares</span><span class=o>=</span><span class=m>1</span> <span class=nv>threshold</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.811+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: post-unseal setup starting
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.813+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: loaded wrapping token key
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.813+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: Recorded vault version: vault <span class=nv>version</span><span class=o>=</span>1.10.1 upgrade <span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2022-06-14 12:41:45.813223 +0000 UTC&#34;</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.813+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: successfully setup plugin catalog: plugin-directory<span class=o>=</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.813+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: no mounts<span class=p>;</span> adding default mount table
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.813+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: successfully mounted backend: <span class=nv>type</span><span class=o>=</span>cubbyhole <span class=nv>path</span><span class=o>=</span>cubbyhole/
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.813+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: successfully mounted backend: <span class=nv>type</span><span class=o>=</span>system <span class=nv>path</span><span class=o>=</span>sys/
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.813+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: successfully mounted backend: <span class=nv>type</span><span class=o>=</span>identity <span class=nv>path</span><span class=o>=</span>identity/
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.814+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: successfully enabled credential backend: <span class=nv>type</span><span class=o>=</span>token <span class=nv>path</span><span class=o>=</span>token/
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.814+0900 <span class=o>[</span>INFO<span class=o>]</span>  rollback: starting rollback manager
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.815+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: restoring leases
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.815+0900 <span class=o>[</span>INFO<span class=o>]</span>  expiration: lease restore <span class=nb>complete</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.815+0900 <span class=o>[</span>INFO<span class=o>]</span>  identity: entities restored
</span></span><span class=line><span class=cl>2022-06-14T21:41:45.815+0900 <span class=o>[</span>INFO<span class=o>]</span>  identity: groups restored
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: post-unseal setup <span class=nb>complete</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: root token generated
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: pre-seal teardown starting
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  rollback: stopping rollback manager
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: pre-seal teardown <span class=nb>complete</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core.cluster-listener.tcp: starting listener: <span class=nv>listener_address</span><span class=o>=</span>127.0.0.1:8201
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core.cluster-listener: serving cluster requests: <span class=nv>cluster_listen_address</span><span class=o>=</span>127.0.0.1:8201
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: post-unseal setup starting
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: loaded wrapping token key
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: successfully setup plugin catalog: plugin-directory<span class=o>=</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: successfully mounted backend: <span class=nv>type</span><span class=o>=</span>system <span class=nv>path</span><span class=o>=</span>sys/
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: successfully mounted backend: <span class=nv>type</span><span class=o>=</span>identity <span class=nv>path</span><span class=o>=</span>identity/
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.020+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: successfully mounted backend: <span class=nv>type</span><span class=o>=</span>cubbyhole <span class=nv>path</span><span class=o>=</span>cubbyhole/
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.021+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: successfully enabled credential backend: <span class=nv>type</span><span class=o>=</span>token <span class=nv>path</span><span class=o>=</span>token/
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.021+0900 <span class=o>[</span>INFO<span class=o>]</span>  rollback: starting rollback manager
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.021+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: restoring leases
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.021+0900 <span class=o>[</span>INFO<span class=o>]</span>  identity: entities restored
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.021+0900 <span class=o>[</span>INFO<span class=o>]</span>  identity: groups restored
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.021+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: post-unseal setup <span class=nb>complete</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.021+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: vault is unsealed
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.022+0900 <span class=o>[</span>INFO<span class=o>]</span>  expiration: lease restore <span class=nb>complete</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.022+0900 <span class=o>[</span>INFO<span class=o>]</span>  expiration: revoked lease: <span class=nv>lease_id</span><span class=o>=</span>auth/token/root/ha0bd2026f65d879aa21234ba2754f71bf0a6a6cb3487e11bf95b579ba5f722b7
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.024+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: successful mount: <span class=nv>namespace</span><span class=o>=</span><span class=s2>&#34;&#34;</span> <span class=nv>path</span><span class=o>=</span>secret/ <span class=nv>type</span><span class=o>=</span>kv
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.035+0900 <span class=o>[</span>INFO<span class=o>]</span>  secrets.kv.kv_d2b4bf33: collecting keys to upgrade
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.035+0900 <span class=o>[</span>INFO<span class=o>]</span>  secrets.kv.kv_d2b4bf33: <span class=k>done</span> collecting keys: <span class=nv>num_keys</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>2022-06-14T21:41:46.035+0900 <span class=o>[</span>INFO<span class=o>]</span>  secrets.kv.kv_d2b4bf33: upgrading keys finished
</span></span><span class=line><span class=cl>WARNING! dev mode is enabled! In this mode, Vault runs entirely in-memory
</span></span><span class=line><span class=cl>and starts unsealed with a single unseal key. The root token is already
</span></span><span class=line><span class=cl>authenticated to the CLI, so you can immediately begin using Vault.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You may need to <span class=nb>set</span> the following environment variable:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    $ <span class=nb>export</span> <span class=nv>VAULT_ADDR</span><span class=o>=</span><span class=s1>&#39;http://127.0.0.1:8200&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The unseal key and root token are displayed below in <span class=k>case</span> you want to
</span></span><span class=line><span class=cl>seal/unseal the Vault or re-authenticate.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Unseal Key: 7EVjAVuu7sOtz6/9QBs0R652qYB8ErrH0ydQ4Ci+Vng<span class=o>=</span>
</span></span><span class=line><span class=cl>Root Token: environment
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Development mode should NOT be used in production installations!
</span></span></code></pre></div><p>마지막쯤에 출력된 <code>VAULT_ADDR</code>, <code>Unseal Key</code>, <code>Root Token</code> 값은 이후 Vault에 로그인하고 테라폼 배포할 때 사용하는 중요한 정보이기 때문에 따로 기록해둡니다.</p><p> </p><h3 id=시크릿-구성 class="relative group">시크릿 구성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%8b%9c%ed%81%ac%eb%a6%bf-%ea%b5%ac%ec%84%b1 aria-label=Anchor>#</a></span></h3><p>로컬 Vault 웹서버 주소인 <a href=http://127.0.0.1:8200>http://127.0.0.1:8200</a>으로 접속합니다.</p><p><figure><img class="my-0 rounded-md" src=./1.png alt="Vault main"></figure></p><ul><li><strong>Method</strong> : Token</li><li><strong>Token</strong> : environment</li></ul><p>토큰 값은 vault 서버 시작시에 출력되었던 <code>Root Token</code> 값을 입력합니다.</p><p><figure><img class="my-0 rounded-md" src=./2.png alt=Secret></figure></p><p>볼트에 로그인 되었습니다. Create secret 을 클릭합니다.</p><p><figure><img class="my-0 rounded-md" src=./3.png alt="Create secret"></figure></p><ul><li><code>aws_access_key_id</code></li><li><code>aws_secret_access_key</code></li><li><code>region</code></li></ul><p>위 3개의 Secret data를 입력하고 [Save] 버튼을 누릅니다.</p><p><figure><img class="my-0 rounded-md" src=./4.png alt="Secret 목록"></figure></p><p>Secret data가 새롭게 생성된 걸 확인할 수 있습니다.</p><p> </p><h3 id=테라폼-코드-작성 class="relative group">테라폼 코드 작성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%85%8c%eb%9d%bc%ed%8f%bc-%ec%bd%94%eb%93%9c-%ec%9e%91%ec%84%b1 aria-label=Anchor>#</a></span></h3><p>테라폼 배포할 코드는 다음과 같은 구조입니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ tree
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── instance.tf
</span></span><span class=line><span class=cl>├── provider.tf
</span></span><span class=line><span class=cl>├── variables.tf
</span></span><span class=line><span class=cl>└── versions.tf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>0</span> directories, <span class=m>4</span> files
</span></span></code></pre></div><p>테라폼 코드는 4개 파일로 분할 구성되어 있지만, 결국은 t3.mciro 타입의 EC2 인스턴스 1대를 배포한다는 내용입니다.</p><p>각 코드의 내용은 다음과 같습니다.<br>아래 내용들을 복사 붙여넣기 해서 한 디렉토리에 모아 담도록 합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>#</span> <span class=p>[</span><span class=mi>1</span><span class=err>/</span><span class=mi>4</span><span class=p>]</span> <span class=err>instance.tf</span>
</span></span><span class=line><span class=cl><span class=err>resource</span> <span class=s2>&#34;aws_instance&#34;</span> <span class=s2>&#34;example&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>ami</span>           <span class=err>=</span> <span class=err>var.AMIS[var.AWS_REGION]</span>
</span></span><span class=line><span class=cl>  <span class=err>instance_type</span> <span class=err>=</span> <span class=nt>&#34;t3.micro&#34;</span>
</span></span><span class=line><span class=cl>  <span class=err>provisioner</span> <span class=s2>&#34;local-exec&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>command</span> <span class=err>=</span> <span class=nt>&#34;echo ${aws_instance.example.private_ip} &gt;&gt; private_ips.txt&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=err>tags</span> <span class=err>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>Name</span>      <span class=err>=</span> <span class=nt>&#34;vault-test-ec2&#34;</span>
</span></span><span class=line><span class=cl>    <span class=err>ManagedBy</span> <span class=err>=</span> <span class=s2>&#34;terraform&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>output</span> <span class=s2>&#34;ip&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>value</span> <span class=err>=</span> <span class=err>aws_instance.example.public_ip</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>인스턴스 타입으로는 <code>t3.micro</code>를 사용하겠습니다.<br><code>output</code>으로 생성된 EC2의 Public IP가 출력되도록 설정했습니다.</p><p> </p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>#</span> <span class=p>[</span><span class=mi>2</span><span class=err>/</span><span class=mi>4</span><span class=p>]</span> <span class=err>provider.tf</span>
</span></span><span class=line><span class=cl><span class=err>terraform</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>required_providers</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>    <span class=err>aws</span> <span class=err>=</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>      <span class=err>source</span>  <span class=err>=</span> <span class=nt>&#34;hashicorp/aws&#34;</span>
</span></span><span class=line><span class=cl>      <span class=err>version</span> <span class=err>=</span> <span class=s2>&#34;= 4.7.0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=err>}</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>========================================</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>Vault</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=err>========================================</span>
</span></span><span class=line><span class=cl><span class=err>data</span> <span class=s2>&#34;vault_generic_secret&#34;</span> <span class=s2>&#34;aws_creds&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=err>path</span> <span class=err>=</span> <span class=nt>&#34;secret/aws&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>provider</span> <span class=s2>&#34;aws&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>region</span>     <span class=err>=</span> <span class=err>data.vault_generic_secret.aws_creds.data[</span><span class=nt>&#34;region&#34;</span><span class=err>]</span>
</span></span><span class=line><span class=cl>  <span class=err>access_key</span> <span class=err>=</span> <span class=err>data.vault_generic_secret.aws_creds.data</span><span class=p>[</span><span class=s2>&#34;aws_access_key_id&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=err>secret_key</span> <span class=err>=</span> <span class=err>data.vault_generic_secret.aws_creds.data</span><span class=p>[</span><span class=s2>&#34;aws_secret_access_key&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>테라폼으로 배포할 때 볼트에 들어있는 Access Key, Secret Key, Region을 사용할 예정입니다.</p><p> </p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>#</span> <span class=p>[</span><span class=mi>3</span><span class=err>/</span><span class=mi>4</span><span class=p>]</span> <span class=err>variables.tf</span>
</span></span><span class=line><span class=cl><span class=err>variable</span> <span class=s2>&#34;AWS_REGION&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>default</span> <span class=err>=</span> <span class=nt>&#34;ap-northeast-2&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>variable</span> <span class=s2>&#34;AMIS&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>type</span> <span class=err>=</span> <span class=err>map(string)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=err>#</span> <span class=err>[Tips]</span>
</span></span><span class=line><span class=cl>  <span class=err>#</span> <span class=err>AMI</span> <span class=err>ID</span> <span class=err>`ami-0cbec04a61be382d9`</span> <span class=err>means</span>
</span></span><span class=line><span class=cl>  <span class=err>#</span> <span class=err>Amazon</span> <span class=err>Linux</span> <span class=err>2</span> <span class=err>AMI</span> <span class=err>(HVM)</span> <span class=err>-</span> <span class=err>Kernel</span> <span class=err>5.10</span>
</span></span><span class=line><span class=cl>  <span class=err>#</span> <span class=err>SSD</span> <span class=err>Volume</span> <span class=err>Type</span> <span class=err>on</span> <span class=err>ap-northeast-2.</span>
</span></span><span class=line><span class=cl>  <span class=err>default</span> <span class=err>=</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>    <span class=err>ap-northeast-2</span> <span class=err>=</span> <span class=nt>&#34;ami-0cbec04a61be382d9&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></div><p>리소스를 배포할 리전은 <code>ap-northeast-2</code> 서울 리전이고, AMI 이미지는 Amazon Linux 2를 사용할 예정입니다.</p><p> </p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>#</span> <span class=p>[</span><span class=mi>4</span><span class=err>/</span><span class=mi>4</span><span class=p>]</span> <span class=err>versions.tf</span>
</span></span><span class=line><span class=cl><span class=err>terraform</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>required_version</span> <span class=err>=</span> <span class=nt>&#34;&gt;= 0.12&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p> </p><h3 id=테라폼-배포 class="relative group">테라폼 배포 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%85%8c%eb%9d%bc%ed%8f%bc-%eb%b0%b0%ed%8f%ac aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ terraform init
</span></span><span class=line><span class=cl>$ terraform plan
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ terraform plan
</span></span><span class=line><span class=cl>provider.vault.address
</span></span><span class=line><span class=cl>  URL of the root of the target Vault server.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Enter a value:
</span></span></code></pre></div><p><code>plan</code>을 실행하면 Vault 서버의 URL를 입력하라고 나옵니다.</p><p>처음에 볼트 서버를 생성할 때 출력되었던 <code>http://127.0.0.1:8200</code>을 입력합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ terraform plan
</span></span><span class=line><span class=cl>provider.vault.address
</span></span><span class=line><span class=cl>  URL of the root of the target Vault server.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Enter a value: http://127.0.0.1:8200
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>data.vault_generic_secret.aws_creds: Reading...
</span></span><span class=line><span class=cl>data.vault_generic_secret.aws_creds: Read <span class=nb>complete</span> after 0s <span class=o>[</span><span class=nv>id</span><span class=o>=</span>secret/aws<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Plan: <span class=m>1</span> to add, <span class=m>0</span> to change, <span class=m>0</span> to destroy.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Changes to Outputs:
</span></span><span class=line><span class=cl>  + <span class=nv>ip</span> <span class=o>=</span> <span class=o>(</span>known after apply<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>──────────────────────────────────────────────────────────────────────────────────────────────────────────
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Note: You didn<span class=s1>&#39;t use the -out option to save this plan, so Terraform can&#39;</span>t guarantee to take exactly these
</span></span><span class=line><span class=cl>actions <span class=k>if</span> you run <span class=s2>&#34;terraform apply&#34;</span> now.
</span></span></code></pre></div><p>1대의 EC2 인스턴스 리소스가 배포될 예정입니다.</p><p>plan을 확인했으니 이제 실제 배포를 실행합니다.<br>이번에도 동일하게 Vault 서버 URL <code>http://127.0.0.1:8200</code>을 입력합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ terraform apply -auto-approve
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Enter a value: http://127.0.0.1:8200
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>data.vault_generic_secret.aws_creds: Reading...
</span></span><span class=line><span class=cl>data.vault_generic_secret.aws_creds: Read <span class=nb>complete</span> after 0s <span class=o>[</span><span class=nv>id</span><span class=o>=</span>secret/aws<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Terraform used the selected providers to generate the following execution plan. Resource actions are
</span></span><span class=line><span class=cl>indicated with the following symbols:
</span></span><span class=line><span class=cl>  + create
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Terraform will perform the following actions:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># aws_instance.example will be created</span>
</span></span><span class=line><span class=cl>  + resource <span class=s2>&#34;aws_instance&#34;</span> <span class=s2>&#34;example&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      + <span class=nv>ami</span>                                  <span class=o>=</span> <span class=s2>&#34;ami-0cbec04a61be382d9&#34;</span>
</span></span><span class=line><span class=cl>      + <span class=nv>arn</span>                                  <span class=o>=</span> <span class=o>(</span>known after apply<span class=o>)</span>
</span></span><span class=line><span class=cl>      + <span class=nv>associate_public_ip_address</span>          <span class=o>=</span> <span class=o>(</span>known after apply<span class=o>)</span>
</span></span><span class=line><span class=cl>      + <span class=nv>availability_zone</span>                    <span class=o>=</span> <span class=o>(</span>known after apply<span class=o>)</span>
</span></span></code></pre></div><p>Vault에 들어있는 AWS Access Key, Secret Key를 사용해서 배포가 완료되었습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>aws_instance.example <span class=o>(</span>local-exec<span class=o>)</span>: Executing: <span class=o>[</span><span class=s2>&#34;/bin/sh&#34;</span> <span class=s2>&#34;-c&#34;</span> <span class=s2>&#34;echo 172.31.53.235 &gt;&gt; private_ips.txt&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>aws_instance.example: Creation <span class=nb>complete</span> after 13s <span class=o>[</span><span class=nv>id</span><span class=o>=</span>i-086fc61bd6b09a54b<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Apply complete! Resources: <span class=m>1</span> added, <span class=m>0</span> changed, <span class=m>0</span> destroyed.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Outputs:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>ip</span> <span class=o>=</span> <span class=s2>&#34;3.36.46.71&#34;</span>
</span></span></code></pre></div><p>1개의 리소스가 배포 완료되었습니다.<br>마지막에는 출력값으로 생성한 EC2의 Public IP가 나오는 걸 확인할 수 있습니다.</p><p> </p><h3 id=실습환경-정리 class="relative group">실습환경 정리 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%8b%a4%ec%8a%b5%ed%99%98%ea%b2%bd-%ec%a0%95%eb%a6%ac aria-label=Anchor>#</a></span></h3><h4 id=테라폼-삭제 class="relative group">테라폼 삭제 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%85%8c%eb%9d%bc%ed%8f%bc-%ec%82%ad%ec%a0%9c aria-label=Anchor>#</a></span></h4><p>실습이 끝났습니다.<br>테라폼으로 생성한 EC2 인스턴스를 삭제합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ terraform destroy
</span></span><span class=line><span class=cl>provider.vault.address
</span></span><span class=line><span class=cl>  URL of the root of the target Vault server.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Enter a value: http://127.0.0.1:8200
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>data.vault_generic_secret.aws_creds: Reading...
</span></span><span class=line><span class=cl>data.vault_generic_secret.aws_creds: Read <span class=nb>complete</span> after 0s <span class=o>[</span><span class=nv>id</span><span class=o>=</span>secret/aws<span class=o>]</span>
</span></span><span class=line><span class=cl>aws_instance.example: Refreshing state... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>i-074398431097768c9<span class=o>]</span>
</span></span></code></pre></div><p>중간에 Vault Server의 URL인 <code>http://127.0.0.1:8200</code>을 입력합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>provider.vault.address
</span></span><span class=line><span class=cl>  URL of the root of the target Vault server.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Enter a value: http://127.0.0.1:8200
</span></span></code></pre></div><p>정말 삭제를 실행할 건지 묻는데 <code>yes</code>를 입력합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ terraform destroy
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Do you really want to destroy all resources?
</span></span><span class=line><span class=cl>  Terraform will destroy all your managed infrastructure, as shown above.
</span></span><span class=line><span class=cl>  There is no undo. Only <span class=s1>&#39;yes&#39;</span> will be accepted to confirm.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Enter a value: yes
</span></span></code></pre></div><p>50초 후 EC2 인스턴스 1대가 삭제되었습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>aws_instance.example: Destroying... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>i-074398431097768c9<span class=o>]</span>
</span></span><span class=line><span class=cl>aws_instance.example: Still destroying... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>i-074398431097768c9, 10s elapsed<span class=o>]</span>
</span></span><span class=line><span class=cl>aws_instance.example: Still destroying... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>i-074398431097768c9, 20s elapsed<span class=o>]</span>
</span></span><span class=line><span class=cl>aws_instance.example: Still destroying... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>i-074398431097768c9, 30s elapsed<span class=o>]</span>
</span></span><span class=line><span class=cl>aws_instance.example: Still destroying... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>i-074398431097768c9, 40s elapsed<span class=o>]</span>
</span></span><span class=line><span class=cl>aws_instance.example: Still destroying... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>i-074398431097768c9, 50s elapsed<span class=o>]</span>
</span></span><span class=line><span class=cl>aws_instance.example: Destruction <span class=nb>complete</span> after 50s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Destroy complete! Resources: <span class=m>1</span> destroyed.
</span></span></code></pre></div><p> </p><h4 id=vault-서버-종료 class="relative group">Vault 서버 종료 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#vault-%ec%84%9c%eb%b2%84-%ec%a2%85%eb%a3%8c aria-label=Anchor>#</a></span></h4><p>이후 터미널로 돌아와서 개발용 볼트 서버도 Ctrl + C 키를 눌러서 중지하도록 합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Unseal Key: 7EVjAVuu7sOtz6/9QBs0R652qYB8ErrH0ydQ4Ci+Vng<span class=o>=</span>
</span></span><span class=line><span class=cl>Root Token: environment
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Development mode should NOT be used in production installations!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b^C<span class=o>==</span>&gt; Vault shutdown triggered
</span></span><span class=line><span class=cl>2022-06-14T22:43:57.088+0900 <span class=o>[</span>INFO<span class=o>]</span>  core: marked as sealed
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div><p>이상으로 Vault 튜토리얼을 마치겠습니다.</p></div></section><footer class="pt-8 max-w-prose print:hidden"><script src=https://utteranc.es/client.js repo=seyslee/seyslee.github.io issue-term=pathname label=blog-comment theme=github-dark crossorigin=anonymous async></script></footer></article></main><footer class="py-10 print:hidden"><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Younsung Lee</p></div></div></footer></div></body></html>