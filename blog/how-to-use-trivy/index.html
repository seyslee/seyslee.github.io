<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>trivy로 컨테이너 취약점 스캔 &#183; seyslee</title><meta name=title content="trivy로 컨테이너 취약점 스캔 &#183; seyslee"><meta name=description content="seyslee"><link rel=canonical href=https://seyslee.github.io/blog/how-to-use-trivy/><link type=text/css rel=stylesheet href=/css/main.bundle.min.fff8ff4cdbe2bf80930c53b6e47a6d9826b914a8623246481ff09ff52ea48fcfb403d9ba1dc7bbc800a7ecb15298c468838a661dd8ebb3e9f46fdca239b38a30.css integrity="sha512-//j/TNviv4CTDFO25HptmCa5FKhiMkZIH/Cf9S6kj8+0A9m6Hce7yACn7LFSmMRog4pmHdjrs+n0b9yiObOKMA=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9947db70e5b36e741e53f8531bd734741b3fc7a688f7b5d749fc5433c48efc252f47bdf44e471570a550fc051b87712799014040e6349b38d64448b94e84e45a.js integrity="sha512-mUfbcOWzbnQeU/hTG9c0dBs/x6aI97XXSfxUM8SO/CUvR730TkcVcKVQ/AUbh3EnmQFAQOY0mzjWREi5ToTkWg==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="trivy로 컨테이너 취약점 스캔"><meta property="og:description" content="trivy를 사용해서 컨테이너 취약점을 찾아보는 방법을 소개합니다"><meta property="og:type" content="article"><meta property="og:url" content="https://seyslee.github.io/blog/how-to-use-trivy/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-06-22T00:04:12+09:00"><meta property="article:modified_time" content="2022-06-22T00:04:22+09:00"><meta property="og:site_name" content="seyslee"><meta name=twitter:card content="summary"><meta name=twitter:title content="trivy로 컨테이너 취약점 스캔"><meta name=twitter:description content="trivy를 사용해서 컨테이너 취약점을 찾아보는 방법을 소개합니다"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blogs","name":"trivy로 컨테이너 취약점 스캔","headline":"trivy로 컨테이너 취약점 스캔","description":"trivy를 사용해서 컨테이너 취약점을 찾아보는 방법을 소개합니다","abstract":"개요 # trivy는 사용 편의성이 뛰어나고 성능이 좋은 오픈소스 취약점 스캐너입니다.","inLanguage":"en","url":"https:\/\/seyslee.github.io\/blog\/how-to-use-trivy\/","author":{"@type":"Person","name":"Younsung Lee"},"copyrightYear":"2022","dateCreated":"2022-06-22T00:04:12\u002b09:00","datePublished":"2022-06-22T00:04:12\u002b09:00","dateModified":"2022-06-22T00:04:22\u002b09:00","keywords":["security","container"],"mainEntityOfPage":"true","wordCount":"647"}]</script><meta name=author content="Younsung Lee"><link href=mailto:ivecloudblack@gmail.com rel=me><link href=https://github.com/seyslee rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><nav class="flex justify-between"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>seyslee</a></div><ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row"><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/ title=Blogs>post</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>tag</a></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">trivy로 컨테이너 취약점 스캔</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-06-22 00:04:12 +0900 +0900">Jun 22, 2022</time></div><div class="my-1 text-xs text-neutral-500 dark:text-neutral-400"><a href=/tags/security/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">security</a>
<a href=/tags/container/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">container</a></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#개요>개요</a></li><li><a href=#환경>환경</a></li><li><a href=#설치>설치</a></li><li><a href=#사용법>사용법</a><ul><li><a href=#컨테이너-취약점-스캔>컨테이너 취약점 스캔</a></li></ul></li><li><a href=#참고자료>참고자료</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><h2 id=개요 class="relative group">개요 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b0%9c%ec%9a%94 aria-label=Anchor>#</a></span></h2><p>trivy는 사용 편의성이 뛰어나고 성능이 좋은 오픈소스 취약점 스캐너입니다.<br>비슷한 소프트웨어로는 <code>clair</code> 가 있습니다.</p><p>Amazon Linux 2의 ALSA 취약점 데이터 소스도 제공합니다.<br>trivy에서 제공하는 모든 OS 관련 데이터 소스는 <a href=https://aquasecurity.github.io/trivy/v0.29.1/docs/vulnerability/detection/data-source/>공식문서</a>에서 확인할 수 있습니다.</p><p><figure><img class="my-0 rounded-md" src=./1.png alt="Data source list"></figure></p><p>trivy가 분석한 취약점은 ECR의 취약점 분석 결과와 동일하다고 보면 됩니다.</p><p>차이점은 Amazon ECR의 취약점 스캐닝은 ALAS라는 자체 취약점 코드로 별도 관리합니다. 사실 ALAS 취약점은 여러개(1개 이상)의 CVE<sup>Common Vulnerabilities and Exposures</sup> 취약점으로 구성됩니다.<br>trivy는 CVE를 분석해서 보여줍니다.</p><p><figure><img class="my-0 rounded-md" src=./2.png alt=ALAS></figure></p><p> </p><h2 id=환경 class="relative group">환경 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%99%98%ea%b2%bd aria-label=Anchor>#</a></span></h2><ul><li><strong>OS</strong> : macOS Monterey 12.4 (M1 Pro)</li><li><strong>Shell</strong> : zsh + oh-my-zsh</li><li><strong>패키지 관리자</strong> : Homebrew 3.5.2</li><li><strong>trivy 0.29.1</strong></li></ul><p> </p><h2 id=설치 class="relative group">설치 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%84%a4%ec%b9%98 aria-label=Anchor>#</a></span></h2><p>macOS용 패키지 관리자인 brew를 사용해서 쉽게 설치 가능합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ brew install aquasecurity/trivy/trivy
</span></span></code></pre></div><p>설치 후 <code>trivy</code>의 버전을 확인합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ trivy version
</span></span><span class=line><span class=cl>Version: 0.29.1
</span></span><span class=line><span class=cl>Vulnerability DB:
</span></span><span class=line><span class=cl>  Version: <span class=m>2</span>
</span></span><span class=line><span class=cl>  UpdatedAt: 2022-06-16 06:06:28.171512256 +0000 UTC
</span></span><span class=line><span class=cl>  NextUpdate: 2022-06-16 12:06:28.171511856 +0000 UTC
</span></span><span class=line><span class=cl>  DownloadedAt: 2022-06-16 07:07:50.248157 +0000 UTC
</span></span></code></pre></div><p> </p><h2 id=사용법 class="relative group">사용법 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%82%ac%ec%9a%a9%eb%b2%95 aria-label=Anchor>#</a></span></h2><h3 id=컨테이너-취약점-스캔 class="relative group">컨테이너 취약점 스캔 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%bb%a8%ed%85%8c%ec%9d%b4%eb%84%88-%ec%b7%a8%ec%95%bd%ec%a0%90-%ec%8a%a4%ec%ba%94 aria-label=Anchor>#</a></span></h3><p>Public Registry에 업로드된 컨테이너와 기존에 운영중이던 컨테이너 모두 취약점 분석이 가능합니다.</p><p><strong>취약점 레벨 정하기</strong><br><code>--severity</code> 옵션으로 취약점 레벨을 정할 수 있습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ trivy image --severity <span class=s2>&#34;LEVELS&#34;</span> PUBLIC_REPO_URL
</span></span></code></pre></div><p> </p><p><strong>취약점 결과를 별도 파일로 저장</strong><br><code>--output</code> 옵션을 사용해서 취약점 스캐닝 결과를 별도 파일로 저장할 수 있습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ trivy image --severity HIGH,CRITICAL <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--output ./ebs-csi-driver.txt <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>amazon/aws-ebs-csi-driver:v1.5.1
</span></span></code></pre></div><p> </p><p><strong>취약점 스캔 명령어 예시</strong><br>인터넷만 연결되어 있다면 모든 컨테이너 이미지를 다운받아와서 trivy가 취약점을 자동 분석할 수 있습니다.</p><pre tabindex=0><code>$ trivy image alpine:latest
...
alpine:latest (alpine 3.16.0)

Total: 0 (UNKNOWN: 0, LOW: 0, MEDIUM: 0, HIGH: 0, CRITICAL: 0)
</code></pre><p> </p><p><strong>취약점 스캔 결과 예시</strong><br>취약점 스캐닝 결과는 다음과 같이 나옵니다.<br>스캔 대상인 <code>amazon/aws-ebs-csi-driver:v1.5.1</code> 이미지는 Public ECR에 업로드된 컨테이너 이미지입니다.<br>해당 이미지는 Amazon Web Services에서 공식 제공하고 있습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ trivy image --severity <span class=s2>&#34;HIGH,CRITICAL&#34;</span> amazon/aws-ebs-csi-driver:v1.5.1
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>amazon/aws-ebs-csi-driver:v1.5.1 <span class=o>(</span>amazon <span class=m>2</span> <span class=o>(</span>Karoo<span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Total: <span class=m>8</span> <span class=o>(</span>HIGH: 7, CRITICAL: 1<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌────────────────┬────────────────┬──────────┬────────────────────────┬───────────────────────┬────────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│    Library     │ Vulnerability  │ Severity │   Installed Version    │     Fixed Version     │                           Title                            │
</span></span><span class=line><span class=cl>├────────────────┼────────────────┼──────────┼────────────────────────┼───────────────────────┼────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ cyrus-sasl-lib │ CVE-2022-24407 │ HIGH     │ 2.1.26-23.amzn2        │ 2.1.26-24.amzn2       │ cyrus-sasl: failure to properly escape SQL input allows an │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ attacker to execute...                                     │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ https://avd.aquasec.com/nvd/cve-2022-24407                 │
</span></span><span class=line><span class=cl>├────────────────┼────────────────┼──────────┼────────────────────────┼───────────────────────┼────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ expat          │ CVE-2022-25235 │ CRITICAL │ 2.1.0-12.amzn2         │ 2.1.0-12.amzn2.0.3    │ expat: Malformed 2- and 3-byte UTF-8 sequences can lead to │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ arbitrary code...                                          │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ https://avd.aquasec.com/nvd/cve-2022-25235                 │
</span></span><span class=line><span class=cl>│                ├────────────────┼──────────┤                        │                       ├────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│                │ CVE-2022-25236 │ HIGH     │                        │                       │ expat: Namespace-separator characters in <span class=s2>&#34;xmlns[:prefix]&#34;</span>  │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ attribute values can lead to arbitrary code...             │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ https://avd.aquasec.com/nvd/cve-2022-25236                 │
</span></span><span class=line><span class=cl>├────────────────┼────────────────┼──────────┼────────────────────────┼───────────────────────┼────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ expat          │ CVE-2022-25315 │ HIGH     │ 2.1.0-12.amzn2         │ 2.1.0-12.amzn2.0.2    │ expat: Integer overflow in storeRawNames<span class=o>()</span>                 │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ https://avd.aquasec.com/nvd/cve-2022-25315                 │
</span></span><span class=line><span class=cl>├────────────────┼────────────────┤          ├────────────────────────┼───────────────────────┼────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ gzip           │ CVE-2022-1271  │          │ 1.5-10.amzn2           │ 1.5-10.amzn2.0.1      │ gzip: arbitrary-file-write vulnerability                   │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ https://avd.aquasec.com/nvd/cve-2022-1271                  │
</span></span><span class=line><span class=cl>├────────────────┼────────────────┼──────────┼────────────────────────┼───────────────────────┼────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ openssl-libs   │ CVE-2022-0778  │ HIGH     │ 1:1.0.2k-19.amzn2.0.10 │ 1:1.0.2k-24.amzn2.0.2 │ openssl: Infinite loop in BN_mod_sqrt<span class=o>()</span> reachable when     │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ parsing certificates                                       │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ https://avd.aquasec.com/nvd/cve-2022-0778                  │
</span></span><span class=line><span class=cl>├────────────────┼────────────────┼──────────┼────────────────────────┼───────────────────────┼────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ xz-libs        │ CVE-2022-1271  │ HIGH     │ 5.2.2-1.amzn2.0.2      │ 5.2.2-1.amzn2.0.3     │ gzip: arbitrary-file-write vulnerability                   │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ https://avd.aquasec.com/nvd/cve-2022-1271                  │
</span></span><span class=line><span class=cl>├────────────────┼────────────────┼──────────┼────────────────────────┼───────────────────────┼────────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ zlib           │ CVE-2018-25032 │ HIGH     │ 1.2.7-18.amzn2         │ 1.2.7-19.amzn2.0.1    │ zlib: A flaw found in zlib when compressing <span class=o>(</span>not           │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ decompressing<span class=o>)</span> certain inputs...                           │
</span></span><span class=line><span class=cl>│                │                │          │                        │                       │ https://avd.aquasec.com/nvd/cve-2018-25032                 │
</span></span><span class=line><span class=cl>└────────────────┴────────────────┴──────────┴────────────────────────┴───────────────────────┴────────────────────────────────────────────────────────────┘
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>usr/bin/aws-ebs-csi-driver <span class=o>(</span>gobinary<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Total: <span class=m>1</span> <span class=o>(</span>HIGH: 1, CRITICAL: 0<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>┌───────────────────┬────────────────┬──────────┬───────────────────┬──────────────────────────────────┬────────────────────────────────────────────────────────┐
</span></span><span class=line><span class=cl>│      Library      │ Vulnerability  │ Severity │ Installed Version │          Fixed Version           │                         Title                          │
</span></span><span class=line><span class=cl>├───────────────────┼────────────────┼──────────┼───────────────────┼──────────────────────────────────┼────────────────────────────────────────────────────────┤
</span></span><span class=line><span class=cl>│ k8s.io/kubernetes │ CVE-2021-25741 │ HIGH     │ v1.21.0           │ 1.19.15, 1.20.11, 1.21.5, 1.22.2 │ kubernetes: Symlink exchange can allow host filesystem │
</span></span><span class=line><span class=cl>│                   │                │          │                   │                                  │ access                                                 │
</span></span><span class=line><span class=cl>│                   │                │          │                   │                                  │ https://avd.aquasec.com/nvd/cve-2021-25741             │
</span></span><span class=line><span class=cl>└───────────────────┴────────────────┴──────────┴───────────────────┴──────────────────────────────────┴────────────────────────────────────────────────────────┘
</span></span></code></pre></div><p> </p><h2 id=참고자료 class="relative group">참고자료 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%b0%b8%ea%b3%a0%ec%9e%90%eb%a3%8c aria-label=Anchor>#</a></span></h2><p><a href=https://aquasecurity.github.io/trivy/v0.29.1/>trivy 공식문서</a><br>trivy는 공식문서도 디테일하게 작성되어 있고, 애초에 사용 난이도도 쉬워서 부담없이 사용할 수 있다는 게 장점인 툴입니다.</p></div></section><footer class="pt-8 max-w-prose print:hidden"><script src=https://utteranc.es/client.js repo=seyslee/seyslee.github.io issue-term=pathname label=blog-comment theme=github-dark crossorigin=anonymous async></script></footer></article></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Younsung Lee</p></div></div></footer></div></body></html>