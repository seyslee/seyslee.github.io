<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Jenkins와 Slack webhook 연동 &#183; seyslee</title><meta name=title content="Jenkins와 Slack webhook 연동 &#183; seyslee"><meta name=description content="seyslee"><link rel=canonical href=https://seyslee.github.io/blog/slack-notifications-in-jenkins/><link type=text/css rel=stylesheet href=/css/main.bundle.min.4237a54696344545847852e66642dc3be0dbc6296c3890031b5dfb8c9aaf683fc56c227436ecf341b430c4c690554013087987403de93d86e94529f0f48a3ab8.css integrity="sha512-QjelRpY0RUWEeFLmZkLcO+DbxilsOJADG137jJqvaD/FbCJ0NuzzQbQwxMaQVUATCHmHQD3pPYbpRSnw9Io6uA=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9947db70e5b36e741e53f8531bd734741b3fc7a688f7b5d749fc5433c48efc252f47bdf44e471570a550fc051b87712799014040e6349b38d64448b94e84e45a.js integrity="sha512-mUfbcOWzbnQeU/hTG9c0dBs/x6aI97XXSfxUM8SO/CUvR730TkcVcKVQ/AUbh3EnmQFAQOY0mzjWREi5ToTkWg==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Jenkins와 Slack webhook 연동"><meta property="og:description" content="Jenkins 서버와 slack inbound webhooks을 연동해보자."><meta property="og:type" content="article"><meta property="og:url" content="https://seyslee.github.io/blog/slack-notifications-in-jenkins/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-01-02T12:01:40+09:00"><meta property="article:modified_time" content="2022-01-02T13:21:50+09:00"><meta property="og:site_name" content="seyslee"><meta name=twitter:card content="summary"><meta name=twitter:title content="Jenkins와 Slack webhook 연동"><meta name=twitter:description content="Jenkins 서버와 slack inbound webhooks을 연동해보자."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blogs","name":"Jenkins와 Slack webhook 연동","headline":"Jenkins와 Slack webhook 연동","description":"Jenkins 서버와 slack inbound webhooks을 연동해보자.","abstract":"개요 # Jenkins와 Slack을 Incoming webhooks를 이용해서 연동해보자.","inLanguage":"en","url":"https:\/\/seyslee.github.io\/blog\/slack-notifications-in-jenkins\/","author":{"@type":"Person","name":"Younsung Lee"},"copyrightYear":"2022","dateCreated":"2022-01-02T12:01:40\u002b09:00","datePublished":"2022-01-02T12:01:40\u002b09:00","dateModified":"2022-01-02T13:21:50\u002b09:00","keywords":["devops","jenkins"],"mainEntityOfPage":"true","wordCount":"973"}]</script><meta name=author content="Younsung Lee"><link href=mailto:ivecloudblack@gmail.com rel=me><link href=https://github.com/seyslee rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>seyslee</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/ title=Blogs>post</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>tag</a></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Jenkins와 Slack webhook 연동</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-01-02 12:01:40 +0900 +0900">Jan 2, 2022</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2022-01-02 13:21:50 +0900 +0900">Updated: Jan 2, 2022</time></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#개요>개요</a></li><li><a href=#전제조건>전제조건</a></li><li><a href=#환경>환경</a><ul><li><a href=#시스템-구성도>시스템 구성도</a></li><li><a href=#virtual-server-환경-상세정보>Virtual Server 환경 상세정보</a></li></ul></li><li><a href=#방법>방법</a><ul><li><a href=#1-jenkins-플러그인-설치>1. Jenkins 플러그인 설치</a></li><li><a href=#2-slack-setup>2. Slack setup</a></li><li><a href=#3-jenkins-slack-설정>3. Jenkins Slack 설정</a><ul><li></li></ul></li><li><a href=#4-jenkinsfile-준비>4. Jenkinsfile 준비</a></li><li><a href=#5-jenkins-pipeline-생성>5. Jenkins pipeline 생성</a></li></ul></li><li><a href=#결론>결론</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><h1 id=개요 class="relative group">개요 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b0%9c%ec%9a%94 aria-label=Anchor>#</a></span></h1><p>Jenkins와 Slack을 Incoming webhooks를 이용해서 연동해보자.</p><p>Incoming webhooks는 Slack 자체 플러그인(앱)이다.</p><br><h1 id=전제조건 class="relative group">전제조건 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%a0%84%ec%a0%9c%ec%a1%b0%ea%b1%b4 aria-label=Anchor>#</a></span></h1><ul><li><p><u><strong>컨테이너 형태로 구축된 Jenkins Server</strong></u> : 실습에서 중요한 핵심 요소</p></li><li><p><strong>Slack 계정</strong> : Jenkins와 Slack을 연동할 때 필요</p></li><li><p><strong>Github 계정</strong> : Github Repository를 만들고 Jenkinsfile 코드를 업로드할 때 필요</p></li></ul><br><h1 id=환경 class="relative group">환경 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%99%98%ea%b2%bd aria-label=Anchor>#</a></span></h1><h2 id=시스템-구성도 class="relative group">시스템 구성도 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%8b%9c%ec%8a%a4%ed%85%9c-%ea%b5%ac%ec%84%b1%eb%8f%84 aria-label=Anchor>#</a></span></h2><p><figure><img class="my-0 rounded-md" src=./0.png alt></figure></p><p>DigitalOcean이라는 클라우드 플랫폼 위에 Ubuntu 20.04.3 OS가 설치된 Virtual Server 1대를 생성해놓았다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/os-release <span class=p>|</span> grep VERSION
</span></span><span class=line><span class=cl><span class=nv>VERSION</span><span class=o>=</span><span class=s2>&#34;20.04.3 LTS (Focal Fossa)&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>VERSION_ID</span><span class=o>=</span><span class=s2>&#34;20.04&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>VERSION_CODENAME</span><span class=o>=</span>focal
</span></span><span class=line><span class=cl>$ arch
</span></span><span class=line><span class=cl>x86_64
</span></span></code></pre></div><br><p>그 리눅스 서버 위에 Docker를 설치후 Jenkins를 도커 컨테이너로 올린 구성이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ps -ef <span class=p>|</span> grep docker
</span></span><span class=line><span class=cl>root        <span class=m>2924</span>       <span class=m>1</span>  <span class=m>0</span>  <span class=m>2021</span> ?        00:01:10 /usr/bin/dockerd -H fd:// --containerd<span class=o>=</span>/run/containerd/containerd.sock
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker ps
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE            COMMAND                  CREATED        STATUS        PORTS                                                                                      NAMES
</span></span><span class=line><span class=cl>c269a4e8a445   jenkins-docker   <span class=s2>&#34;/sbin/tini -- /usr/…&#34;</span>   <span class=m>26</span> hours ago   Up <span class=m>26</span> hours   0.0.0.0:8080-&gt;8080/tcp, :::8080-&gt;8080/tcp, 0.0.0.0:50000-&gt;50000/tcp, :::50000-&gt;50000/tcp   jenkins
</span></span></code></pre></div><br><p>이 포스팅 자체가 Jenkins 서버를 구축하는 과정을 다루지는 않는다.</p><p>Jenkins Server를 직접 구축하고 싶다면 다른 글을 참고하고 오자.</p><br><h2 id=virtual-server-환경-상세정보 class="relative group">Virtual Server 환경 상세정보 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#virtual-server-%ed%99%98%ea%b2%bd-%ec%83%81%ec%84%b8%ec%a0%95%eb%b3%b4 aria-label=Anchor>#</a></span></h2><ul><li><p><strong>Cloud Service Provider</strong> : DigtialOcean</p></li><li><p><strong>OS</strong> : Ubuntu 20.04.3 LTS</p></li><li><p><strong>Linux Kernel</strong> : 5.4.0-88-generic</p></li><li><p><strong>Docker</strong> : Docker version 20.10.12, build e91ed57</p><ul><li><p><strong>Jenkins</strong> : 2.319.1</p></li><li><p>젠킨스 컨테이너를 생성할 때 사용한 컨테이너 이미지는 Jenkins 공식 도커허브 이미지( <a href=https://hub.docker.com/r/jenkins/jenkins><code>jenkins/jenkins:lts</code></a>)이다.</p></li><li><p><strong>Jenkins Plugin</strong> : Slack Notification 2.49</p></li></ul></li></ul><br><h1 id=방법 class="relative group">방법 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%b0%a9%eb%b2%95 aria-label=Anchor>#</a></span></h1><h2 id=1-jenkins-플러그인-설치 class="relative group">1. Jenkins 플러그인 설치 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-jenkins-%ed%94%8c%eb%9f%ac%ea%b7%b8%ec%9d%b8-%ec%84%a4%ec%b9%98 aria-label=Anchor>#</a></span></h2><p>Jenkins 관리 페이지로 로그인한다. Jenkins 기본포트는 8080이다.</p><p><figure><img class="my-0 rounded-md" src=./1.png alt></figure></p><br><p>Jenkins 메인화면 → Jenkins 관리 → 플러그인 관리 메뉴로 들어가자.</p><img title src=./2.jpg alt data-align=inline><br><p>설치 가능 탭으로 이동한다.</p><p><figure><img class="my-0 rounded-md" src=./3.jpg alt></figure></p><br><p>설치 가능 탭에서 slack으로 검색한다.</p><p><figure><img class="my-0 rounded-md" src=./4.jpg alt></figure></p><p>Slack Notification 2.49 버전이 검색된다.</p><br><p>Slack Notification에 Install 체크 → Download now and install after restart 클릭</p><p><figure><img class="my-0 rounded-md" src=./5.jpg alt></figure></p><br><p>젠킨스가 Slack Notification 플러그인을 설치한 후 자동으로 재시작할 것이다.</p><p><figure><img class="my-0 rounded-md" src=./6.jpg alt></figure></p><p>잠시 기다린 후 다시 젠킨스에 로그인한다.</p><br><h2 id=2-slack-setup class="relative group">2. Slack setup <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-slack-setup aria-label=Anchor>#</a></span></h2><p><a href=www.slack.com>slack 공식 홈페이지</a>로 접속한후 새로운 계정으로 가입한다.</p><p>이미 Slack 계정을 가지고 있다면 또 가입할 필요는 없다.</p><p><figure><img class="my-0 rounded-md" src=./7.png alt></figure></p><br><p>새 워크스페이스를 만든 후, 워크스페이스에 사용할 앱을 추가하기 위해 앱 화면으로 들어간다.</p><p><figure><img class="my-0 rounded-md" src=./8.jpg alt></figure></p><br><p>검색창에 webhook을 입력한다.</p><p><figure><img class="my-0 rounded-md" src=./9.jpg alt></figure></p><p>Incoming Webhooks를 워크스페이스에 연결하기 위해 추가한다.</p><br><p>Incoming Webhooks의 설정에 들어간다.</p><p>채널에 포스트 값에 alerts를 입력한다. #alerts 채널이 웹후크 메세지를 받겠다는 것이다.</p><p><figure><img class="my-0 rounded-md" src=./10.jpg alt></figure></p><p>[수신 웹후크 통합 앱 추가] 버튼을 클릭한다.</p><br><p>하단에 내려보면 웹후크 URL이 보인다.</p><p>지금 바로 사용할 것은 아니기 때문에 웹후크 URL을 메모장에 따로 복사해놓는다.</p><p><figure><img class="my-0 rounded-md" src=./11.jpg alt></figure></p><br><h2 id=3-jenkins-slack-설정 class="relative group">3. Jenkins Slack 설정 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-jenkins-slack-%ec%84%a4%ec%a0%95 aria-label=Anchor>#</a></span></h2><p>Jenkins 메인화면 → 시스템 설정 메뉴로 들어간다.</p><p><figure><img class="my-0 rounded-md" src=./12.png alt></figure></p><br><p>환경설정에서 하단으로 쭉 내려보면, Slack 섹션이 있다. 여기서 Credential 값에 아까 복사한 웹후크 URL이 들어갈 것이다.</p><p><figure><img class="my-0 rounded-md" src=./13.jpg alt></figure></p><p>[고급&mldr;] 버튼을 눌러서 전체 속성을 볼 수 있게 화면을 확장 시킨다.</p><br><p>Credential → Add → Jenkins 를 눌러서 Slack용 로그인 정보를 새로 생성하자.</p><p><figure><img class="my-0 rounded-md" src=./14.jpg alt></figure></p><br><p>아까 복사한 웹후크 URL을 보자.</p><p><figure><img class="my-0 rounded-md" src=./15.jpg alt></figure></p><p>웹후크 URL의 앞부분(<code>https://hooks.slack.com/services/</code>)을 제외하고 뒷부분만 복사한다.</p><br><h4 id=slack-credential-생성 class="relative group">Slack Credential 생성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#slack-credential-%ec%83%9d%ec%84%b1 aria-label=Anchor>#</a></span></h4><p>[Add] 버튼을 누르면 아래와 같은 Credential 생성화면이 나타난다.</p><p><figure><img class="my-0 rounded-md" src=./16.jpg alt></figure></p><ul><li><p><strong>Kind</strong> : Secret text</p></li><li><p><strong>Secret</strong> : 웹후크 URL의 뒷부분을 복사 붙여넣기한다.</p></li><li><p><strong>ID</strong> : slack-alerts (본인이 원하는 걸로 바꿔도 무방하다.)</p></li><li><p><strong>Description</strong> : ID에 대한 부가설명</p></li></ul><br><p>참고로 이렇게 Credential을 쓰는 이유는 보안을 강화하기 위해서이다.</p><p>실제 운영 환경에서 Webhook URL이라던지 ID/PW 값을 공개할 수는 없으니, Jenkins가 따로 Credential을 안전하게 관리한다.</p><br><h4 id=slack-세팅-점검 class="relative group">Slack 세팅 점검 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#slack-%ec%84%b8%ed%8c%85-%ec%a0%90%ea%b2%80 aria-label=Anchor>#</a></span></h4><ul><li><p><strong>Credential</strong> : slack-alerts (우리가 방금 만든)</p></li><li><p><strong>Default channel / member id</strong> : #alerts</p></li><li><p><strong>Override url</strong> : <code>https://hooks.slack.com/services/</code></p></li></ul><p>위 설정값들을 입력 후 <code>Test Connection</code> 버튼 클릭</p><p><figure><img class="my-0 rounded-md" src=./17.jpg alt></figure></p><p>설정값을 올바르게 넣었다면 접속 성공이라는 메세지(Success)가 떨어진다. <code>Test Connection</code> 버튼을 여러번 눌러본다.</p><br><p><code>Test Connection</code> 버튼을 누를 때마다 #alert 채널로 메세지가 들어온다.</p><p><figure><img class="my-0 rounded-md" src=./18.png alt></figure></p><br><p>최종적으로는 Jenkins build 실패시에도 Slack 메세지를 자동으로 보내주도록 구현할 것이다.</p><p><figure><img class="my-0 rounded-md" src=./19.png alt></figure></p><br><h2 id=4-jenkinsfile-준비 class="relative group">4. Jenkinsfile 준비 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-jenkinsfile-%ec%a4%80%eb%b9%84 aria-label=Anchor>#</a></span></h2><p>Jenkinsfile은 젠킨스 파이프라인이 동작하는 전체 과정을 코드로 적어놓은 명세서라고 생각하면 된다. Jenkinsfile은 groovy라는 언어를 사용한다.</p><p>새 레포지터리를 만들고 Jenkinsfile 을 올려놓는다. 내 경우 환경은 아래와 같다.</p><ul><li><p><strong>레포지터리 이름</strong> : jenkins-pipeline-toyproj <a href=https://github.com/seyslee/jenkins-pipeline-toyproj>바로가기</a></p></li><li><p><strong>Jenkinsfile 경로</strong> : <code>/5-slack-notifications/Jenkinsfile</code> (깃허브 레포 기준)</p></li></ul><p><figure><img class="my-0 rounded-md" src=./20.jpg alt></figure></p><br><p>내 경우 로컬 환경에서 Jenkinsfile 코드를 작성하고 레포지터리를 연결한 다음, <code>git push</code>로 코드(Jenkinsfile)를 미리 레포지터리에 밀어넣은 상태이다.</p><p><figure><img class="my-0 rounded-md" src=./21.jpg alt></figure></p><br><p>Jenkinsfile 코드는 다음과 같다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>node</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// job
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>stage</span><span class=p>(</span><span class=s1>&#39;build&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>println</span><span class=p>(</span><span class=s1>&#39;so far so good...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>stage</span><span class=p>(</span><span class=s1>&#39;test&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>println</span><span class=p>(</span><span class=s1>&#39;A test has failed!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>sh</span> <span class=s1>&#39;exit 1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// mark build as failed
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>currentBuild</span><span class=p>.</span><span class=nx>result</span> <span class=o>=</span> <span class=s2>&#34;FAILURE&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// send slack notification
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>slackSend</span> <span class=p>(</span><span class=nx>color</span><span class=o>:</span> <span class=s1>&#39;#FF0000&#39;</span><span class=p>,</span> <span class=nx>message</span><span class=o>:</span> <span class=s2>&#34;FAILED: Job &#39;${env.JOB_NAME} [${env.BUILD_NUMBER}]&#39; (${env.BUILD_URL})&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// throw the error
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>throw</span> <span class=nx>e</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Jenkinsfile 실행시 진행순서</strong></p><ol><li><p>Jenkins에서 github에 올라가있는 <code>Jenkinsfile</code>을 통해 build를 시작한다.</p></li><li><p>파이프라인에서 build stage는 통과한다.</p></li><li><p>파이프라인의 test stage에서 에러가 발생할 수 밖에 없다. (<code>exit 1</code>을 반환하도록 짜여져 있으니까)</p></li><li><p>Jenkins는 빌드에 에러 발생을 감지한다.</p></li><li><p>Jenkins는 <code>slackSend()</code>를 통해 미리 설정된 Slack webhook로 에러 메세지를 보낸다.</p></li><li><p>Slack의 #alert 채널로 Jenkins가 보낸 빌드에러 메세지가 들어온다.</p></li></ol><br><h2 id=5-jenkins-pipeline-생성 class="relative group">5. Jenkins pipeline 생성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-jenkins-pipeline-%ec%83%9d%ec%84%b1 aria-label=Anchor>#</a></span></h2><p>Jenkins 메인화면 → create a new job으로 들어간다.</p><p><figure><img class="my-0 rounded-md" src=./22.jpg alt></figure></p><ul><li><p><strong>Item name</strong> : slack notification (본인이 하고 싶은걸로 바꿔도 무방함)</p></li><li><p><strong>종류</strong> : Pipeline</p></li></ul><p>[OK] 버튼을 누르면 다음 화면으로 넘어간다.</p><br><p>Pipeline 정보를 넣는다.</p><p>Branch Specifier 값이 master가 아닌 main이라는 점을 체크한다.</p><ul><li><p><strong>Definition</strong> : Pipeline script from SCM</p></li><li><p><strong>SCM</strong> : Git</p></li><li><p><strong>Repository URL</strong> : <code>https://github.com/seyslee/jenkins-pipeline-toyproj.git</code></p><ul><li>스스로 구축한 Github Repository가 있다면 그걸로 바꿔서 입력.</li></ul></li><li><p><strong>Branch Specifier</strong> : <code>*/main</code></p><ul><li>2020년 10월을 기점으로 github는 default branch 이름인 master가 인종 차별적 단어라는 이유로 main이 기본 생성되도록 변경했다.</li><li><strong>원문</strong> : <a href=https://github.blog/changelog/2020-10-01-the-default-branch-for-newly-created-repositories-is-now-main/>The default branch for newly-created repositories is now main | GitHub Changelog</a></li></ul></li></ul><p><figure><img class="my-0 rounded-md" src=./23.jpg alt></figure></p><br><ul><li><strong>Script Path</strong> : <code>5-slack-notification/Jenkinsfile</code> (해당 레포 기준에서의 Jenkinsfile의 경로를 의미한다.)</li></ul><p><figure><img class="my-0 rounded-md" src=./24.jpg alt></figure></p><p>입력 후 저장한다.</p><br><p>slack notification 초기화면 → [Build Now] 버튼 클릭</p><p><figure><img class="my-0 rounded-md" src=./25.jpg alt></figure></p><br><p>Build를 시작하면 Jenkins이 Github Repository에 저장되어 있는 Jenkinsfile을 기반으로 파이프라인을 실행한다.</p><p>우리가 의도한대로 build stage는 문제없이 통과하고 test stage에서 실패한다.</p><p><figure><img class="my-0 rounded-md" src=./26.jpg alt></figure></p><br><p><strong>에러화면</strong></p><p><figure><img class="my-0 rounded-md" src=./27.jpg alt></figure></p><p>아랫줄에 출력된 로그를 자세히 보자.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.....
</span></span><span class=line><span class=cl><span class=o>[</span>Pipeline<span class=o>]</span> // stage
</span></span><span class=line><span class=cl><span class=o>[</span>Pipeline<span class=o>]</span> slackSend
</span></span><span class=line><span class=cl>Slack Send Pipeline step running, values are - baseUrl: https://hooks.slack.com/services/, teamDomain: &lt;empty&gt;, channel: <span class=c1>#alert, color: #FF0000, botUser: false, tokenCredentialId: slack-alerts, notifyCommitters: false, iconEmoji: &lt;empty&gt;, username: &lt;empty&gt;, timestamp: &lt;empty&gt;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>Pipeline<span class=o>]</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>Pipeline<span class=o>]</span> // node
</span></span><span class=line><span class=cl>.....
</span></span></code></pre></div><p><code>baseUrl</code>, <code>channel</code> 값이 jenkins slack 설정값과 동일하게 제대로 넘어갔는지 체크한다.</p><br><p>build가 실패하자 #alert 채널에 FAILED: Job 메세지가 출력되었다.</p><p><figure><img class="my-0 rounded-md" src=./28.jpg alt></figure></p><br><p>전달받은 slack 메세지에 딸린 URL을 클릭하면 해당 오류를 발생시킨 Jenkins build 페이지로 연결된다!</p><p><figure><img class="my-0 rounded-md" src=./29.png alt></figure></p><br><p>정상 접속된 Jenkins 웹페이지</p><p><figure><img class="my-0 rounded-md" src=./30.jpg alt></figure></p><br><h1 id=결론 class="relative group">결론 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b2%b0%eb%a1%a0 aria-label=Anchor>#</a></span></h1><p>ChatOps가 요즘 운영 트렌드이다. 트렌드가 바뀌면서 DevOps Engineer에게 이제 Jenkins는 도커와 동등한 수준을 요구하는 핵심 스킬이 된 것 같다.</p><p>Jenkins와 Slack의 다양한 앱을 통합하면 서비스 모니터링과 알람 자동화를 할 수 있다. 그리고 무엇보다도 Jenkins는 모든 걸 다 붙일 수 있는 만능툴이니 꼭 딥하게 배워놓자.</p><p>이상으로 긴 글 읽어주신 독자분들 감사합니다.</p><br><p><strong>PS. 실습을 따라 진행하시다가 잘 안될 경우, 댓글을 달아주시면 같이 해결을 도와드리겠습니다.</strong></p></div></section><footer class="pt-8 max-w-prose print:hidden"><script src=https://utteranc.es/client.js repo=seyslee/seyslee.github.io issue-term=pathname label=blog-comment theme=github-dark crossorigin=anonymous async></script></footer></article></main><footer class="py-10 print:hidden"><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Younsung Lee</p></div></div></footer></div></body></html>