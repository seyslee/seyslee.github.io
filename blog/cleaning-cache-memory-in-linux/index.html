<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>리눅스 캐시 메모리 비우기 &#183; seyslee</title><meta name=title content="리눅스 캐시 메모리 비우기 &#183; seyslee"><meta name=description content="seyslee"><link rel=canonical href=https://seyslee.github.io/blog/cleaning-cache-memory-in-linux/><link type=text/css rel=stylesheet href=/css/main.bundle.min.4237a54696344545847852e66642dc3be0dbc6296c3890031b5dfb8c9aaf683fc56c227436ecf341b430c4c690554013087987403de93d86e94529f0f48a3ab8.css integrity="sha512-QjelRpY0RUWEeFLmZkLcO+DbxilsOJADG137jJqvaD/FbCJ0NuzzQbQwxMaQVUATCHmHQD3pPYbpRSnw9Io6uA=="><script type=text/javascript src=/js/appearance.min.12e98742cd283574d030a7fe55f29597df4ee214f7ff7075b4d19a64d046a602753c715295550be7899b661619cec89c679049d36c624681671a8013c1249896.js integrity="sha512-EumHQs0oNXTQMKf+VfKVl99O4hT3/3B1tNGaZNBGpgJ1PHFSlVUL54mbZhYZzsicZ5BJ02xiRoFnGoATwSSYlg=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9ae0a991bb442898e9bc60cf318b4de3ff878325ff3821625a5564b32b2f66aec0e7f7d0e00ca3ac7df59d9f01c18c88b6bdd213184f86ac9ce06d7bdffbadf8.js integrity="sha512-muCpkbtEKJjpvGDPMYtN4/+HgyX/OCFiWlVksysvZq7A5/fQ4AyjrH31nZ8BwYyItr3SExhPhqyc4G173/ut+A==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="리눅스 캐시 메모리 비우기"><meta property="og:description" content="리눅스 서버에서 명령어를 통해 캐시 메모리를 비우고 여유 메모리를 확보하는 방법을 설명합니다."><meta property="og:type" content="article"><meta property="og:url" content="https://seyslee.github.io/blog/cleaning-cache-memory-in-linux/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-10-28T18:31:20+09:00"><meta property="article:modified_time" content="2021-10-28T18:47:10+09:00"><meta property="og:site_name" content="seyslee"><meta name=twitter:card content="summary"><meta name=twitter:title content="리눅스 캐시 메모리 비우기"><meta name=twitter:description content="리눅스 서버에서 명령어를 통해 캐시 메모리를 비우고 여유 메모리를 확보하는 방법을 설명합니다."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blogs","name":"리눅스 캐시 메모리 비우기","headline":"리눅스 캐시 메모리 비우기","description":"리눅스 서버에서 명령어를 통해 캐시 메모리를 비우고 여유 메모리를 확보하는 방법을 설명합니다.","abstract":"개요 # 리눅스 서버에서 명령어를 통해 캐시 메모리를 정리해 여유 메모리를 확보할 수 있다.","inLanguage":"en","url":"https:\/\/seyslee.github.io\/blog\/cleaning-cache-memory-in-linux\/","author":{"@type":"Person","name":"Younsung Lee"},"copyrightYear":"2021","dateCreated":"2021-10-28T18:31:20\u002b09:00","datePublished":"2021-10-28T18:31:20\u002b09:00","dateModified":"2021-10-28T18:47:10\u002b09:00","keywords":["os","linux","hardware"],"mainEntityOfPage":"true","wordCount":"934"}]</script><meta name=author content="Younsung Lee"><link href=mailto:ivecloudblack@gmail.com rel=me><link href=https://github.com/seyslee rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>seyslee</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/ title=Blogs>post</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>tag</a></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">리눅스 캐시 메모리 비우기</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2021-10-28 18:31:20 +0900 +0900">Oct 28, 2021</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2021-10-28 18:47:10 +0900 +0900">Updated: Oct 28, 2021</time></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#개요>개요</a></li><li><a href=#환경>환경</a></li><li><a href=#해결법>해결법</a><ul><li><a href=#1-메모리-사용량-요약-확인>1. 메모리 사용량 요약 확인</a></li><li><a href=#2-메모리-사용량-상세-확인>2. 메모리 사용량 상세 확인</a><ul><li><a href=#기본-단위kb로-보기>기본 단위(kB)로 보기</a></li><li><a href=#gb-단위로-보기>GB 단위로 보기</a></li></ul></li><li><a href=#3-캐시-메모리-정리>3. 캐시 메모리 정리</a><ul><li><a href=#메모리-사용량-모니터링>메모리 사용량 모니터링</a></li><li><a href=#sync>sync</a></li><li><a href=#캐시-메모리-정리>캐시 메모리 정리</a></li></ul></li><li><a href=#4-메모리-반환-결과-확인>4. 메모리 반환 결과 확인</a><ul><li><a href=#메모리-사용량-요약-확인>메모리 사용량 요약 확인</a></li><li><a href=#메모리-사용량-상세-확인>메모리 사용량 상세 확인</a></li><li><a href=#메모리-전후-비교표>메모리 전후 비교표</a></li></ul></li><li><a href=#5-캐시-메모리-스케줄링-등록>5. 캐시 메모리 스케줄링 등록</a><ul><li><a href=#cron-커닝페이퍼cheatsheet>Cron 커닝페이퍼(Cheatsheet)</a></li><li><a href=#스케줄링-등록>스케줄링 등록</a></li><li><a href=#스케줄링-확인>스케줄링 확인</a></li></ul></li></ul></li><li><a href=#참고자료>참고자료</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><h1 id=개요 class="relative group">개요 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b0%9c%ec%9a%94 aria-label=Anchor>#</a></span></h1><p>리눅스 서버에서 명령어를 통해 캐시 메모리를 정리해 여유 메모리를 확보할 수 있다.</p><br><h1 id=환경 class="relative group">환경 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%99%98%ea%b2%bd aria-label=Anchor>#</a></span></h1><ul><li><strong>OS</strong> : Red Hat Enterprise Linux Server release 5.x</li><li><strong>Shell</strong> : bash</li></ul><br><h1 id=해결법 class="relative group">해결법 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%95%b4%ea%b2%b0%eb%b2%95 aria-label=Anchor>#</a></span></h1><h2 id=1-메모리-사용량-요약-확인 class="relative group">1. 메모리 사용량 요약 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%eb%a9%94%eb%aa%a8%eb%a6%ac-%ec%82%ac%ec%9a%a9%eb%9f%89-%ec%9a%94%ec%95%bd-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ free -g
</span></span><span class=line><span class=cl>             total       used       free     shared    buffers     cached
</span></span><span class=line><span class=cl>Mem:            <span class=m>62</span>         <span class=m>62</span>          <span class=m>0</span>          <span class=m>0</span>          <span class=m>0</span>         <span class=m>55</span>
</span></span><span class=line><span class=cl>-/+ buffers/cache:          <span class=m>6</span>         <span class=m>56</span>
</span></span><span class=line><span class=cl>Swap:           <span class=m>62</span>          <span class=m>3</span>         <span class=m>59</span>
</span></span></code></pre></div><p>전체 메모리(<code>total</code>) 62GB 중 55GB가 캐시 메모리(<code>cached</code>)로 잡혀있다.</p><br><h2 id=2-메모리-사용량-상세-확인 class="relative group">2. 메모리 사용량 상세 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%eb%a9%94%eb%aa%a8%eb%a6%ac-%ec%82%ac%ec%9a%a9%eb%9f%89-%ec%83%81%ec%84%b8-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h2><h3 id=기본-단위kb로-보기 class="relative group">기본 단위(kB)로 보기 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b8%b0%eb%b3%b8-%eb%8b%a8%ec%9c%84kb%eb%a1%9c-%eb%b3%b4%ea%b8%b0 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /proc/meminfo <span class=p>|</span> column -t
</span></span><span class=line><span class=cl>MemTotal:         <span class=m>66004284</span>     kB
</span></span><span class=line><span class=cl>MemFree:          <span class=m>211724</span>       kB
</span></span><span class=line><span class=cl>Buffers:          <span class=m>759392</span>       kB
</span></span><span class=line><span class=cl>Cached:           <span class=m>58053888</span>     kB
</span></span><span class=line><span class=cl>SwapCached:       <span class=m>2245728</span>      kB
</span></span><span class=line><span class=cl>Active:           <span class=m>11509948</span>     kB
</span></span><span class=line><span class=cl>Inactive:         <span class=m>53444952</span>     kB
</span></span><span class=line><span class=cl>HighTotal:        <span class=m>0</span>            kB
</span></span><span class=line><span class=cl>HighFree:         <span class=m>0</span>            kB
</span></span><span class=line><span class=cl>LowTotal:         <span class=m>66004284</span>     kB
</span></span><span class=line><span class=cl>LowFree:          <span class=m>211724</span>       kB
</span></span><span class=line><span class=cl>SwapTotal:        <span class=m>65537156</span>     kB
</span></span><span class=line><span class=cl>SwapFree:         <span class=m>62276916</span>     kB
</span></span><span class=line><span class=cl>Dirty:            <span class=m>1056</span>         kB
</span></span><span class=line><span class=cl>Writeback:        <span class=m>0</span>            kB
</span></span><span class=line><span class=cl>AnonPages:        <span class=m>6139572</span>      kB
</span></span><span class=line><span class=cl>Mapped:           <span class=m>42920</span>        kB
</span></span><span class=line><span class=cl>Slab:             <span class=m>668696</span>       kB
</span></span><span class=line><span class=cl>PageTables:       <span class=m>36240</span>        kB
</span></span><span class=line><span class=cl>NFS_Unstable:     <span class=m>0</span>            kB
</span></span><span class=line><span class=cl>Bounce:           <span class=m>0</span>            kB
</span></span><span class=line><span class=cl>CommitLimit:      <span class=m>98539296</span>     kB
</span></span><span class=line><span class=cl>Committed_AS:     <span class=m>11802812</span>     kB
</span></span><span class=line><span class=cl>VmallocTotal:     <span class=m>34359738367</span>  kB
</span></span><span class=line><span class=cl>VmallocUsed:      <span class=m>295112</span>       kB
</span></span><span class=line><span class=cl>VmallocChunk:     <span class=m>34359442931</span>  kB
</span></span><span class=line><span class=cl>HugePages_Total:  <span class=m>0</span>
</span></span><span class=line><span class=cl>HugePages_Free:   <span class=m>0</span>
</span></span><span class=line><span class=cl>HugePages_Rsvd:   <span class=m>0</span>
</span></span><span class=line><span class=cl>Hugepagesize:     <span class=m>2048</span>         kB
</span></span></code></pre></div><p><code>column -t</code> : 출력결과를 칸에 맞게 정렬해서 가독성을 높여주는 명령어<br>확인결과 전체 메모리(<code>MemTotal</code>)의 87%가 캐시 메모리(<code>Cached</code>)로 잡혀있다.</p><br><h3 id=gb-단위로-보기 class="relative group">GB 단위로 보기 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#gb-%eb%8b%a8%ec%9c%84%eb%a1%9c-%eb%b3%b4%ea%b8%b0 aria-label=Anchor>#</a></span></h3><p>kB 단위로 보는게 불편하면 GB 단위로 변환시켜 볼 수도 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ awk <span class=s1>&#39;$3==&#34;kB&#34;{$2=$2/1024/1024;$3=&#34;GB&#34;} 1&#39;</span> /proc/meminfo <span class=p>|</span> column -t
</span></span><span class=line><span class=cl>MemTotal:         62.9466     GB
</span></span><span class=line><span class=cl>MemFree:          0.191048    GB
</span></span><span class=line><span class=cl>Buffers:          0.724033    GB
</span></span><span class=line><span class=cl>Cached:           55.3696     GB
</span></span><span class=line><span class=cl>SwapCached:       2.14169     GB
</span></span><span class=line><span class=cl>Active:           10.6456     GB
</span></span><span class=line><span class=cl>Inactive:         51.3047     GB
</span></span><span class=line><span class=cl>HighTotal:        <span class=m>0</span>           GB
</span></span><span class=line><span class=cl>HighFree:         <span class=m>0</span>           GB
</span></span><span class=line><span class=cl>LowTotal:         62.9466     GB
</span></span><span class=line><span class=cl>LowFree:          0.191048    GB
</span></span><span class=line><span class=cl>SwapTotal:        62.5011     GB
</span></span><span class=line><span class=cl>SwapFree:         59.3919     GB
</span></span><span class=line><span class=cl>Dirty:            0.00088501  GB
</span></span><span class=line><span class=cl>Writeback:        <span class=m>0</span>           GB
</span></span><span class=line><span class=cl>AnonPages:        5.8541      GB
</span></span><span class=line><span class=cl>Mapped:           0.0409317   GB
</span></span><span class=line><span class=cl>Slab:             0.636795    GB
</span></span><span class=line><span class=cl>PageTables:       0.0345459   GB
</span></span><span class=line><span class=cl>NFS_Unstable:     <span class=m>0</span>           GB
</span></span><span class=line><span class=cl>Bounce:           <span class=m>0</span>           GB
</span></span><span class=line><span class=cl>CommitLimit:      93.9744     GB
</span></span><span class=line><span class=cl>Committed_AS:     11.3072     GB
</span></span><span class=line><span class=cl>VmallocTotal:     <span class=m>32768</span>       GB
</span></span><span class=line><span class=cl>VmallocUsed:      0.281441    GB
</span></span><span class=line><span class=cl>VmallocChunk:     32767.7     GB
</span></span><span class=line><span class=cl>HugePages_Total:  <span class=m>0</span>
</span></span><span class=line><span class=cl>HugePages_Free:   <span class=m>0</span>
</span></span><span class=line><span class=cl>HugePages_Rsvd:   <span class=m>0</span>
</span></span><span class=line><span class=cl>Hugepagesize:     0.00195312  GB
</span></span></code></pre></div><p>전체 메모리(<code>MemTotal</code>) 64GB 중에서 캐시 메모리(<code>Cached</code>)를 55GB 쓰고, 버퍼 메모리(<code>Buffers</code>)는 0.7GB 사용중.<br>여유 메모리(<code>MemFree</code>) 값이 0.1GB로 너무 낮다.</p><br><h2 id=3-캐시-메모리-정리 class="relative group">3. 캐시 메모리 정리 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%ec%ba%90%ec%8b%9c-%eb%a9%94%eb%aa%a8%eb%a6%ac-%ec%a0%95%eb%a6%ac aria-label=Anchor>#</a></span></h2><h3 id=메모리-사용량-모니터링 class="relative group">메모리 사용량 모니터링 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%a9%94%eb%aa%a8%eb%a6%ac-%ec%82%ac%ec%9a%a9%eb%9f%89-%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81 aria-label=Anchor>#</a></span></h3><p>캐시 메모리 정리 전에 <u>메모리 사용량 변화를 모니터링 하기 위해</u> 세션을 하나 더 띄워서 <code>watch -d -n1 "free -g"</code> 명령어를 실행한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ watch -d -n1 <span class=s2>&#34;free -g&#34;</span>
</span></span></code></pre></div><p>1초 간격으로 <code>free -g</code> 명령어를 실행하는 명령어.<br><code>-d</code> 옵션은 변경된 값을 하이라이팅 해서 가독성을 높여준다.</p><br><h3 id=sync class="relative group">sync <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#sync aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sync
</span></span></code></pre></div><p>캐시 메모리에 있는 변동사항을 하드디스크에 옮겨서 쓰기(Write)</p><br><h3 id=캐시-메모리-정리 class="relative group">캐시 메모리 정리 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%ba%90%ec%8b%9c-%eb%a9%94%eb%aa%a8%eb%a6%ac-%ec%a0%95%eb%a6%ac aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=m>3</span> &gt; /proc/sys/vm/drop_caches
</span></span></code></pre></div><p>캐시 메모리를 정리한다. 정리대상은 pagecache, dentry, inode 이다.</p><p>캐시 메모리 정리 소요시간은 서버 환경과 캐시 메모리 용량에 따라 다른데 보통 10초 안으로 정리가 완료된다.</p><br><p><strong>용어설명</strong></p><ul><li><strong>pagecache</strong> : 파일의 입출력(I/O)의 속도와 퍼포먼스를 높이기 위해 시스템이 할당한 메모리 영역(임시 메모리 저장소). 예를 들어 어떤 경로의 파일을 한 번 읽어들이면 시스템이 해당 파일 내용을 임시메모리에 저장시키는데 이후에 해당 파일을 다시 읽을 때 이를 새로 읽어들이지 않고 이 메모리에서 바로 불러오면 디스크의 읽기/쓰기 속도가 빨라지므로 효율이 높아짐. 윈도우 OS의 페이지 파일 같은 역할.</li><li><strong>dentry</strong> : directory entry의 줄임말로 예를 들어 /usr/share 같은 경로에서 usr과 share를 지칭.</li><li><strong>inode</strong> : 파일과 디렉토리에 관한 정보를 담고 있는 자료구조. 예를 들어 파일의 퍼미션 정보, 디스크 상의 파일의 물리적 위치, 크기, 생성된 일시 정보 등을 저장.</li></ul><br><p><strong>drop_caches 의미</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=m>1</span> &gt; /proc/sys/vm/drop_caches  <span class=c1># To free pagecache</span>
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=m>2</span> &gt; /proc/sys/vm/drop_caches  <span class=c1># To free dentries and inodes</span>
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=m>3</span> &gt; /proc/sys/vm/drop_caches  <span class=c1># To free pagecache, dentries and inodes</span>
</span></span></code></pre></div><br><h2 id=4-메모리-반환-결과-확인 class="relative group">4. 메모리 반환 결과 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-%eb%a9%94%eb%aa%a8%eb%a6%ac-%eb%b0%98%ed%99%98-%ea%b2%b0%ea%b3%bc-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h2><h3 id=메모리-사용량-요약-확인 class="relative group">메모리 사용량 요약 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%a9%94%eb%aa%a8%eb%a6%ac-%ec%82%ac%ec%9a%a9%eb%9f%89-%ec%9a%94%ec%95%bd-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ free -g                                                                                                       
</span></span><span class=line><span class=cl>             total       used       free     shared    buffers     cached
</span></span><span class=line><span class=cl>Mem:            <span class=m>62</span>         <span class=m>12</span>         <span class=m>50</span>          <span class=m>0</span>          <span class=m>0</span>          <span class=m>5</span>
</span></span><span class=line><span class=cl>-/+ buffers/cache:          <span class=m>6</span>         <span class=m>56</span>
</span></span><span class=line><span class=cl>Swap:           <span class=m>62</span>          <span class=m>3</span>         <span class=m>59</span>
</span></span></code></pre></div><p><code>-g</code> : GB 단위로 보여준다.</p><br><h3 id=메모리-사용량-상세-확인 class="relative group">메모리 사용량 상세 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%a9%94%eb%aa%a8%eb%a6%ac-%ec%82%ac%ec%9a%a9%eb%9f%89-%ec%83%81%ec%84%b8-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ awk <span class=s1>&#39;$3==&#34;kB&#34;{$2=$2/1024/1024;$3=&#34;GB&#34;} 1&#39;</span> /proc/meminfo <span class=p>|</span> column -t
</span></span><span class=line><span class=cl>MemTotal:         62.9466     GB
</span></span><span class=line><span class=cl>MemFree:          48.9179     GB
</span></span><span class=line><span class=cl>Buffers:          0.0405312   GB
</span></span><span class=line><span class=cl>Cached:           7.78165     GB
</span></span><span class=line><span class=cl>SwapCached:       2.14169     GB
</span></span><span class=line><span class=cl>Active:           8.87233     GB
</span></span><span class=line><span class=cl>Inactive:         4.87525     GB
</span></span><span class=line><span class=cl>HighTotal:        <span class=m>0</span>           GB
</span></span><span class=line><span class=cl>HighFree:         <span class=m>0</span>           GB
</span></span><span class=line><span class=cl>LowTotal:         62.9466     GB
</span></span><span class=line><span class=cl>LowFree:          48.9179     GB
</span></span><span class=line><span class=cl>SwapTotal:        62.5011     GB
</span></span><span class=line><span class=cl>SwapFree:         59.3919     GB
</span></span><span class=line><span class=cl>Dirty:            0.00118637  GB
</span></span><span class=line><span class=cl>Writeback:        <span class=m>0</span>           GB
</span></span><span class=line><span class=cl>AnonPages:        5.92254     GB
</span></span><span class=line><span class=cl>Mapped:           0.0409355   GB
</span></span><span class=line><span class=cl>Slab:             0.11797     GB
</span></span><span class=line><span class=cl>PageTables:       0.0352592   GB
</span></span><span class=line><span class=cl>NFS_Unstable:     <span class=m>0</span>           GB
</span></span><span class=line><span class=cl>Bounce:           <span class=m>0</span>           GB
</span></span><span class=line><span class=cl>CommitLimit:      93.9744     GB
</span></span><span class=line><span class=cl>Committed_AS:     11.2496     GB
</span></span><span class=line><span class=cl>VmallocTotal:     <span class=m>32768</span>       GB
</span></span><span class=line><span class=cl>VmallocUsed:      0.281441    GB
</span></span><span class=line><span class=cl>VmallocChunk:     32767.7     GB
</span></span><span class=line><span class=cl>HugePages_Total:  <span class=m>0</span>
</span></span><span class=line><span class=cl>HugePages_Free:   <span class=m>0</span>
</span></span><span class=line><span class=cl>HugePages_Rsvd:   <span class=m>0</span>
</span></span><span class=line><span class=cl>Hugepagesize:     0.00195312  GB
</span></span></code></pre></div><br><h3 id=메모리-전후-비교표 class="relative group">메모리 전후 비교표 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%a9%94%eb%aa%a8%eb%a6%ac-%ec%a0%84%ed%9b%84-%eb%b9%84%ea%b5%90%ed%91%9c aria-label=Anchor>#</a></span></h3><p>버퍼 메모리는 작업전부터 크기가 작아 효과가 그리 체감되지는 않지만 94% 줄였고, 캐시 메모리는 87% 줄였다.</p><table><thead><tr><th style=text-align:center>구분</th><th style=text-align:center>버퍼 메모리</th><th style=text-align:center>캐시 메모리</th></tr></thead><tbody><tr><td style=text-align:center>Before</td><td style=text-align:center>0.7 [GB]</td><td style=text-align:center>55 [GB]</td></tr><tr><td style=text-align:center>After</td><td style=text-align:center>0.04 [GB]</td><td style=text-align:center>7 [GB]</td></tr></tbody></table><br><h2 id=5-캐시-메모리-스케줄링-등록 class="relative group">5. 캐시 메모리 스케줄링 등록 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-%ec%ba%90%ec%8b%9c-%eb%a9%94%eb%aa%a8%eb%a6%ac-%ec%8a%a4%ec%bc%80%ec%a4%84%eb%a7%81-%eb%93%b1%eb%a1%9d aria-label=Anchor>#</a></span></h2><p>시스템 엔지니어가 매번 수동으로 캐시 메모리를 정리하는 건 번거롭고 불가능하니, 서버가 알아서 자동 정리할 수 있도록 crontab에 캐시 메모리 정리 스케줄을 등록해준다.<br>반드시 root 계정에서 crontab을 등록해야한다.</p><blockquote><p>서버에 부하가 많은 시점에 <code>drop_cache</code> 값에 3을 부여하는 행위는 서버 멈춤 현상을 유발할 수 있다. 따라서 캐시 메모리 정리 스케줄링 등록 시 실행시간은 부하(Load)가 적은 새벽 시간대로 설정해야만 한다.</p></blockquote><h3 id=cron-커닝페이퍼cheatsheet class="relative group">Cron 커닝페이퍼(Cheatsheet) <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#cron-%ec%bb%a4%eb%8b%9d%ed%8e%98%ec%9d%b4%ed%8d%bccheatsheet aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># * * * * * command to be executed</span>
</span></span><span class=line><span class=cl><span class=c1># - - - - -</span>
</span></span><span class=line><span class=cl><span class=c1># | | | | |</span>
</span></span><span class=line><span class=cl><span class=c1># | | | | +----&gt; Day of Week  (0 - 6) (0 = Sunday ... 6 = Saturday)</span>
</span></span><span class=line><span class=cl><span class=c1># | | | +------&gt; Month        (1 - 12)</span>
</span></span><span class=line><span class=cl><span class=c1># | | +--------&gt; Day of Month (1 - 31)</span>
</span></span><span class=line><span class=cl><span class=c1># | +----------&gt; Hour         (0 - 23)</span>
</span></span><span class=line><span class=cl><span class=c1># +------------&gt; Minute       (0 - 59)</span>
</span></span></code></pre></div><p>crontab을 작성하는 일이 그리 빈번히 발생하는 편이 아니기 때문에 가끔 헷갈릴 때가 있다.<br>crontab 윗줄에 주석처리된 커닝페이퍼를 달아놓으면 작업시 눈 앞에 바로 참고자료가 있기 때문에 편리한 서버 관리가 가능하다.</p><br><h3 id=스케줄링-등록 class="relative group">스케줄링 등록 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%8a%a4%ec%bc%80%ec%a4%84%eb%a7%81-%eb%93%b1%eb%a1%9d aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ crontab -e
</span></span><span class=line><span class=cl><span class=m>0</span> <span class=m>3</span> * * * sync <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=m>3</span> &gt; /proc/sys/vm/drop_caches
</span></span></code></pre></div><p><code>-e</code> : crontab을 편집한다.</p><p>매일 새벽 3시마다 캐시 메모리를 정리하는 명령어를 실행한다.</p><br><h3 id=스케줄링-확인 class="relative group">스케줄링 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%8a%a4%ec%bc%80%ec%a4%84%eb%a7%81-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ crontab -l
</span></span><span class=line><span class=cl><span class=m>0</span> <span class=m>3</span> * * * sync <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=m>3</span> &gt; /proc/sys/vm/drop_caches
</span></span></code></pre></div><p><code>-l</code> : crontab의 설정 상태를 확인한다.</p><br><h1 id=참고자료 class="relative group">참고자료 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%b0%b8%ea%b3%a0%ec%9e%90%eb%a3%8c aria-label=Anchor>#</a></span></h1><p><a href=https://kangwoo.github.io/devops/linux/linux-buffer-cache/>https://kangwoo.github.io/devops/linux/linux-buffer-cache/</a><br><a href=https://linux-mm.org/Drop_Caches>https://linux-mm.org/Drop_Caches</a></p></div></section><footer class="pt-8 max-w-prose print:hidden"><script src=https://utteranc.es/client.js repo=seyslee/seyslee.github.io issue-term=pathname label=blog-comment theme=github-dark crossorigin=anonymous async></script></footer></article></main><footer class="py-10 print:hidden"><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Younsung Lee</p></div></div></footer></div></body></html>