<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>EC2에서 ECR로 도커 이미지 푸시 &#183; seyslee</title><meta name=title content="EC2에서 ECR로 도커 이미지 푸시 &#183; seyslee"><meta name=description content="seyslee"><link rel=canonical href=https://seyslee.github.io/blog/docker-push-ecr-image/><link type=text/css rel=stylesheet href=/css/main.bundle.min.cc396baef52cdb0a443160a5f7c70ca129c7814f8d0a548a73c6bbdaf93f314a3b54834993444ff2cbf4befcac49dd5324d335ea30822840c688a56c62658588.css integrity="sha512-zDlrrvUs2wpEMWCl98cMoSnHgU+NClSKc8a72vk/MUo7VINJk0RP8sv0vvysSd1TJNM16jCCKEDGiKVsYmWFiA=="><script type=text/javascript src=/js/appearance.min.12e98742cd283574d030a7fe55f29597df4ee214f7ff7075b4d19a64d046a602753c715295550be7899b661619cec89c679049d36c624681671a8013c1249896.js integrity="sha512-EumHQs0oNXTQMKf+VfKVl99O4hT3/3B1tNGaZNBGpgJ1PHFSlVUL54mbZhYZzsicZ5BJ02xiRoFnGoATwSSYlg=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9ae0a991bb442898e9bc60cf318b4de3ff878325ff3821625a5564b32b2f66aec0e7f7d0e00ca3ac7df59d9f01c18c88b6bdd213184f86ac9ce06d7bdffbadf8.js integrity="sha512-muCpkbtEKJjpvGDPMYtN4/+HgyX/OCFiWlVksysvZq7A5/fQ4AyjrH31nZ8BwYyItr3SExhPhqyc4G173/ut+A==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="EC2에서 ECR로 도커 이미지 푸시"><meta property="og:description" content="EC2에서 ECR로 도커 이미지 푸시하는 방법을 소개하는 글"><meta property="og:type" content="article"><meta property="og:url" content="https://seyslee.github.io/blog/docker-push-ecr-image/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-05-05T23:01:10+09:00"><meta property="article:modified_time" content="2022-05-11T14:05:15+09:00"><meta property="og:site_name" content="seyslee"><meta name=twitter:card content="summary"><meta name=twitter:title content="EC2에서 ECR로 도커 이미지 푸시"><meta name=twitter:description content="EC2에서 ECR로 도커 이미지 푸시하는 방법을 소개하는 글"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blogs","name":"EC2에서 ECR로 도커 이미지 푸시","headline":"EC2에서 ECR로 도커 이미지 푸시","description":"EC2에서 ECR로 도커 이미지 푸시하는 방법을 소개하는 글","abstract":"개요 # EC2에서 ECR Private 레포지터리로 도커 이미지를 푸시하는 방법을 소개한다.","inLanguage":"en","url":"https:\/\/seyslee.github.io\/blog\/docker-push-ecr-image\/","author":{"@type":"Person","name":"Younsung Lee"},"copyrightYear":"2022","dateCreated":"2022-05-05T23:01:10\u002b09:00","datePublished":"2022-05-05T23:01:10\u002b09:00","dateModified":"2022-05-11T14:05:15\u002b09:00","keywords":["docker","aws"],"mainEntityOfPage":"true","wordCount":"363"}]</script><meta name=author content="Younsung Lee"><link href=mailto:ivecloudblack@gmail.com rel=me><link href=https://github.com/seyslee rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>seyslee</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/ title=Blogs>post</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>tag</a></li></ul></nav></header><div class=relative><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">EC2에서 ECR로 도커 이미지 푸시</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-05-05 23:01:10 +0900 +0900">May 5, 2022</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2022-05-11 14:05:15 +0900 +0900">Updated: May 11, 2022</time></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#개요>개요</a></li><li><a href=#환경>환경</a></li><li><a href=#전제조건>전제조건</a></li><li><a href=#본문>본문</a><ul><li><ul><li><a href=#ecr-로그인>ECR 로그인</a></li><li><a href=#ecr-레포지터리-생성>ECR 레포지터리 생성</a></li><li><a href=#이미지-push>이미지 Push</a></li><li><a href=#결과-확인>결과 확인</a></li></ul></li></ul></li><li><a href=#참고자료>참고자료</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><h1 id=개요 class="relative group">개요 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b0%9c%ec%9a%94 aria-label=Anchor>#</a></span></h1><p>EC2에서 ECR Private 레포지터리로 도커 이미지를 푸시하는 방법을 소개한다.</p><p>구성도로 표현하면 다음과 같다.</p><p><figure><img class="my-0 rounded-md" src=./1.png alt></figure></p><br><h1 id=환경 class="relative group">환경 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%99%98%ea%b2%bd aria-label=Anchor>#</a></span></h1><ul><li><strong>OS</strong> : Ubuntu 20.04.3 LTS</li><li><strong>Shell</strong> : bash</li><li><strong>AWS CLI</strong> : 1.18.69</li><li><strong>Docker</strong> : 20.10.7</li></ul><br><h1 id=전제조건 class="relative group">전제조건 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%a0%84%ec%a0%9c%ec%a1%b0%ea%b1%b4 aria-label=Anchor>#</a></span></h1><p>EC2에 연결된 IAM Role<sup>Instance Profile</sup>에 ECR 업로드 권한이 부여되어 있어야 한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;Version&#34;: </span><span class=s2>&#34;2012-10-17&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&#34;Statement&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;Effect&#34;: </span><span class=s2>&#34;Allow&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;Action&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;ecr:Describe*&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;ecr:Get*&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;ecr:BatchCheckLayerAvailability&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;ecr:BatchGetImage&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;Resource&#34;: </span><span class=s2>&#34;*&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>}<span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;Effect&#34;: </span><span class=s2>&#34;Allow&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;Action&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;ecr:PutImage&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;ecr:InitiateLayerUpload&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;ecr:UploadLayerPart&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;ecr:CompleteLayerUpload&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;ecr:BatchDeleteImage&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>&#34;Resource&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s2>&#34;arn:aws:ecr:REGION:AWS_ACCOUNT_ID:repository/REPOSITORY_NAME&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}<span class=w>
</span></span></span></code></pre></div><p><code>REGION</code>, <code>AWS_ACCOUNT_ID</code>, <code>REPOSITORY_NAME</code> 값은 개인 환경마다 다르다. 꼭 변경해서 사용한다.</p><br><h1 id=본문 class="relative group">본문 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%b3%b8%eb%ac%b8 aria-label=Anchor>#</a></span></h1><h3 id=ecr-로그인 class="relative group">ECR 로그인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ecr-%eb%a1%9c%ea%b7%b8%ec%9d%b8 aria-label=Anchor>#</a></span></h3><p>현재 시스템에 AWS CLI가 설치된 걸 확인한다.<br>Amazon Linux 2 또는 Ubuntu 20.04.3 LTS 기준으로, OS에 AWS CLI가 기본적으로 설치되어 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ aws --version
</span></span><span class=line><span class=cl>aws-cli/1.18.69 Python/3.8.10 Linux/5.13.0-1017-aws botocore/1.16.19
</span></span></code></pre></div><p>AWS CLI <code>1.18.69</code> 버전이 설치된 걸 확인할 수 있다.</p><br><p>이미지를 푸시하려는 Amazon ECR<sup>Elastic Container Registry</sup> 레포지터리에 대해 Docker 클라이언트를 인증한다.</p><ul><li>이미지를 업로드할 ECR 레포지터리가 여러개일 경우, 인증 토큰을 각각 받아야 한다.</li><li>인증 토큰은 12시간 동안만 유효하다.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ aws ecr get-login-password --region REGION <span class=p>|</span> docker login --username AWS --password-stdin AWS_ACCOUNT_ID.dkr.ecr.REGION.amazonaws.com
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Login Succeeded
</span></span></code></pre></div><p><code>Login Succeeded</code> 메세지가 출력되면 로그인이 정상적으로 완료된 것이다.</p><br><h3 id=ecr-레포지터리-생성 class="relative group">ECR 레포지터리 생성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ecr-%eb%a0%88%ed%8f%ac%ec%a7%80%ed%84%b0%eb%a6%ac-%ec%83%9d%ec%84%b1 aria-label=Anchor>#</a></span></h3><p>AWS Management Console에 로그인한다.<br>이미지를 업로드하기 위해 ECR Private 레포지터리를 미리 생성해놓는다.</p><p><figure><img class="my-0 rounded-md" src=./2.png alt></figure></p><p>현재는 이미지가 없이 비어있는 ECR 레포지터리이다.</p><br><h3 id=이미지-push class="relative group">이미지 Push <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%9d%b4%eb%af%b8%ec%a7%80-push aria-label=Anchor>#</a></span></h3><p>ECR 레포지터리에 업로드할 도커 이미지를 확인한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker images
</span></span><span class=line><span class=cl>REPOSITORY               TAG       IMAGE ID       CREATED         SIZE
</span></span><span class=line><span class=cl>test-user/nginx          0.0.7     00ffc0fd000a   <span class=m>9</span> days ago      1.35GB
</span></span><span class=line><span class=cl>test-user/nginx          0.0.6     b0a00d000b00   <span class=m>9</span> days ago      1.35GB
</span></span></code></pre></div><p>내 경우 Image ID가 <code>00ffc0fd000a</code>인 이미지를 ECR 레지스트리에 업로드하려고 한다.</p><br><p>ECR 레지스트리에 업로드 할 이미지에 태그를 붙인다.</p><p><strong>명령어 형식</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker tag IMAGE_ID AWS_ACCOUNT_ID.dkr.ecr.REGION.amazonaws.com/ECR_REPOSITORY_NAME:TAG
</span></span></code></pre></div><br><p><strong>명령어 예시</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker tag 00ffc0fd000a 123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/repository:latest
</span></span></code></pre></div><br><p>태그를 붙인 이미지가 새로 추가된 걸 확인한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker images
</span></span><span class=line><span class=cl>REPOSITORY                                                    TAG       IMAGE ID       CREATED         SIZE
</span></span><span class=line><span class=cl>123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/repository  latest    00ffc0fd000a   <span class=m>9</span> days ago      1.35GB
</span></span><span class=line><span class=cl>test-user/nginx                                               0.0.7     00ffc0fd000a   <span class=m>9</span> days ago      1.35GB
</span></span><span class=line><span class=cl>test-user/nginx                                               0.0.6     b0a00d000b00   <span class=m>9</span> days ago      1.35GB
</span></span></code></pre></div><p>똑같은 이미지를 태그만 바꿔서 등록헀기 떄문에 IMAGE ID가 <code>34ffc1fd958a</code>로 동일하다는 점을 확인할 수 있다.</p><br><p>이미지를 ECR 레포지터리에 푸시한다.</p><p><strong>명령어 형식</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker push AWS_ACCOUNT_ID.dkr.ecr.REGION.amazonaws.com/ECR_REPISOTRY_NAME:TAG
</span></span></code></pre></div><p><code>AWS_ACCOUNT_ID</code>, <code>REGION</code>, <code>ECR_REPOSITORY_NAME</code>, <code>TAG</code> 값은 각자의 환경에 맞게 바꿔준다.</p><br><p><strong>명령어 예시</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker push 123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/repository:latest
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>latest: digest: sha256:18fxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx size: <span class=m>5584</span>
</span></span></code></pre></div><p>컨테이너 이미지를 ECR 레포지터리에 업로드 완료했다.</p><br><h3 id=결과-확인 class="relative group">결과 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b2%b0%ea%b3%bc-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h3><p>AWS Console 로그인 후 ECR Registry에서 이미지가 생성된 것을 확인할 수 있다.</p><p><figure><img class="my-0 rounded-md" src=./3.png alt></figure></p><p>이걸로 작업완료.</p><br><h1 id=참고자료 class="relative group">참고자료 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%b0%b8%ea%b3%a0%ec%9e%90%eb%a3%8c aria-label=Anchor>#</a></span></h1><p>ECR 업로드 작업 같은 경우는 AWS 공식문서에도 친절히 설명되어 있다.</p><p><strong>AWS 공식문서</strong><br><a href=https://docs.aws.amazon.com/ko_kr/AmazonECR/latest/userguide/docker-push-ecr-image.html>Docker 이미지 푸시</a></p></div></section><footer class="pt-8 max-w-prose print:hidden"><script src=https://utteranc.es/client.js repo=seyslee/seyslee.github.io issue-term=pathname label=blog-comment theme=github-dark crossorigin=anonymous async></script></footer></article></main><footer class="py-10 print:hidden"><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Younsung Lee</p></div></div></footer></div></body></html>