<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>리눅스 서버와 스토리지 볼륨 연결 &#183; seyslee</title><meta name=title content="리눅스 서버와 스토리지 볼륨 연결 &#183; seyslee"><meta name=description content="seyslee"><link rel=canonical href=https://seyslee.github.io/blog/implementing-storage-lun-on-linux/><link type=text/css rel=stylesheet href=/css/main.bundle.min.fff8ff4cdbe2bf80930c53b6e47a6d9826b914a8623246481ff09ff52ea48fcfb403d9ba1dc7bbc800a7ecb15298c468838a661dd8ebb3e9f46fdca239b38a30.css integrity="sha512-//j/TNviv4CTDFO25HptmCa5FKhiMkZIH/Cf9S6kj8+0A9m6Hce7yACn7LFSmMRog4pmHdjrs+n0b9yiObOKMA=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9947db70e5b36e741e53f8531bd734741b3fc7a688f7b5d749fc5433c48efc252f47bdf44e471570a550fc051b87712799014040e6349b38d64448b94e84e45a.js integrity="sha512-mUfbcOWzbnQeU/hTG9c0dBs/x6aI97XXSfxUM8SO/CUvR730TkcVcKVQ/AUbh3EnmQFAQOY0mzjWREi5ToTkWg==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="리눅스 서버와 스토리지 볼륨 연결"><meta property="og:description" content="리눅스 서버에 할당한 스토리지 LUN을 multipath를 이용해 연결하는 작업을 설명한다. 해당 메뉴얼에서는 LVM은 사용하지 않는다."><meta property="og:type" content="article"><meta property="og:url" content="https://seyslee.github.io/blog/implementing-storage-lun-on-linux/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-12-14T00:07:10+09:00"><meta property="article:modified_time" content="2021-12-14T00:08:15+09:00"><meta property="og:site_name" content="seyslee"><meta name=twitter:card content="summary"><meta name=twitter:title content="리눅스 서버와 스토리지 볼륨 연결"><meta name=twitter:description content="리눅스 서버에 할당한 스토리지 LUN을 multipath를 이용해 연결하는 작업을 설명한다. 해당 메뉴얼에서는 LVM은 사용하지 않는다."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blogs","name":"리눅스 서버와 스토리지 볼륨 연결","headline":"리눅스 서버와 스토리지 볼륨 연결","description":"리눅스 서버에 할당한 스토리지 LUN을 multipath를 이용해 연결하는 작업을 설명한다. 해당 메뉴얼에서는 LVM은 사용하지 않는다.","abstract":"# 개요 # 리눅스 서버에 할당한 스토리지 LUN을 multipath를 이용해 연결하는 작업을 설명한다.","inLanguage":"en","url":"https:\/\/seyslee.github.io\/blog\/implementing-storage-lun-on-linux\/","author":{"@type":"Person","name":"Younsung Lee"},"copyrightYear":"2021","dateCreated":"2021-12-14T00:07:10\u002b09:00","datePublished":"2021-12-14T00:07:10\u002b09:00","dateModified":"2021-12-14T00:08:15\u002b09:00","keywords":["os","linux","storage"],"mainEntityOfPage":"true","wordCount":"2181"}]</script><meta name=author content="Younsung Lee"><link href=mailto:ivecloudblack@gmail.com rel=me><link href=https://github.com/seyslee rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><nav class="flex justify-between"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>seyslee</a></div><ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row"><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/ title=Blogs>post</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>tag</a></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">리눅스 서버와 스토리지 볼륨 연결</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2021-12-14 00:07:10 +0900 +0900">Dec 14, 2021</time></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#heading></a></li><li><a href=#개요>개요</a></li><li><a href=#환경>환경</a></li><li><a href=#전제조건>전제조건</a></li><li><a href=#본론>본론</a><ul><li><a href=#san-구성>SAN 구성</a></li><li><a href=#사전작업>사전작업</a><ul><li></li></ul></li><li><a href=#multipath-설정>multipath 설정</a><ul><li></li></ul></li><li><a href=#파일시스템-작업>파일시스템 작업</a><ul><li></li></ul></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><h1 id=heading class="relative group"><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#heading aria-label=Anchor>#</a></span></h1><h1 id=개요 class="relative group">개요 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b0%9c%ec%9a%94 aria-label=Anchor>#</a></span></h1><p>리눅스 서버에 할당한 스토리지 LUN을 multipath를 이용해 연결하는 작업을 설명한다. 참고로 해당 시나리오에서는 LVM(Linux Volume Manager)를 사용하지 않는다.</p><br><h1 id=환경 class="relative group">환경 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%99%98%ea%b2%bd aria-label=Anchor>#</a></span></h1><ul><li><strong>Architecture</strong> : x86_64</li><li><strong>OS</strong> : CentOS release 5.x (Final)</li><li><strong>Shell</strong> : bash</li><li><strong>Package</strong> : device-mapper-multipath-0.4.7-59.el5</li></ul><br><h1 id=전제조건 class="relative group">전제조건 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%a0%84%ec%a0%9c%ec%a1%b0%ea%b1%b4 aria-label=Anchor>#</a></span></h1><ul><li><p>서버, SAN 스위치, 스토리지 간의 물리적 연결이 사전에 완료된 상태</p></li><li><p>서버의 OS, 아키텍처 버전에 맞는 multipath 패키지(<code>device-mapper-multipath</code>)가 설치된 상태여야함</p></li></ul><br><h1 id=본론 class="relative group">본론 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%b3%b8%eb%a1%a0 aria-label=Anchor>#</a></span></h1><h2 id=san-구성 class="relative group">SAN 구성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#san-%ea%b5%ac%ec%84%b1 aria-label=Anchor>#</a></span></h2><p>현재 시나리오의 SAN(Storage Area Network) 구성은 다음과 같다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>    FABRIC ARCHITECTURE                       
</span></span><span class=line><span class=cl>   +------------------+                       
</span></span><span class=line><span class=cl>   <span class=p>|</span>      <span class=m>1</span> LUN       <span class=p>|</span>                       
</span></span><span class=line><span class=cl>   <span class=p>|</span>  +-----------+   <span class=p>|</span>  <span class=o>===================</span>
</span></span><span class=line><span class=cl>   <span class=p>|</span>  <span class=p>|</span>  Storage  <span class=p>|</span>   <span class=p>|</span>  * LUN 용량 : 1TB
</span></span><span class=line><span class=cl>   <span class=p>|</span>  +-----------+   <span class=p>|</span>  <span class=o>===================</span>
</span></span><span class=line><span class=cl>   <span class=p>|</span>        ^         <span class=p>|</span>                       
</span></span><span class=line><span class=cl>   <span class=p>|</span>        <span class=p>|</span>         <span class=p>|</span>                       
</span></span><span class=line><span class=cl>   <span class=p>|</span>        v         <span class=p>|</span>                       
</span></span><span class=line><span class=cl>   <span class=p>|</span>  +-----------+   <span class=p>|</span>  <span class=o>===================</span>
</span></span><span class=line><span class=cl>   <span class=p>|</span>  <span class=p>|</span>SAN Switch <span class=p>|</span>   <span class=p>|</span>  * 8개의 다중경로로 구성함 
</span></span><span class=line><span class=cl>   <span class=p>|</span>  +-----------+   <span class=p>|</span>  <span class=o>===================</span>
</span></span><span class=line><span class=cl>   <span class=p>|</span>        ^         <span class=p>|</span>  
</span></span><span class=line><span class=cl>   <span class=p>|</span>        <span class=p>|</span>         <span class=p>|</span>                       
</span></span><span class=line><span class=cl>   <span class=p>|</span>        v         <span class=p>|</span>                       
</span></span><span class=line><span class=cl>   <span class=p>|</span>    multipath     <span class=p>|</span>                       
</span></span><span class=line><span class=cl>   <span class=p>|</span>  +-----------+   <span class=p>|</span>  <span class=o>===================</span>
</span></span><span class=line><span class=cl>   <span class=p>|</span>  <span class=p>|</span>  Server   <span class=p>|</span>   <span class=p>|</span>  * OS : CentOS 5.x
</span></span><span class=line><span class=cl>   <span class=p>|</span>  +-----------+   <span class=p>|</span>  <span class=o>===================</span>
</span></span><span class=line><span class=cl>   <span class=p>|</span>                  <span class=p>|</span>                       
</span></span><span class=line><span class=cl>   +------------------+
</span></span></code></pre></div><ul><li><p><strong>Storage</strong> : Server Host 등록, LUN 할당 작업이 완료된 상태</p></li><li><p><strong>SAN Switch</strong> : 서버와 스토리지가 광 케이블로 SAN 포트에 연결된 상태, 서버와 스토리지간 Zoning 작업이 완료된 상태</p></li><li><p><strong>Server</strong> : SAN Switch와 물리적으로 케이블이 연결된 상태</p></li></ul><br><h2 id=사전작업 class="relative group">사전작업 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%82%ac%ec%a0%84%ec%9e%91%ec%97%85 aria-label=Anchor>#</a></span></h2><h4 id=1-hba-카드-확인 class="relative group">1. HBA 카드 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-hba-%ec%b9%b4%eb%93%9c-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ lspci <span class=p>|</span> grep -i fibre
</span></span><span class=line><span class=cl>40:00.0 Fibre Channel: QLogic Corp. ISP2532-based 8Gb Fibre Channel to PCI Express HBA <span class=o>(</span>rev 02<span class=o>)</span>
</span></span><span class=line><span class=cl>40:00.1 Fibre Channel: QLogic Corp. ISP2532-based 8Gb Fibre Channel to PCI Express HBA <span class=o>(</span>rev 02<span class=o>)</span>
</span></span></code></pre></div><p>서버에 HBA 카드가 1개 장착된 상태이다.</p><br><h4 id=2-multipath-패키지-설치여부-확인 class="relative group">2. multipath 패키지 설치여부 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-multipath-%ed%8c%a8%ed%82%a4%ec%a7%80-%ec%84%a4%ec%b9%98%ec%97%ac%eb%b6%80-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ rpm -qa <span class=p>|</span> grep device-mapper-multipath
</span></span><span class=line><span class=cl>device-mapper-multipath-0.4.7-59.el5
</span></span></code></pre></div><p>이 서버에서는 <code>device-mapper-multipath 0.4.7</code> 버전이 이미 설치된 상태이다.</p><p>CentOS 5.x 기준으로 multipath 패키지는 기본적으로 OS 설치시 포함되어 있기 때문에, 별도로 multipath 패키지 설치가 필요 없었다.</p><br><h4 id=3-multipathd-실행여부-확인 class="relative group">3. multipathd 실행여부 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-multipathd-%ec%8b%a4%ed%96%89%ec%97%ac%eb%b6%80-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ps -ef <span class=p>|</span> grep multipathd
</span></span><span class=line><span class=cl>root      <span class=m>8474</span>  <span class=m>8427</span>  <span class=m>0</span> 18:14 pts/1    00:00:00 grep multipathd
</span></span></code></pre></div><p>multipath 데몬(<code>multipathd</code>)이 동작하고 있지 않다.</p><br><h4 id=4-multipathd-자동시작-활성화 class="relative group">4. multipathd 자동시작 활성화 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-multipathd-%ec%9e%90%eb%8f%99%ec%8b%9c%ec%9e%91-%ed%99%9c%ec%84%b1%ed%99%94 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ chkconfig --list multipathd
</span></span><span class=line><span class=cl>multipathd      0:off   1:off   2:off   3:off   4:off   5:off   6:off
</span></span></code></pre></div><p>모든 Run Level 1 ~ 5에서 <code>multipathd</code> 자동시작이 비활성화된 상태이다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ chkconfig --level <span class=m>35</span> multipathd on
</span></span></code></pre></div><p>Run Level 3과 Run Level 5 일 경우에만 <code>multipathd</code>가 자동시작 되도록 설정한다.</p><br><p><strong>Run Level</strong></p><ul><li><p><strong>3</strong> : Full multi user mode. CLI 기반의 다중 사용자 모드. 그래픽 사용자 환경(GUI)을 지원하지 않는다.</p></li><li><p><strong>5</strong> : Run Level 3과 유사하나, X11 GUI를 지원.</p></li></ul><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ chkconfig --list multipathd
</span></span><span class=line><span class=cl>multipathd      0:off   1:off   2:off   3:on    4:off   5:on    6:off
</span></span></code></pre></div><p>앞으로 <code>multipathd</code>는 Run Level 3과 5일 경우 자동시작된다.</p><br><h4 id=5-multipathd-실행 class="relative group">5. multipathd 실행 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-multipathd-%ec%8b%a4%ed%96%89 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ service multipathd start
</span></span><span class=line><span class=cl>Starting multipathd daemon: <span class=o>[</span>  OK  <span class=o>]</span>
</span></span></code></pre></div><p><code>multipathd</code>를 시작한다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ps -ef <span class=p>|</span> grep multipathd <span class=p>|</span> grep -v grep
</span></span><span class=line><span class=cl>root     <span class=m>16274</span>     <span class=m>1</span>  <span class=m>0</span> 20:50 ?        00:00:00 /sbin/multipathd
</span></span></code></pre></div><p><code>multipathd</code> 가 작동중이다.</p><br><h2 id=multipath-설정 class="relative group">multipath 설정 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#multipath-%ec%84%a4%ec%a0%95 aria-label=Anchor>#</a></span></h2><h4 id=6-모듈-생성 class="relative group">6. 모듈 생성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#6-%eb%aa%a8%eb%93%88-%ec%83%9d%ec%84%b1 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ modprobe dm-multipath
</span></span></code></pre></div><p>multipath 사용을 위해 dm-multipath 모듈을 올린다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ partprobe
</span></span></code></pre></div><p><code>partprobe</code> 명령어를 실행해서 리부팅 없이도 파티션 변경사항을 적용할 수 있다. 명령어가 정상적으로 실행 완료되면 별도로 출력 메세지는 나오지 않는다.</p><br><h4 id=7-lun-rescan class="relative group">7. LUN Rescan <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#7-lun-rescan aria-label=Anchor>#</a></span></h4><p><code>systool</code> 명령어를 이용해서 FC 포트의 구성과 이름 정보를 수집한다. 참고로 <code>systool</code> 명령어는 sysfsutils 패키지가 설치되어야 사용 가능하다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ systool -c fc_host
</span></span><span class=line><span class=cl><span class=nv>Class</span> <span class=o>=</span> <span class=s2>&#34;fc_host&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Class <span class=nv>Device</span> <span class=o>=</span> <span class=s2>&#34;host7&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>Device</span> <span class=o>=</span> <span class=s2>&#34;host7&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Class <span class=nv>Device</span> <span class=o>=</span> <span class=s2>&#34;host8&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>Device</span> <span class=o>=</span> <span class=s2>&#34;host8&#34;</span>
</span></span></code></pre></div><p>해당 서버에서 <code>host7</code>, <code>host8</code> 이라는 이름의 2개의 광 포트(FC)를 사용중이다.</p><br><p>스토리지에서 LUN 할당 작업이 이미 끝난 상태라면, 서버에서 LUN을 재인식(Rescan)하도록 명령어를 실행한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s2>&#34;1&#34;</span> &gt; /sys/class/fc_host/host7/issue_lip
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s2>&#34;1&#34;</span> &gt; /sys/class/fc_host/host8/issue_lip
</span></span></code></pre></div><p>위의 <code>host7</code>, <code>host8</code> 값은 각 서버마다 다르기 때문에 변경될 수 있다.<br><code>systool -c fc_host</code> 명령어로 반드시 각자의 서버 환경에서 확인한다.</p><br><h4 id=8-wwid-확인 class="relative group">8. WWID 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#8-wwid-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ scsi_id -g -u -s /block/sdb
</span></span><span class=line><span class=cl>36006016035303900df9eaf55ec5bec11
</span></span><span class=line><span class=cl>$ scsi_id -g -u -s /block/sdc
</span></span><span class=line><span class=cl>36006016035303900df9eaf55ec5bec11
</span></span><span class=line><span class=cl>$ scsi_id -g -u -s /block/sdd
</span></span><span class=line><span class=cl>36006016035303900df9eaf55ec5bec11
</span></span><span class=line><span class=cl>$ scsi_id -g -u -s /block/sde
</span></span><span class=line><span class=cl>36006016035303900df9eaf55ec5bec11
</span></span><span class=line><span class=cl>$ scsi_id -g -u -s /block/sdf
</span></span><span class=line><span class=cl>36006016035303900df9eaf55ec5bec11
</span></span><span class=line><span class=cl>$ scsi_id -g -u -s /block/sdg
</span></span><span class=line><span class=cl>36006016035303900df9eaf55ec5bec11
</span></span><span class=line><span class=cl>$ scsi_id -g -u -s /block/sdh
</span></span><span class=line><span class=cl>36006016035303900df9eaf55ec5bec11
</span></span><span class=line><span class=cl>$ scsi_id -g -u -s /block/sdi 
</span></span><span class=line><span class=cl>36006016035303900df9eaf55ec5bec11
</span></span></code></pre></div><p><code>/block/sdb</code> 부터 <code>/block/sdi</code> 까지 모두 동일한 WWID를 가지고 있다. <code>/block/sda</code>는 OS가 설치된 로컬 디스크이다.</p><p>여러개의 장치의 WWID가 같다는 것은 물리적으로 동일한 스토리지의 LUN이 여러개로 나타났다는 의미이다.</p><br><h4 id=9-multipath-설정파일-수정 class="relative group">9. multipath 설정파일 수정 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#9-multipath-%ec%84%a4%ec%a0%95%ed%8c%8c%ec%9d%bc-%ec%88%98%ec%a0%95 aria-label=Anchor>#</a></span></h4><p><strong>blacklist 해제</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/multipath.conf <span class=p>|</span> grep -v ^# <span class=p>|</span> grep -v ^$
</span></span><span class=line><span class=cl>blacklist <span class=o>{</span>
</span></span><span class=line><span class=cl>        devnode <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>defaults <span class=o>{</span>
</span></span><span class=line><span class=cl>        user_friendly_names yes
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>multipath 설정파일의 기본값은 모든 Device를 차단하도록 설정되어 있다.
라인 맨 앞에 <code>#</code>을 붙여서 <code>blacklist { ... }</code> 영역을 주석처리한다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/multipath.conf <span class=p>|</span> grep -v ^# <span class=p>|</span> grep -v ^$
</span></span><span class=line><span class=cl><span class=c1>#blacklist {</span>
</span></span><span class=line><span class=cl><span class=c1>#        devnode &#34;*&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#}</span>
</span></span><span class=line><span class=cl>defaults <span class=o>{</span>
</span></span><span class=line><span class=cl>        user_friendly_names yes
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>이제 <code>multipaths { ... }</code> 구문에 동일한 WWID 값을 추가한다.</p><br><p><strong>multipaths 작성</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/multipath.conf <span class=p>|</span> grep -v ^$
</span></span><span class=line><span class=cl><span class=c1>#blacklist {</span>
</span></span><span class=line><span class=cl><span class=c1>#        devnode &#34;*&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#}</span>
</span></span><span class=line><span class=cl>defaults <span class=o>{</span>
</span></span><span class=line><span class=cl>        user_friendly_names yes
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>multipaths <span class=o>{</span>
</span></span><span class=line><span class=cl>        multipath <span class=o>{</span>
</span></span><span class=line><span class=cl>                wwid  36006016035303900df9eaf55ec5bec11
</span></span><span class=line><span class=cl>                <span class=nb>alias</span> mpath1
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>OS가 설치된 영역이자 로컬 디스크인 <code>/dev/sda</code>의 WWID를 확인한다.</p><br><p><strong>로컬디스크 제외</strong></p><p><code>/dev/sda</code> 장치는 OS가 설치된 로컬디스크다.</p><p>multipath에서 로컬 디스크를 자동으로 설정을 잡을 경우 문제가 발생할 수 있으므로, 로컬 디스크를 multipath에서 잡지 않도록 blacklist 설정한다.</p><p>/sda의 WWID를 조회한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ scsi_id -g -u -s /block/sda
</span></span><span class=line><span class=cl>3600508e000000000d7ca736cf72d740c
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/multipath.conf <span class=p>|</span> grep -v ^$ <span class=p>|</span> grep -v ^#
</span></span><span class=line><span class=cl>blacklist <span class=o>{</span>
</span></span><span class=line><span class=cl>        wwid 3600508e000000000d7ca736cf72d740c
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>defaults <span class=o>{</span>
</span></span><span class=line><span class=cl>        user_friendly_names yes
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>multipaths <span class=o>{</span>
</span></span><span class=line><span class=cl>        multipath <span class=o>{</span>
</span></span><span class=line><span class=cl>                wwid  36006016035303900df9eaf55ec5bec11
</span></span><span class=line><span class=cl>                <span class=nb>alias</span> mpath1
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>blacklist의 주석을 해제한 후 multipath에서 자동 설정을 잡지 않도록, <code>/dev/sda</code>의 WWID를 추가해준다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ service multipathd reload
</span></span><span class=line><span class=cl>Reloading multipathd: <span class=o>[</span>  OK  <span class=o>]</span>
</span></span></code></pre></div><p>변경된 설정을 적용하기 위해 multipathd를 reload 한다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ service multipathd status
</span></span><span class=line><span class=cl>multipathd <span class=o>(</span>pid  12269<span class=o>)</span> is running...
</span></span></code></pre></div><p>multipathd 가 정상 실행중이다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ multipath -v2
</span></span></code></pre></div><p>명령어 결과로 아무런 출력이 없으면 현재 서버와 스토리지의 구성 문제는 없다는 의미이다.</p><p>이제 LUN이 멀티패스 구성이 됐는지 확인한다.</p><br><h4 id=10-multipath-구성-확인 class="relative group">10. multipath 구성 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#10-multipath-%ea%b5%ac%ec%84%b1-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ multipath -ll
</span></span><span class=line><span class=cl>mpath1 <span class=o>(</span>36006016035303900df9eaf55ec5bec11<span class=o>)</span> dm-0 DGC,VRAID
</span></span><span class=line><span class=cl><span class=o>[</span><span class=nv>size</span><span class=o>=</span>1.0T<span class=o>][</span><span class=nv>features</span><span class=o>=</span><span class=m>1</span> queue_if_no_path<span class=o>][</span><span class=nv>hwhandler</span><span class=o>=</span><span class=m>1</span> emc<span class=o>][</span>rw<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=se>\_</span> round-robin <span class=m>0</span> <span class=o>[</span><span class=nv>prio</span><span class=o>=</span>1<span class=o>][</span>active<span class=o>]</span>
</span></span><span class=line><span class=cl> <span class=se>\_</span> 7:0:2:0 sdd 8:48  <span class=o>[</span>active<span class=o>][</span>ready<span class=o>]</span>
</span></span><span class=line><span class=cl> <span class=se>\_</span> 7:0:3:0 sde 8:64  <span class=o>[</span>active<span class=o>][</span>ready<span class=o>]</span>
</span></span><span class=line><span class=cl> <span class=se>\_</span> 8:0:2:0 sdh 8:112 <span class=o>[</span>active<span class=o>][</span>ready<span class=o>]</span>
</span></span><span class=line><span class=cl> <span class=se>\_</span> 8:0:3:0 sdi 8:128 <span class=o>[</span>active<span class=o>][</span>ready<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=se>\_</span> round-robin <span class=m>0</span> <span class=o>[</span><span class=nv>prio</span><span class=o>=</span>0<span class=o>][</span>enabled<span class=o>]</span>
</span></span><span class=line><span class=cl> <span class=se>\_</span> 7:0:0:0 sdb 8:16  <span class=o>[</span>active<span class=o>][</span>ready<span class=o>]</span>
</span></span><span class=line><span class=cl> <span class=se>\_</span> 7:0:1:0 sdc 8:32  <span class=o>[</span>active<span class=o>][</span>ready<span class=o>]</span>
</span></span><span class=line><span class=cl> <span class=se>\_</span> 8:0:0:0 sdf 8:80  <span class=o>[</span>active<span class=o>][</span>ready<span class=o>]</span>
</span></span><span class=line><span class=cl> <span class=se>\_</span> 8:0:1:0 sdg 8:96  <span class=o>[</span>active<span class=o>][</span>ready<span class=o>]</span>
</span></span></code></pre></div><p>1개의 LUN이 8개의 경로로 멀티패스가 구성되었다. multipath 경로 개수는 각자 구축한 환경에 따라 다르다.</p><p>해당 시나리오의 경우, 8개의 multipath 경로를 잡도록 SAN 스위치와 스토리지 부분에서 Zoning 설정을 의도했다.</p><br><h2 id=파일시스템-작업 class="relative group">파일시스템 작업 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%8c%8c%ec%9d%bc%ec%8b%9c%ec%8a%a4%ed%85%9c-%ec%9e%91%ec%97%85 aria-label=Anchor>#</a></span></h2><h4 id=11-파일시스템-생성 class="relative group">11. 파일시스템 생성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#11-%ed%8c%8c%ec%9d%bc%ec%8b%9c%ec%8a%a4%ed%85%9c-%ec%83%9d%ec%84%b1 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mkfs.ext3 /dev/mapper/mpath1 
</span></span><span class=line><span class=cl>mke2fs 1.39 <span class=o>(</span>29-May-2006<span class=o>)</span>
</span></span><span class=line><span class=cl>Filesystem <span class=nv>label</span><span class=o>=</span>
</span></span><span class=line><span class=cl>OS type: Linux
</span></span><span class=line><span class=cl>Block <span class=nv>size</span><span class=o>=</span><span class=m>4096</span> <span class=o>(</span><span class=nv>log</span><span class=o>=</span>2<span class=o>)</span>
</span></span><span class=line><span class=cl>Fragment <span class=nv>size</span><span class=o>=</span><span class=m>4096</span> <span class=o>(</span><span class=nv>log</span><span class=o>=</span>2<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=m>134217728</span> inodes, <span class=m>268435456</span> blocks
</span></span><span class=line><span class=cl><span class=m>13421772</span> blocks <span class=o>(</span>5.00%<span class=o>)</span> reserved <span class=k>for</span> the super user
</span></span><span class=line><span class=cl>First data <span class=nv>block</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>Maximum filesystem <span class=nv>blocks</span><span class=o>=</span><span class=m>4294967296</span>
</span></span><span class=line><span class=cl><span class=m>8192</span> block groups
</span></span><span class=line><span class=cl><span class=m>32768</span> blocks per group, <span class=m>32768</span> fragments per group
</span></span><span class=line><span class=cl><span class=m>16384</span> inodes per group
</span></span><span class=line><span class=cl>Superblock backups stored on blocks: 
</span></span><span class=line><span class=cl>        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
</span></span><span class=line><span class=cl>        4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968, 
</span></span><span class=line><span class=cl>        102400000, <span class=m>214990848</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Writing inode tables: <span class=k>done</span>                            
</span></span><span class=line><span class=cl>Creating journal <span class=o>(</span><span class=m>32768</span> blocks<span class=o>)</span>: <span class=k>done</span>
</span></span><span class=line><span class=cl>Writing superblocks and filesystem accounting information: <span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>This filesystem will be automatically checked every <span class=m>38</span> mounts or
</span></span><span class=line><span class=cl><span class=m>180</span> days, whichever comes first.  Use tune2fs -c or -i to override.
</span></span></code></pre></div><p>이 시나리오의 경우는 스토리지의 볼륨을 ext3 타입으로 파일시스템을 생성해서 사용한다.
만약 ext4 타입으로 생성하고 싶다면, <code>mkfs.ext4 /dev/mapper/mpath1</code> 명령어를 이용하면 된다.</p><br><h4 id=12-파티션-구성 class="relative group">12. 파티션 구성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#12-%ed%8c%8c%ed%8b%b0%ec%85%98-%ea%b5%ac%ec%84%b1 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ fdisk -l          
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Disk /dev/sda: 298.9 GB, <span class=m>298999349248</span> bytes
</span></span><span class=line><span class=cl><span class=m>255</span> heads, <span class=m>63</span> sectors/track, <span class=m>36351</span> cylinders
</span></span><span class=line><span class=cl><span class=nv>Units</span> <span class=o>=</span> cylinders of <span class=m>16065</span> * <span class=nv>512</span> <span class=o>=</span> <span class=m>8225280</span> bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Device Boot      Start         End      Blocks   Id  System
</span></span><span class=line><span class=cl>/dev/sda1   *           <span class=m>1</span>         <span class=m>131</span>     <span class=m>1052226</span>   <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>/dev/sda2             <span class=m>132</span>       <span class=m>17624</span>   140512522+  <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>/dev/sda3           <span class=m>17625</span>       <span class=m>21801</span>    33551752+  <span class=m>82</span>  Linux swap / Solaris
</span></span><span class=line><span class=cl>/dev/sda4           <span class=m>21802</span>       <span class=m>36351</span>   <span class=m>116872875</span>    <span class=m>5</span>  Extended
</span></span><span class=line><span class=cl>/dev/sda5           <span class=m>21802</span>       <span class=m>24412</span>    <span class=m>20972826</span>   <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>/dev/sda6           <span class=m>24413</span>       <span class=m>27023</span>    <span class=m>20972826</span>   <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>/dev/sda7           <span class=m>27024</span>       <span class=m>29634</span>    <span class=m>20972826</span>   <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>/dev/sda8           <span class=m>29635</span>       <span class=m>36351</span>    <span class=m>53954271</span>   <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.....
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Disk /dev/dm-0: 1099.5 GB, <span class=m>1099511627776</span> bytes
</span></span><span class=line><span class=cl><span class=m>255</span> heads, <span class=m>63</span> sectors/track, <span class=m>133674</span> cylinders
</span></span><span class=line><span class=cl><span class=nv>Units</span> <span class=o>=</span> cylinders of <span class=m>16065</span> * <span class=nv>512</span> <span class=o>=</span> <span class=m>8225280</span> bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     Device Boot      Start         End      Blocks   Id  System
</span></span></code></pre></div><p><code>/dev/dm-0</code> 의 전체 용량을 파티션 1개로 잡을 예정이다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ fdisk /dev/mapper/mpath1
</span></span></code></pre></div><p><code>/dev/mapper/mpath1</code> 디스크를 파티션 설정하기 위해 <code>fdisk</code> 명령어를 실행한다.</p><br><p><code>p</code> 키를 입력해서 파티션 정보를 출력한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ fdisk /dev/mapper/mpath1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The number of cylinders <span class=k>for</span> this disk is <span class=nb>set</span> to 133674.
</span></span><span class=line><span class=cl>There is nothing wrong with that, but this is larger than 1024,
</span></span><span class=line><span class=cl>and could in certain setups cause problems with:
</span></span><span class=line><span class=cl>1<span class=o>)</span> software that runs at boot <span class=nb>time</span> <span class=o>(</span>e.g., old versions of LILO<span class=o>)</span>
</span></span><span class=line><span class=cl>2<span class=o>)</span> booting and partitioning software from other OSs
</span></span><span class=line><span class=cl>   <span class=o>(</span>e.g., DOS FDISK, OS/2 FDISK<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Command <span class=o>(</span>m <span class=k>for</span> <span class=nb>help</span><span class=o>)</span>: p
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Disk /dev/mapper/mpath1: 1099.5 GB, <span class=m>1099511627776</span> bytes
</span></span><span class=line><span class=cl><span class=m>255</span> heads, <span class=m>63</span> sectors/track, <span class=m>133674</span> cylinders
</span></span><span class=line><span class=cl><span class=nv>Units</span> <span class=o>=</span> cylinders of <span class=m>16065</span> * <span class=nv>512</span> <span class=o>=</span> <span class=m>8225280</span> bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                           Device Boot      Start         End      Blocks   Id  System
</span></span></code></pre></div><p>아직 아무런 파티션 설정이 없기 때문에, 출력값은 없다.</p><br><p>새 파티션을 생성하기 위해 <code>n</code> 키를 입력</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Command <span class=o>(</span>m <span class=k>for</span> <span class=nb>help</span><span class=o>)</span>: n
</span></span></code></pre></div><br><p>primary partition으로 생성을 위해 <code>p</code> 키를 입력한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Command <span class=o>(</span>m <span class=k>for</span> <span class=nb>help</span><span class=o>)</span>: n
</span></span><span class=line><span class=cl>Command action
</span></span><span class=line><span class=cl>   e   extended
</span></span><span class=line><span class=cl>   p   primary partition <span class=o>(</span>1-4<span class=o>)</span>
</span></span><span class=line><span class=cl>p
</span></span></code></pre></div><br><p>지금부터는 파티션 생성시 설정 단계이다.</p><p><code>[Enter]</code> 키는 기본값(<code>default ...</code>) 을 쓰기 위해 입력해준다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Partition number <span class=o>(</span>1-4<span class=o>)</span>: <span class=m>1</span>
</span></span><span class=line><span class=cl>First cylinder <span class=o>(</span>1-133674, default 1<span class=o>)</span>: <span class=o>[</span>Enter<span class=o>]</span>
</span></span><span class=line><span class=cl>Using default value <span class=m>1</span>
</span></span><span class=line><span class=cl>Last cylinder or +size or +sizeM or +sizeK <span class=o>(</span>1-133674, default 133674<span class=o>)</span>: <span class=o>[</span>Enter<span class=o>]</span>
</span></span><span class=line><span class=cl>Using default value <span class=m>133674</span>
</span></span></code></pre></div><br><p><code>p</code> 키 입력 : 생성된 파티션 목록 출력(print)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Command <span class=o>(</span>m <span class=k>for</span> <span class=nb>help</span><span class=o>)</span>: p
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Disk /dev/mapper/mpath1: 1099.5 GB, <span class=m>1099511627776</span> bytes
</span></span><span class=line><span class=cl><span class=m>255</span> heads, <span class=m>63</span> sectors/track, <span class=m>133674</span> cylinders
</span></span><span class=line><span class=cl><span class=nv>Units</span> <span class=o>=</span> cylinders of <span class=m>16065</span> * <span class=nv>512</span> <span class=o>=</span> <span class=m>8225280</span> bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                           Device Boot      Start         End      Blocks   Id  System
</span></span><span class=line><span class=cl>/dev/mapper/mpath1p1                             <span class=m>1</span>      <span class=m>133674</span>  1073736373+  <span class=m>83</span>  Linux
</span></span></code></pre></div><p><code>mpath1p1</code> : 해당 디스크(<code>mpath1</code>)의 첫번째 파티션(<code>p1</code>)을 의미한다.</p><br><p><code>w</code> 입력 : 생성한 파티션을 영구적으로 디스크에 적용(write)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Command <span class=o>(</span>m <span class=k>for</span> <span class=nb>help</span><span class=o>)</span>: w
</span></span><span class=line><span class=cl>The partition table has been altered!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Calling ioctl<span class=o>()</span> to re-read partition table.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>WARNING: Re-reading the partition table failed with error 22: Invalid argument.
</span></span><span class=line><span class=cl>The kernel still uses the old table.
</span></span><span class=line><span class=cl>The new table will be used at the next reboot.
</span></span><span class=line><span class=cl>Syncing disks.
</span></span></code></pre></div><p>정상적으로 파티션 구성이 완료되면 fdisk 프롬프트에서 Shell 프롬프트로 돌아온다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.....
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>WARNING: Re-reading the partition table failed with error 22: Invalid argument.
</span></span><span class=line><span class=cl>The kernel still uses the old table.
</span></span><span class=line><span class=cl>The new table will be used at the next reboot.
</span></span><span class=line><span class=cl>Syncing disks.
</span></span><span class=line><span class=cl>$
</span></span></code></pre></div><p>파티션 설정을 적용한 후 shell로 자동으로 돌아왔다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ partprobe
</span></span></code></pre></div><p><code>partprobe</code> 명령어로 파티션의 변경사항을 전체 멀티패스 볼륨에 반영한다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ fdisk -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Disk /dev/sda: 298.9 GB, <span class=m>298999349248</span> bytes
</span></span><span class=line><span class=cl><span class=m>255</span> heads, <span class=m>63</span> sectors/track, <span class=m>36351</span> cylinders
</span></span><span class=line><span class=cl><span class=nv>Units</span> <span class=o>=</span> cylinders of <span class=m>16065</span> * <span class=nv>512</span> <span class=o>=</span> <span class=m>8225280</span> bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Device Boot      Start         End      Blocks   Id  System
</span></span><span class=line><span class=cl>/dev/sda1   *           <span class=m>1</span>         <span class=m>131</span>     <span class=m>1052226</span>   <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>/dev/sda2             <span class=m>132</span>       <span class=m>17624</span>   140512522+  <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>/dev/sda3           <span class=m>17625</span>       <span class=m>21801</span>    33551752+  <span class=m>82</span>  Linux swap / Solaris
</span></span><span class=line><span class=cl>/dev/sda4           <span class=m>21802</span>       <span class=m>36351</span>   <span class=m>116872875</span>    <span class=m>5</span>  Extended
</span></span><span class=line><span class=cl>/dev/sda5           <span class=m>21802</span>       <span class=m>24412</span>    <span class=m>20972826</span>   <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>/dev/sda6           <span class=m>24413</span>       <span class=m>27023</span>    <span class=m>20972826</span>   <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>/dev/sda7           <span class=m>27024</span>       <span class=m>29634</span>    <span class=m>20972826</span>   <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>/dev/sda8           <span class=m>29635</span>       <span class=m>36351</span>    <span class=m>53954271</span>   <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Disk /dev/sdd: 1099.5 GB, <span class=m>1099511627776</span> bytes
</span></span><span class=line><span class=cl><span class=m>255</span> heads, <span class=m>63</span> sectors/track, <span class=m>133674</span> cylinders
</span></span><span class=line><span class=cl><span class=nv>Units</span> <span class=o>=</span> cylinders of <span class=m>16065</span> * <span class=nv>512</span> <span class=o>=</span> <span class=m>8225280</span> bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Device Boot      Start         End      Blocks   Id  System
</span></span><span class=line><span class=cl>/dev/sdd1               <span class=m>1</span>      <span class=m>133674</span>  1073736373+  <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Disk /dev/sde: 1099.5 GB, <span class=m>1099511627776</span> bytes
</span></span><span class=line><span class=cl><span class=m>255</span> heads, <span class=m>63</span> sectors/track, <span class=m>133674</span> cylinders
</span></span><span class=line><span class=cl><span class=nv>Units</span> <span class=o>=</span> cylinders of <span class=m>16065</span> * <span class=nv>512</span> <span class=o>=</span> <span class=m>8225280</span> bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Device Boot      Start         End      Blocks   Id  System
</span></span><span class=line><span class=cl>/dev/sde1               <span class=m>1</span>      <span class=m>133674</span>  1073736373+  <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Disk /dev/sdh: 1099.5 GB, <span class=m>1099511627776</span> bytes
</span></span><span class=line><span class=cl><span class=m>255</span> heads, <span class=m>63</span> sectors/track, <span class=m>133674</span> cylinders
</span></span><span class=line><span class=cl><span class=nv>Units</span> <span class=o>=</span> cylinders of <span class=m>16065</span> * <span class=nv>512</span> <span class=o>=</span> <span class=m>8225280</span> bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Device Boot      Start         End      Blocks   Id  System
</span></span><span class=line><span class=cl>/dev/sdh1               <span class=m>1</span>      <span class=m>133674</span>  1073736373+  <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Disk /dev/sdi: 1099.5 GB, <span class=m>1099511627776</span> bytes
</span></span><span class=line><span class=cl><span class=m>255</span> heads, <span class=m>63</span> sectors/track, <span class=m>133674</span> cylinders
</span></span><span class=line><span class=cl><span class=nv>Units</span> <span class=o>=</span> cylinders of <span class=m>16065</span> * <span class=nv>512</span> <span class=o>=</span> <span class=m>8225280</span> bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Device Boot      Start         End      Blocks   Id  System
</span></span><span class=line><span class=cl>/dev/sdi1               <span class=m>1</span>      <span class=m>133674</span>  1073736373+  <span class=m>83</span>  Linux
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Disk /dev/dm-0: 1099.5 GB, <span class=m>1099511627776</span> bytes
</span></span><span class=line><span class=cl><span class=m>255</span> heads, <span class=m>63</span> sectors/track, <span class=m>133674</span> cylinders
</span></span><span class=line><span class=cl><span class=nv>Units</span> <span class=o>=</span> cylinders of <span class=m>16065</span> * <span class=nv>512</span> <span class=o>=</span> <span class=m>8225280</span> bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     Device Boot      Start         End      Blocks   Id  System
</span></span><span class=line><span class=cl>/dev/dm-0p1               <span class=m>1</span>      <span class=m>133674</span>  1073736373+  <span class=m>83</span>  Linux
</span></span></code></pre></div><p>partprobe 명령어를 실행한 후, 멀티패스로 구성된 디바이스 <code>/dev/sdd</code> ~ <code>/dev/sdi</code> 전체가 <code>/dev/dm-0</code> 과 동일한 파티션 정보를 갖게 되었다.</p><br><h4 id=13-마운트 class="relative group">13. 마운트 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#13-%eb%a7%88%ec%9a%b4%ed%8a%b8 aria-label=Anchor>#</a></span></h4><p>마운트 지점이 될 디렉토리를 새로 생성한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mkdir /appdata
</span></span></code></pre></div><br><p>multipath 구성이된 device(<code>/dev/mapper/mpath1</code>)를 마운트 지점(디렉토리)에 마운트한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mount /dev/mapper/mpath1 /appdata
</span></span></code></pre></div><br><p><strong>파일시스템 확인</strong></p><p>파일시스템 리스트 결과를 보기 편하게 정렬하려면 <code>column -t</code> 명령어를 조합해서 실행한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ df -Ph <span class=p>|</span> column -t
</span></span><span class=line><span class=cl>Filesystem                        Size   Used  Avail  Use%  Mounted    on
</span></span><span class=line><span class=cl>/dev/sda8                         50G    499M  47G    2%    /
</span></span><span class=line><span class=cl>/dev/sda7                         20G    2.7G  16G    15%   /usr
</span></span><span class=line><span class=cl>/dev/sda6                         20G    238M  19G    2%    /var
</span></span><span class=line><span class=cl>/dev/sda5                         20G    174M  19G    1%    /home
</span></span><span class=line><span class=cl>/dev/sda2                         130G   188M  123G   1%    /test
</span></span><span class=line><span class=cl>/dev/sda1                         996M   41M   904M   5%    /boot
</span></span><span class=line><span class=cl>tmpfs                             7.9G   <span class=m>0</span>     7.9G   0%    /dev/shm
</span></span><span class=line><span class=cl>/dev/mapper/mpath1                1008G  200M  957G   1%    /appdata
</span></span></code></pre></div><p><code>/dev/mapper/mpath1</code> 파일시스템이 새로 생성되었다. 마운트 지점은 <code>/appdata</code> 이다.</p><br><h4 id=14-자동-마운트-설정 class="relative group">14. 자동 마운트 설정 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#14-%ec%9e%90%eb%8f%99-%eb%a7%88%ec%9a%b4%ed%8a%b8-%ec%84%a4%ec%a0%95 aria-label=Anchor>#</a></span></h4><p>서버 리부팅 후에도 스토리지 볼륨이 자동으로 마운트되도록 파일시스템 설정파일(<code>/etc/fstab</code>)에 등록한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/fstab
</span></span><span class=line><span class=cl><span class=nv>LABEL</span><span class=o>=</span>/                 /                       ext3    defaults        <span class=m>1</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>LABEL</span><span class=o>=</span>/usr              /usr                    ext3    defaults        <span class=m>1</span> <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=nv>LABEL</span><span class=o>=</span>/var              /var                    ext3    defaults        <span class=m>1</span> <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=nv>LABEL</span><span class=o>=</span>/home             /home                   ext3    defaults        <span class=m>1</span> <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=nv>LABEL</span><span class=o>=</span>/test             /test                   ext3    defaults        <span class=m>1</span> <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=nv>LABEL</span><span class=o>=</span>/boot             /boot                   ext3    defaults        <span class=m>1</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>/dev/mapper/mpath1      /appdata                ext3    defaults        <span class=m>0</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>tmpfs                   /dev/shm                tmpfs   defaults        <span class=m>0</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>devpts                  /dev/pts                devpts  <span class=nv>gid</span><span class=o>=</span>5,mode<span class=o>=</span><span class=m>620</span>  <span class=m>0</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>sysfs                   /sys                    sysfs   defaults        <span class=m>0</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>proc                    /proc                   proc    defaults        <span class=m>0</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=nv>LABEL</span><span class=o>=</span>SWAP-sda3         swap                    swap    defaults        <span class=m>0</span> <span class=m>0</span>
</span></span></code></pre></div><br><h4 id=15-파일-생성삭제-테스트 class="relative group">15. 파일 생성/삭제 테스트 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#15-%ed%8c%8c%ec%9d%bc-%ec%83%9d%ec%84%b1%ec%82%ad%ec%a0%9c-%ed%85%8c%ec%8a%a4%ed%8a%b8 aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ dd <span class=k>if</span><span class=o>=</span>/dev/zero <span class=nv>of</span><span class=o>=</span>/appdata/write_test.tmp <span class=nv>bs</span><span class=o>=</span>1G <span class=nv>count</span><span class=o>=</span><span class=m>10</span>
</span></span><span class=line><span class=cl>10+0 records in
</span></span><span class=line><span class=cl>10+0 records out
</span></span><span class=line><span class=cl><span class=m>10737418240</span> bytes <span class=o>(</span><span class=m>11</span> GB<span class=o>)</span> copied, 15.7843 seconds, <span class=m>680</span> MB/s
</span></span></code></pre></div><p><code>dd</code> 명령어를 이용해서 새롭게 만든 파일시스템 안에 10GB 크기의 <code>write_test.tmp</code> 파일을 생성(Write)해본다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ls -lh /appdata/
</span></span><span class=line><span class=cl>total 11G
</span></span><span class=line><span class=cl>drwx------ <span class=m>2</span> root root 16K Dec <span class=m>13</span> 18:51 lost+found
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root 10G Dec <span class=m>13</span> 19:08 write_test.tmp
</span></span></code></pre></div><p>10GB의 <code>write_test.tmp</code> 파일이 생성되었다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ rm /appdata/write_test.tmp 
</span></span><span class=line><span class=cl>rm: remove regular file <span class=sb>`</span>/appdata/write_test.tmp<span class=err>&#39;</span>? y
</span></span></code></pre></div><p>생성한 테스트 파일을 삭제한다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ls -lh /appdata/
</span></span><span class=line><span class=cl>total 16K
</span></span><span class=line><span class=cl>drwx------ <span class=m>2</span> root root 16K Dec <span class=m>13</span> 18:51 lost+found
</span></span></code></pre></div><p>파일 삭제도 문제 없이 진행된다.</p><br></div></section><footer class="pt-8 max-w-prose print:hidden"><script src=https://utteranc.es/client.js repo=seyslee/seyslee.github.io issue-term=pathname label=blog-comment theme=github-dark crossorigin=anonymous async></script></footer></article><div class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Younsung Lee</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div></div></footer></div></body></html>