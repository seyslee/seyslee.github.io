<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>테라폼 S3 버킷 강제삭제 &#183; seyslee</title><meta name=title content="테라폼 S3 버킷 강제삭제 &#183; seyslee"><meta name=description content="seyslee"><link rel=canonical href=https://seyslee.github.io/blog/terraform-delete-non-empty-s3-bucket/><link type=text/css rel=stylesheet href=/css/main.bundle.min.b48975bbd6c4fb86531cbdd0c02019dd556591de76cb3cd4b65f99408610039504f2f978a70784ae9adde42ca5df40cdbccfea526ba2f1562efcca9d67ee73a1.css integrity="sha512-tIl1u9bE+4ZTHL3QwCAZ3VVlkd52yzzUtl+ZQIYQA5UE8vl4pweErprd5Cyl30DNvM/qUmui8VYu/MqdZ+5zoQ=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9947db70e5b36e741e53f8531bd734741b3fc7a688f7b5d749fc5433c48efc252f47bdf44e471570a550fc051b87712799014040e6349b38d64448b94e84e45a.js integrity="sha512-mUfbcOWzbnQeU/hTG9c0dBs/x6aI97XXSfxUM8SO/CUvR730TkcVcKVQ/AUbh3EnmQFAQOY0mzjWREi5ToTkWg==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="테라폼 S3 버킷 강제삭제"><meta property="og:description" content="테라폼에서 오브젝트들이 들어있는 S3 버킷을 강제로 삭제하는 방법을 설명합니다."><meta property="og:type" content="article"><meta property="og:url" content="https://seyslee.github.io/blog/terraform-delete-non-empty-s3-bucket/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-06-09T00:32:00+09:00"><meta property="article:modified_time" content="2022-06-09T00:56:00+09:00"><meta property="og:site_name" content="seyslee"><meta name=twitter:card content="summary"><meta name=twitter:title content="테라폼 S3 버킷 강제삭제"><meta name=twitter:description content="테라폼에서 오브젝트들이 들어있는 S3 버킷을 강제로 삭제하는 방법을 설명합니다."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blogs","name":"테라폼 S3 버킷 강제삭제","headline":"테라폼 S3 버킷 강제삭제","description":"테라폼에서 오브젝트들이 들어있는 S3 버킷을 강제로 삭제하는 방법을 설명합니다.","abstract":"문제점 # 테라폼으로 생성한 버킷을 삭제하려고 할 때 내용물이 들어 있으면 테라폼으로 삭제되지 않습니다.","inLanguage":"en","url":"https:\/\/seyslee.github.io\/blog\/terraform-delete-non-empty-s3-bucket\/","author":{"@type":"Person","name":"Younsung Lee"},"copyrightYear":"2022","dateCreated":"2022-06-09T00:32:00\u002b09:00","datePublished":"2022-06-09T00:32:00\u002b09:00","dateModified":"2022-06-09T00:56:00\u002b09:00","keywords":["devops","iac","terraform"],"mainEntityOfPage":"true","wordCount":"1144"}]</script><meta name=author content="Younsung Lee"><link href=mailto:ivecloudblack@gmail.com rel=me><link href=https://github.com/seyslee rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>seyslee</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/ title=Blogs>post</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>tag</a></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">테라폼 S3 버킷 강제삭제</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-06-09 00:32:00 +0900 +0900">Jun 9, 2022</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2022-06-09 00:56:00 +0900 +0900">Updated: Jun 9, 2022</time></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#문제점>문제점</a></li><li><a href=#환경>환경</a></li><li><a href=#해결방법>해결방법</a><ul><li><a href=#요약>요약</a></li><li><a href=#상세-조치방법>상세 조치방법</a></li></ul></li><li><a href=#참고자료>참고자료</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><h2 id=문제점 class="relative group">문제점 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%ac%b8%ec%a0%9c%ec%a0%90 aria-label=Anchor>#</a></span></h2><p>테라폼으로 생성한 버킷을 삭제하려고 할 때 내용물이 들어 있으면 테라폼으로 삭제되지 않습니다.<br>이 문서에서는 S3 버킷을 수작업으로 비울 필요 없이 테라폼만으로 버킷을 비우고 강제 삭제하는 방법을 소개합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ terraform destroy
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>aws_iam_role.s3-mybucket-role: Destroying... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>s3-mybucket-role<span class=o>]</span>
</span></span><span class=line><span class=cl>aws_iam_role.s3-mybucket-role: Destruction <span class=nb>complete</span> after 0s
</span></span><span class=line><span class=cl>╷
</span></span><span class=line><span class=cl>│ Error: deleting S3 Bucket <span class=o>(</span>mybucket-seyslee-terraform-training<span class=o>)</span>: BucketNotEmpty: The bucket you tried to delete is not empty
</span></span><span class=line><span class=cl>│ 	status code: 409, request id: NM7NS0KDN2YV6JG4, host id: 0M0e2q8n/aHzPgCqWJWo0/6WVOGEisA7WyA4smqB/9c4wyd8/ArZAbVT60BragCP7x+dWGB9Co8<span class=o>=</span>
</span></span><span class=line><span class=cl>│
</span></span><span class=line><span class=cl>│
</span></span></code></pre></div><p>현재 S3에는 <code>helloworld.txt</code>라는 텍스트 파일 오브젝트가 들어있어서 삭제되지 않고 있습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ aws s3 ls s3://mybucket-seyslee-terraform-training/
</span></span><span class=line><span class=cl>2022-06-09 00:22:54        <span class=m>211</span> hello-world.txt
</span></span></code></pre></div><p>오브젝트들이 들어 있는 버킷을 테라폼으로 강제 삭제하는 방법에 대해 알아보겠습니다.</p><p><strong>중요</strong>: 강제 삭제된 버킷은 다시 복구할 수 없다는 점을 명심하세요.</p><p> </p><h2 id=환경 class="relative group">환경 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%99%98%ea%b2%bd aria-label=Anchor>#</a></span></h2><ul><li><strong>Terraform v1.2.2</strong></li><li><strong>Provider</strong>: terraform-provider-aws_v4.17.1_x5</li><li>AWS CLI는 현재 AdministratorAccess 권한이 부여된 상태</li></ul><p> </p><h2 id=해결방법 class="relative group">해결방법 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%95%b4%ea%b2%b0%eb%b0%a9%eb%b2%95 aria-label=Anchor>#</a></span></h2><h3 id=요약 class="relative group">요약 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%9a%94%ec%95%bd aria-label=Anchor>#</a></span></h3><ol><li>테라폼 파일을 수정합니다. S3 버킷의 강제 삭제 설정값을 <code>false</code>에서 <code>true</code>로 변경합니다.</li><li>변경사항을 <code>terraform apply</code>로 적용해서 테라폼 상태 파일 <code>.tfstate</code> 에 반영합니다.</li><li><code>terraform destroy</code>를 다시 실행합니다.</li><li>안에 들어있는 오브젝트들과 함께 버킷이 삭제됩니다.</li></ol><p> </p><h3 id=상세-조치방법 class="relative group">상세 조치방법 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%83%81%ec%84%b8-%ec%a1%b0%ec%b9%98%eb%b0%a9%eb%b2%95 aria-label=Anchor>#</a></span></h3><p>S3 버킷이 선언된 테라폼 파일의 내용을 확인합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat s3.tf
</span></span><span class=line><span class=cl>resource <span class=s2>&#34;aws_s3_bucket&#34;</span> <span class=s2>&#34;b&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>bucket</span> <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>tags</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>Name</span>      <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>ManagedBy</span> <span class=o>=</span> <span class=s2>&#34;terraform&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><code>force_destroy</code> 값을 <code>false</code>에서 <code>true</code>로 변경합니다.<br>따로 테라폼 파일에 선언되어 있지 않을 경우 기본값 <code>false</code>로 설정됩니다.</p><p> </p><p>수정한 S3 테라폼 파일입니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat s3.tf
</span></span><span class=line><span class=cl>resource <span class=s2>&#34;aws_s3_bucket&#34;</span> <span class=s2>&#34;b&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>bucket</span>        <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nv>force_destroy</span> <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>tags</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>Name</span>      <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>ManagedBy</span> <span class=o>=</span> <span class=s2>&#34;terraform&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><code>force_destroy = true</code> 라인을 새로 작성했습니다.</p><p> </p><p>참고로 <code>mybucket-seyslee-terraform-training</code> 버킷은 이미 예전에 <code>terraform apply</code>로 생성되어 있던 리소스입니다.</p><p>테라폼 명령어에서 <code>-target</code> 옵션을 사용하면 특정 리소스에만 플랜, 적용, 삭제를 할 수 있습니다.<br>위 <code>s3.tf</code> 파일에서 버킷의 리소스 주소는 <code>aws_s3_bucket.b</code> 가 됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ terraform apply -target aws_s3_bucket.b
</span></span><span class=line><span class=cl>aws_s3_bucket.b: Refreshing state... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>mybucket-seyslee-terraform-training<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Terraform used the selected providers to generate the following execution plan.
</span></span><span class=line><span class=cl>Resource actions are indicated with the following symbols:
</span></span><span class=line><span class=cl>  ~ update in-place
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Terraform will perform the following actions:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># aws_s3_bucket.b will be updated in-place</span>
</span></span><span class=line><span class=cl>  ~ resource <span class=s2>&#34;aws_s3_bucket&#34;</span> <span class=s2>&#34;b&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      ~ <span class=nv>force_destroy</span>               <span class=o>=</span> <span class=nb>false</span> -&gt; <span class=nb>true</span>
</span></span><span class=line><span class=cl>        <span class=nv>id</span>                          <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nv>tags</span>                        <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ManagedBy&#34;</span> <span class=o>=</span> <span class=s2>&#34;terraform&#34;</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Name&#34;</span>      <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=c1># (9 unchanged attributes hidden)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># (2 unchanged blocks hidden)</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Plan: <span class=m>0</span> to add, <span class=m>1</span> to change, <span class=m>0</span> to destroy.
</span></span><span class=line><span class=cl>╷
</span></span><span class=line><span class=cl>│ Warning: Resource targeting is in effect
</span></span><span class=line><span class=cl>│
</span></span><span class=line><span class=cl>│ You are creating a plan with the -target option, which means that the result of
</span></span><span class=line><span class=cl>│ this plan may not represent all of the changes requested by the current
</span></span><span class=line><span class=cl>│ configuration.
</span></span><span class=line><span class=cl>│
</span></span><span class=line><span class=cl>│ The -target option is not <span class=k>for</span> routine use, and is provided only <span class=k>for</span> exceptional
</span></span><span class=line><span class=cl>│ situations such as recovering from errors or mistakes, or when Terraform
</span></span><span class=line><span class=cl>│ specifically suggests to use it as part of an error message.
</span></span><span class=line><span class=cl>╵
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Do you want to perform these actions?
</span></span><span class=line><span class=cl>  Terraform will perform the actions described above.
</span></span><span class=line><span class=cl>  Only <span class=s1>&#39;yes&#39;</span> will be accepted to approve.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Enter a value: yes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>aws_s3_bucket.b: Modifying... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>mybucket-seyslee-terraform-training<span class=o>]</span>
</span></span><span class=line><span class=cl>aws_s3_bucket.b: Modifications <span class=nb>complete</span> after 0s <span class=o>[</span><span class=nv>id</span><span class=o>=</span>mybucket-seyslee-terraform-training<span class=o>]</span>
</span></span><span class=line><span class=cl>╷
</span></span><span class=line><span class=cl>│ Warning: Applied changes may be incomplete
</span></span><span class=line><span class=cl>│
</span></span><span class=line><span class=cl>│ The plan was created with the -target option in effect, so some changes requested
</span></span><span class=line><span class=cl>│ in the configuration may have been ignored and the output values may not be fully
</span></span><span class=line><span class=cl>│ updated. Run the following <span class=nb>command</span> to verify that no other changes are pending:
</span></span><span class=line><span class=cl>│     terraform plan
</span></span><span class=line><span class=cl>│
</span></span><span class=line><span class=cl>│ Note that the -target option is not suitable <span class=k>for</span> routine use, and is provided only
</span></span><span class=line><span class=cl>│ <span class=k>for</span> exceptional situations such as recovering from errors or mistakes, or when
</span></span><span class=line><span class=cl>│ Terraform specifically suggests to use it as part of an error message.
</span></span><span class=line><span class=cl>╵
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Apply complete! Resources: <span class=m>0</span> added, <span class=m>1</span> changed, <span class=m>0</span> destroyed.
</span></span></code></pre></div><p>변경사항이 1개 적용되었습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>...</span>
</span></span><span class=line><span class=cl>  <span class=err>~</span> <span class=err>resource</span> <span class=s2>&#34;aws_s3_bucket&#34;</span> <span class=s2>&#34;b&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>~</span> <span class=err>force_destroy</span>               <span class=err>=</span> <span class=err>false</span> <span class=err>-&gt;</span> <span class=err>true</span>
</span></span><span class=line><span class=cl><span class=err>...</span>
</span></span></code></pre></div><p><code>force_destory</code> 값이 <code>false</code>에서 <code>true</code>로 변경될 겁니다.</p><p> </p><p>현재 버킷의 <code>force_destroy</code> 값이 <code>true</code>이기 때문에 이제 삭제 명령어를 재시도합니다.</p><p>테라폼 삭제 명령어를 실행할 때에도 <code>-target</code> 옵션을 사용해서 문제가 발생했던 버킷에 한정해서 삭제를 진행할 수 있습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ terraform destroy -target aws_s3_bucket.b
</span></span><span class=line><span class=cl>aws_s3_bucket.b: Refreshing state... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>mybucket-seyslee-terraform-training<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Terraform used the selected providers to generate the following execution plan.
</span></span><span class=line><span class=cl>Resource actions are indicated with the following symbols:
</span></span><span class=line><span class=cl>  - destroy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Terraform will perform the following actions:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># aws_s3_bucket.b will be destroyed</span>
</span></span><span class=line><span class=cl>  - resource <span class=s2>&#34;aws_s3_bucket&#34;</span> <span class=s2>&#34;b&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      - <span class=nv>arn</span>                         <span class=o>=</span> <span class=s2>&#34;arn:aws:s3:::mybucket-seyslee-terraform-training&#34;</span> -&gt; null
</span></span><span class=line><span class=cl>      - <span class=nv>bucket</span>                      <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training&#34;</span> -&gt; null
</span></span><span class=line><span class=cl>      - <span class=nv>bucket_domain_name</span>          <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training.s3.amazonaws.com&#34;</span> -&gt; null
</span></span><span class=line><span class=cl>      - <span class=nv>bucket_regional_domain_name</span> <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training.s3.ap-northeast-2.amazonaws.com&#34;</span> -&gt; null
</span></span><span class=line><span class=cl>      - <span class=nv>force_destroy</span>               <span class=o>=</span> <span class=nb>true</span> -&gt; null
</span></span><span class=line><span class=cl>      - <span class=nv>hosted_zone_id</span>              <span class=o>=</span> <span class=s2>&#34;Z3W03O7B5YMIYP&#34;</span> -&gt; null
</span></span><span class=line><span class=cl>      - <span class=nv>id</span>                          <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training&#34;</span> -&gt; null
</span></span><span class=line><span class=cl>      - <span class=nv>object_lock_enabled</span>         <span class=o>=</span> <span class=nb>false</span> -&gt; null
</span></span><span class=line><span class=cl>      - <span class=nv>region</span>                      <span class=o>=</span> <span class=s2>&#34;ap-northeast-2&#34;</span> -&gt; null
</span></span><span class=line><span class=cl>      - <span class=nv>request_payer</span>               <span class=o>=</span> <span class=s2>&#34;BucketOwner&#34;</span> -&gt; null
</span></span><span class=line><span class=cl>      - <span class=nv>tags</span>                        <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>          - <span class=s2>&#34;ManagedBy&#34;</span> <span class=o>=</span> <span class=s2>&#34;terraform&#34;</span>
</span></span><span class=line><span class=cl>          - <span class=s2>&#34;Name&#34;</span>      <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> -&gt; null
</span></span><span class=line><span class=cl>      - <span class=nv>tags_all</span>                    <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>          - <span class=s2>&#34;ManagedBy&#34;</span> <span class=o>=</span> <span class=s2>&#34;terraform&#34;</span>
</span></span><span class=line><span class=cl>          - <span class=s2>&#34;Name&#34;</span>      <span class=o>=</span> <span class=s2>&#34;mybucket-seyslee-terraform-training&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> -&gt; null
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      - grant <span class=o>{</span>
</span></span><span class=line><span class=cl>          - <span class=nv>id</span>          <span class=o>=</span> <span class=s2>&#34;84a9142d6f4328db8f659834b9b87f22be5cdee2c61f0cd4da3a0f0dadefe959&#34;</span> -&gt; null
</span></span><span class=line><span class=cl>          - <span class=nv>permissions</span> <span class=o>=</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>              - <span class=s2>&#34;FULL_CONTROL&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=o>]</span> -&gt; null
</span></span><span class=line><span class=cl>          - <span class=nb>type</span>        <span class=o>=</span> <span class=s2>&#34;CanonicalUser&#34;</span> -&gt; null
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      - versioning <span class=o>{</span>
</span></span><span class=line><span class=cl>          - <span class=nv>enabled</span>    <span class=o>=</span> <span class=nb>false</span> -&gt; null
</span></span><span class=line><span class=cl>          - <span class=nv>mfa_delete</span> <span class=o>=</span> <span class=nb>false</span> -&gt; null
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Plan: <span class=m>0</span> to add, <span class=m>0</span> to change, <span class=m>1</span> to destroy.
</span></span><span class=line><span class=cl>╷
</span></span><span class=line><span class=cl>│ Warning: Resource targeting is in effect
</span></span><span class=line><span class=cl>│
</span></span><span class=line><span class=cl>│ You are creating a plan with the -target option, which means that the result of
</span></span><span class=line><span class=cl>│ this plan may not represent all of the changes requested by the current
</span></span><span class=line><span class=cl>│ configuration.
</span></span><span class=line><span class=cl>│
</span></span><span class=line><span class=cl>│ The -target option is not <span class=k>for</span> routine use, and is provided only <span class=k>for</span> exceptional
</span></span><span class=line><span class=cl>│ situations such as recovering from errors or mistakes, or when Terraform
</span></span><span class=line><span class=cl>│ specifically suggests to use it as part of an error message.
</span></span><span class=line><span class=cl>╵
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Do you really want to destroy all resources?
</span></span><span class=line><span class=cl>  Terraform will destroy all your managed infrastructure, as shown above.
</span></span><span class=line><span class=cl>  There is no undo. Only <span class=s1>&#39;yes&#39;</span> will be accepted to confirm.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Enter a value: yes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>aws_s3_bucket.b: Destroying... <span class=o>[</span><span class=nv>id</span><span class=o>=</span>mybucket-seyslee-terraform-training<span class=o>]</span>
</span></span><span class=line><span class=cl>aws_s3_bucket.b: Destruction <span class=nb>complete</span> after 1s
</span></span><span class=line><span class=cl>╷
</span></span><span class=line><span class=cl>│ Warning: Applied changes may be incomplete
</span></span><span class=line><span class=cl>│
</span></span><span class=line><span class=cl>│ The plan was created with the -target option in effect, so some changes requested
</span></span><span class=line><span class=cl>│ in the configuration may have been ignored and the output values may not be fully
</span></span><span class=line><span class=cl>│ updated. Run the following <span class=nb>command</span> to verify that no other changes are pending:
</span></span><span class=line><span class=cl>│     terraform plan
</span></span><span class=line><span class=cl>│
</span></span><span class=line><span class=cl>│ Note that the -target option is not suitable <span class=k>for</span> routine use, and is provided only
</span></span><span class=line><span class=cl>│ <span class=k>for</span> exceptional situations such as recovering from errors or mistakes, or when
</span></span><span class=line><span class=cl>│ Terraform specifically suggests to use it as part of an error message.
</span></span><span class=line><span class=cl>╵
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Destroy complete! Resources: <span class=m>1</span> destroyed.
</span></span></code></pre></div><p>삭제가 안되던 버킷이 삭제 완료되었습니다.</p><p> </p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat terraform.tfstate
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;version&#34;</span>: 4,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;terraform_version&#34;</span>: <span class=s2>&#34;1.2.2&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;serial&#34;</span>: 126,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;lineage&#34;</span>: <span class=s2>&#34;1e2c7869-b23e-3c00-6b89-e8096e5343ab&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;outputs&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;resources&#34;</span>: <span class=o>[]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>테라폼 상태 파일 <code>terraform.tfstate</code>에서도 S3 리소스가 삭제되어 깔끔해졌습니다.</p><p>AWS Management Console에서 버킷 목록을 조회합니다.</p><p><figure><img class="my-0 rounded-md" src=./1.png alt="S3 페이지"></figure></p><p><code>destroy</code>로 삭제되지 않던 버킷이 삭제되어 없어진 걸 확인할 수 있습니다.</p><p>AWS CLI에서도 S3 버킷이 삭제된 걸 확인할 수 있습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ aws s3 ls s3://mybucket-seyslee-terraform-training/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>An error occurred <span class=o>(</span>NoSuchBucket<span class=o>)</span> when calling the ListObjectsV2 operation: The specified bucket does not exist
</span></span></code></pre></div><p>존재하지 않는 버킷이라고 나옵니다.</p><p>이상으로 조치 완료되었습니다.</p><p> </p><h2 id=참고자료 class="relative group">참고자료 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%b0%b8%ea%b3%a0%ec%9e%90%eb%a3%8c aria-label=Anchor>#</a></span></h2><p><a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#force_destroy>Terraform force_destroy</a><br><a href=https://dev.to/the_cozma/terraform-handling-the-deletion-of-a-non-empty-aws-s3-bucket-3jg3>Terraform: Handling the deletion of a non-empty AWS S3 Bucket</a></p></div></section><footer class="pt-8 max-w-prose print:hidden"><script src=https://utteranc.es/client.js repo=seyslee/seyslee.github.io issue-term=pathname label=blog-comment theme=github-dark crossorigin=anonymous async></script></footer></article></main><footer class="py-10 print:hidden"><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Younsung Lee</p></div></div></footer></div></body></html>