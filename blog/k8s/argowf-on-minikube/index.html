<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>minikube에 Argo Workflows 헬름 설치 &#183; seyslee</title><meta name=title content="minikube에 Argo Workflows 헬름 설치 &#183; seyslee"><meta name=description content="seyslee"><link rel=canonical href=https://seyslee.github.io/blog/k8s/argowf-on-minikube/><link type=text/css rel=stylesheet href=/css/main.bundle.min.fff8ff4cdbe2bf80930c53b6e47a6d9826b914a8623246481ff09ff52ea48fcfb403d9ba1dc7bbc800a7ecb15298c468838a661dd8ebb3e9f46fdca239b38a30.css integrity="sha512-//j/TNviv4CTDFO25HptmCa5FKhiMkZIH/Cf9S6kj8+0A9m6Hce7yACn7LFSmMRog4pmHdjrs+n0b9yiObOKMA=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9947db70e5b36e741e53f8531bd734741b3fc7a688f7b5d749fc5433c48efc252f47bdf44e471570a550fc051b87712799014040e6349b38d64448b94e84e45a.js integrity="sha512-mUfbcOWzbnQeU/hTG9c0dBs/x6aI97XXSfxUM8SO/CUvR730TkcVcKVQ/AUbh3EnmQFAQOY0mzjWREi5ToTkWg==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="minikube에 Argo Workflows 헬름 설치"><meta property="og:description" content="Argo Workflows를 헬름으로 설치하고 직접 작성한 워크플로우를 실행하는 방법을 안내합니다."><meta property="og:type" content="article"><meta property="og:url" content="https://seyslee.github.io/blog/k8s/argowf-on-minikube/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-07-10T17:50:40+09:00"><meta property="article:modified_time" content="2022-07-10T21:00:45+09:00"><meta property="og:site_name" content="seyslee"><meta name=twitter:card content="summary"><meta name=twitter:title content="minikube에 Argo Workflows 헬름 설치"><meta name=twitter:description content="Argo Workflows를 헬름으로 설치하고 직접 작성한 워크플로우를 실행하는 방법을 안내합니다."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blogs","name":"minikube에 Argo Workflows 헬름 설치","headline":"minikube에 Argo Workflows 헬름 설치","description":"Argo Workflows를 헬름으로 설치하고 직접 작성한 워크플로우를 실행하는 방법을 안내합니다.","abstract":"개요 # minikube 클러스터 환경에 Argo Workflows를 설치해보고 데모를 실행해보는 튜토리얼입니다.","inLanguage":"en","url":"https:\/\/seyslee.github.io\/blog\/k8s\/argowf-on-minikube\/","author":{"@type":"Person","name":"Younsung Lee"},"copyrightYear":"2022","dateCreated":"2022-07-10T17:50:40\u002b09:00","datePublished":"2022-07-10T17:50:40\u002b09:00","dateModified":"2022-07-10T21:00:45\u002b09:00","keywords":["devops","kubernetes","minikube"],"mainEntityOfPage":"true","wordCount":"1060"}]</script><meta name=author content="Younsung Lee"><link href=mailto:ivecloudblack@gmail.com rel=me><link href=https://github.com/seyslee rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><nav class="flex justify-between"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>seyslee</a></div><ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row"><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/ title=Blogs>post</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>tag</a></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">minikube에 Argo Workflows 헬름 설치</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-07-10 17:50:40 +0900 +0900">Jul 10, 2022</time></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#개요>개요</a></li><li><a href=#환경>환경</a></li><li><a href=#전제조건>전제조건</a><ul><li><a href=#클러스터-생성>클러스터 생성</a></li><li><a href=#helm-repo-추가>helm repo 추가</a></li><li><a href=#values-작성>values 작성</a></li><li><a href=#argo-workflows-설치>Argo Workflows 설치</a></li><li><a href=#웹-접속>웹 접속</a></li><li><a href=#workflow-생성>Workflow 생성</a></li><li><a href=#workflow-실행결과-확인>Workflow 실행결과 확인</a></li><li><a href=#실습환경-정리>실습환경 정리</a></li></ul></li><li><a href=#마치며>마치며</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><h2 id=개요 class="relative group">개요 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b0%9c%ec%9a%94 aria-label=Anchor>#</a></span></h2><p>minikube 클러스터 환경에 Argo Workflows를 설치해보고 데모를 실행해보는 튜토리얼입니다.</p><p> </p><h2 id=환경 class="relative group">환경 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%99%98%ea%b2%bd aria-label=Anchor>#</a></span></h2><ul><li><strong>OS</strong> : macOS Monterey 12.4 (M1 Pro)</li><li><strong>Shell</strong> : zsh + oh-my-zsh</li><li>minikube v1.26.0</li><li>helm v3.9.0</li><li>docker desktop v4.10.1</li></ul><p>이 실습에서 사용한 Argo Worfklows 버전은 <code>v3.3.8</code> 입니다.</p><p> </p><h2 id=전제조건 class="relative group">전제조건 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%a0%84%ec%a0%9c%ec%a1%b0%ea%b1%b4 aria-label=Anchor>#</a></span></h2><ul><li>docker desktop이 미리 설치되어 있어야 합니다.</li><li><code>minikube</code>가 미리 설치되어 있어야 합니다.</li><li><code>helm</code>이 미리 설치되어 있어야 합니다.</li></ul><p> </p><h3 id=클러스터-생성 class="relative group">클러스터 생성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%81%b4%eb%9f%ac%ec%8a%a4%ed%84%b0-%ec%83%9d%ec%84%b1 aria-label=Anchor>#</a></span></h3><p><code>minikube</code>가 미리 설치되어 있어야 합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube version
</span></span><span class=line><span class=cl>minikube version: v1.26.0
</span></span><span class=line><span class=cl>commit: f4b412861bb746be73053c9f6d2895f12cf78565
</span></span></code></pre></div><p>현재 제 환경은 minikube <code>v1.26.0</code> 버전이 설치되어 있습니다.</p><p> </p><p>minikube 클러스터를 생성합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube start <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --driver<span class=o>=</span><span class=s1>&#39;docker&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --nodes<span class=o>=</span><span class=m>3</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --kubernetes-version<span class=o>=</span><span class=s1>&#39;stable&#39;</span>
</span></span></code></pre></div><p><strong>옵션 설명</strong><br><code>--driver='docker'</code> : 드라이버로 도커 데스크탑을 사용합니다.<br><code>--nodes=3</code> : 3대의 노드로 클러스터를 구성합니다.<br><code>--kubernetes-version='stable'</code> : 쿠버네티스 버전을 안정화된 버전으로 설치합니다.</p><p> </p><p>노드 3대가 생성되는 결과를 모니터링합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get node -w
</span></span><span class=line><span class=cl>NAME           STATUS   ROLES           AGE    VERSION
</span></span><span class=line><span class=cl>minikube       Ready    control-plane   106s   v1.24.1
</span></span><span class=line><span class=cl>minikube-m02   Ready    &lt;none&gt;          68s    v1.24.1
</span></span><span class=line><span class=cl>minikube-m03   Ready    &lt;none&gt;          33s    v1.24.1
</span></span></code></pre></div><p>1대의 컨트롤 플레인, 2대의 워커 노드로 구성되었습니다.<br>모든 노드가 쿠버네티스 <code>v1.24.1</code> 버전을 사용하는 걸 확인할 수 있습니다.</p><p> </p><h3 id=helm-repo-추가 class="relative group">helm repo 추가 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#helm-repo-%ec%b6%94%ea%b0%80 aria-label=Anchor>#</a></span></h3><h4 id=차트-추가 class="relative group">차트 추가 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%b0%a8%ed%8a%b8-%ec%b6%94%ea%b0%80 aria-label=Anchor>#</a></span></h4><p>Argo Workflow 헬름 레포지터리를 추가합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ helm repo add argo https://argoproj.github.io/argo-helm
</span></span></code></pre></div><p> </p><p>현재 등록된 헬름 레포지터리 목록을 확인합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ helm repo list
</span></span><span class=line><span class=cl>NAME                   	URL
</span></span><span class=line><span class=cl>stable                 	https://charts.helm.sh/stable
</span></span><span class=line><span class=cl>argo                   	https://argoproj.github.io/argo-helm
</span></span></code></pre></div><p><code>argo</code>라는 이름으로 argo-helm 레포지터리가 추가된 걸 확인할 수 있습니다.</p><p> </p><h3 id=values-작성 class="relative group">values 작성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#values-%ec%9e%91%ec%84%b1 aria-label=Anchor>#</a></span></h3><p><code>argowf-values.yaml</code> 파일을 생성합니다.<br>여기서 작성한 values 파일은 잠시 후 <code>helm install</code> 과정에서 사용됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat <span class=s>&lt;&lt; EOF &gt; ./argowf-values.yaml
</span></span></span><span class=line><span class=cl><span class=s>server:
</span></span></span><span class=line><span class=cl><span class=s>  extraArgs:
</span></span></span><span class=line><span class=cl><span class=s>  - --auth-mode=server
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p><code>argowf-values.yaml</code> 파일을 작성하는 이유는 현재 저희가 실습하는 환경이 로컬 minikube 클러스터이기 때문에, 접속시 인증문제가 발생하게 됩니다.<br>이를 방지하기 위해 Argo Workflows 서버의 인증 모드를 <code>server</code>로 변경해줍니다.</p><h4 id=argo-workflows의-인증-모드 class="relative group">Argo Workflows의 인증 모드 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#argo-workflows%ec%9d%98-%ec%9d%b8%ec%a6%9d-%eb%aa%a8%eb%93%9c aria-label=Anchor>#</a></span></h4><p>Argo Worfklows 서버의 인증 방식에는 <code>server</code>, <code>client</code>, <code>sso</code> 이렇게 3가지 중 하나를 고를 수 있습니다.</p><p>Argo Worfklows는 기본적으로 <code>server</code>의 인증 모드로 시작했지만 v3.0 이상부터는 <code>client</code>로 기본 설정됩니다.<br>자세한 사항은 Argo Workflows의 <a href=https://argoproj.github.io/argo-workflows/argo-server-auth-mode/>공식문서</a>를 참고하세요.</p><p> </p><h3 id=argo-workflows-설치 class="relative group">Argo Workflows 설치 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#argo-workflows-%ec%84%a4%ec%b9%98 aria-label=Anchor>#</a></span></h3><p>헬름 차트를 이용해서 Argo Workflows를 설치합니다.<br>설치할 네임스페이스 이름은 <code>argowf</code>로 지정하겠습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install argowf argo/argo-workflows <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --namespace argowf <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --create-namespace <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -f argowf-values.yaml
</span></span></code></pre></div><p>Argo Workflows 릴리즈가 설치 완료되었습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME: argowf
</span></span><span class=line><span class=cl>LAST DEPLOYED: Sun Jul <span class=m>10</span> 18:18:24 <span class=m>2022</span>
</span></span><span class=line><span class=cl>NAMESPACE: argowf
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: <span class=m>1</span>
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>1. Get Argo Server external IP/domain by running:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl --namespace argowf get services -o wide <span class=p>|</span> grep argowf-argo-workflows-server
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2. Submit the hello-world workflow by running:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>argo submit https://raw.githubusercontent.com/argoproj/argo-workflows/master/examples/hello-world.yaml --watch
</span></span></code></pre></div><p> </p><p>설치된 헬름 릴리즈 목록을 확인합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ helm list -n argowf
</span></span><span class=line><span class=cl>NAME  	NAMESPACE	REVISION	UPDATED                             	STATUS  	CHART                	APP VERSION
</span></span><span class=line><span class=cl>argowf	argowf   	<span class=m>1</span>       	2022-07-10 18:37:00.223254 +0900 KST	deployed	argo-workflows-0.16.6	v3.3.8
</span></span></code></pre></div><p><code>argowf</code>라는 이름으로 배포된 상태입니다. 설치 이후 릴리즈를 수정한 적 없기 때문에 <code>REVISION</code>은 최초값인 <code>1</code>입니다.<br>Argo Workflows가 배포된 네임스페이스는 <code>argowf</code>인 걸 확인할 수 있습니다.</p><p> </p><p>Argo Workflows를 구성하는 전체 리소스를 확인합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get all -n argowf
</span></span><span class=line><span class=cl>NAME                                                             READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/argowf-argo-workflows-server-7bb5cbfd6f-2x2tf                1/1     Running   <span class=m>0</span>          25m
</span></span><span class=line><span class=cl>pod/argowf-argo-workflows-workflow-controller-7f56697fd7-7pm9v   1/1     Running   <span class=m>0</span>          44m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                   TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>    AGE
</span></span><span class=line><span class=cl>service/argowf-argo-workflows-server   ClusterIP   10.97.126.34   &lt;none&gt;        2746/TCP   44m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                        READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/argowf-argo-workflows-server                1/1     <span class=m>1</span>            <span class=m>1</span>           44m
</span></span><span class=line><span class=cl>deployment.apps/argowf-argo-workflows-workflow-controller   1/1     <span class=m>1</span>            <span class=m>1</span>           44m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                                   DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/argowf-argo-workflows-server-7bb5cbfd6f                <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>       25m
</span></span><span class=line><span class=cl>replicaset.apps/argowf-argo-workflows-workflow-controller-7f56697fd7   <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>       44m
</span></span></code></pre></div><p> </p><h3 id=웹-접속 class="relative group">웹 접속 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%9b%b9-%ec%a0%91%ec%86%8d aria-label=Anchor>#</a></span></h3><p>Argo Worfklows의 서비스는 기본적으로 TCP/2746 포트를 사용합니다.<br><code>argowf-argo-workflows-server</code> 서비스의 TCP/2746 포트로 접근할 수 있도록 포트포워딩을 걸어놓습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl port-forward -n argowf deployment/argowf-argo-workflows-server 2746:2746
</span></span><span class=line><span class=cl>Forwarding from 127.0.0.1:2746 -&gt; <span class=m>2746</span>
</span></span><span class=line><span class=cl>Forwarding from <span class=o>[</span>::1<span class=o>]</span>:2746 -&gt; <span class=m>2746</span>
</span></span></code></pre></div><p> </p><p>이후 웹 브라우저를 열고 Argo Workflows 웹서버 주소인 <a href=http://localhost:2746/>http://localhost:2746/</a>로 접속합니다.</p><p><figure><img class="my-0 rounded-md" src=./1.png alt="Argo Workflows 메인화면"></figure></p><p>Argo Workflows의 초기 메인화면입니다.<br>왼쪽 상단에 Argo 마스코트를 자세히 보면 현재 최신 버전인 v3.3.8이 설치된 걸 확인할 수 있습니다.</p><p> </p><h3 id=workflow-생성 class="relative group">Workflow 생성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#workflow-%ec%83%9d%ec%84%b1 aria-label=Anchor>#</a></span></h3><h4 id=매니페스트-작성 class="relative group">매니페스트 작성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%a7%a4%eb%8b%88%ed%8e%98%ec%8a%a4%ed%8a%b8-%ec%9e%91%ec%84%b1 aria-label=Anchor>#</a></span></h4><p>multi step으로 실행하는 워크플로우 매니페스트를 아래와 같이 작성합니다.<br>파일명은 <code>steps-workflows.yaml</code> 입니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat <span class=s>&lt;&lt; EOF &gt; ./steps-workflow.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: argoproj.io/v1alpha1
</span></span></span><span class=line><span class=cl><span class=s>kind: Workflow
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  generateName: steps-
</span></span></span><span class=line><span class=cl><span class=s>  namespace: argowf
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  # 실행할 템플릿 이름
</span></span></span><span class=line><span class=cl><span class=s>  entrypoint: hello-hello-hello
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>  templates:
</span></span></span><span class=line><span class=cl><span class=s>  # ===========
</span></span></span><span class=line><span class=cl><span class=s>  # 공통 템플릿
</span></span></span><span class=line><span class=cl><span class=s>  # ===========
</span></span></span><span class=line><span class=cl><span class=s>  - name: whalesay
</span></span></span><span class=line><span class=cl><span class=s>    inputs:
</span></span></span><span class=line><span class=cl><span class=s>      parameters:
</span></span></span><span class=line><span class=cl><span class=s>      - name: message
</span></span></span><span class=line><span class=cl><span class=s>    container:
</span></span></span><span class=line><span class=cl><span class=s>      image: docker/whalesay
</span></span></span><span class=line><span class=cl><span class=s>      command: [cowsay]
</span></span></span><span class=line><span class=cl><span class=s>      args: [&#34;{{inputs.parameters.message}}&#34;]
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>  # ===========
</span></span></span><span class=line><span class=cl><span class=s>  # 실행할 템플릿
</span></span></span><span class=line><span class=cl><span class=s>  # 공통 템플릿에서 파라미터 값만 변환하여
</span></span></span><span class=line><span class=cl><span class=s>  # 여러 개를 실행할 수 있습니다.
</span></span></span><span class=line><span class=cl><span class=s>  # ===========
</span></span></span><span class=line><span class=cl><span class=s>  - name: hello-hello-hello
</span></span></span><span class=line><span class=cl><span class=s>    steps:
</span></span></span><span class=line><span class=cl><span class=s>    - - name: hello-alice
</span></span></span><span class=line><span class=cl><span class=s>        template: whalesay
</span></span></span><span class=line><span class=cl><span class=s>        arguments:
</span></span></span><span class=line><span class=cl><span class=s>          parameters:
</span></span></span><span class=line><span class=cl><span class=s>          - name: message
</span></span></span><span class=line><span class=cl><span class=s>            value: &#34;Hello alice!&#34;
</span></span></span><span class=line><span class=cl><span class=s>    # double dash (- -) =&gt; run after previous step
</span></span></span><span class=line><span class=cl><span class=s>    - - name: hello-bob
</span></span></span><span class=line><span class=cl><span class=s>        template: whalesay
</span></span></span><span class=line><span class=cl><span class=s>        arguments:
</span></span></span><span class=line><span class=cl><span class=s>          parameters:
</span></span></span><span class=line><span class=cl><span class=s>          - name: message
</span></span></span><span class=line><span class=cl><span class=s>            value: &#34;Hello bob!&#34;
</span></span></span><span class=line><span class=cl><span class=s>      # single dash (-) =&gt; run in parallel with previous step
</span></span></span><span class=line><span class=cl><span class=s>      - name: hello-carol       
</span></span></span><span class=line><span class=cl><span class=s>        template: whalesay
</span></span></span><span class=line><span class=cl><span class=s>        arguments:
</span></span></span><span class=line><span class=cl><span class=s>          parameters:
</span></span></span><span class=line><span class=cl><span class=s>          - name: message
</span></span></span><span class=line><span class=cl><span class=s>            value: &#34;Hello carol!&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p><code>hello-alice</code>가 처리된 다음에 <code>hello-bob</code>과 <code>hello-carol</code>이 병렬로 동시 처리되는 구조입니다.</p><p><figure><img class="my-0 rounded-md" src=./2.png alt="Multi step 구성"></figure></p><p> </p><h4 id=워크플로우-배포 class="relative group">워크플로우 배포 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%9b%8c%ed%81%ac%ed%94%8c%eb%a1%9c%ec%9a%b0-%eb%b0%b0%ed%8f%ac aria-label=Anchor>#</a></span></h4><p>작성한 워크플로우를 배포합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl create -f steps-workflow.yaml 
</span></span><span class=line><span class=cl>workflow.argoproj.io/steps-8zf7r created
</span></span></code></pre></div><p><strong>주의사항</strong><br>워크플로우를 배포할 때 <code>kubectl apply</code> 명령어로 배포할 경우 에러가 발생합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl apply -f steps-workflow.yaml
</span></span><span class=line><span class=cl>error: from steps-: cannot use generate name with apply
</span></span></code></pre></div><p><code>kubectl apply</code>할 때 <code>metadata.generateName</code> 키를 사용하면 안되기 떄문입니다.<br>작성한 워크플로우는 반드시 <code>kubectl create</code> 명령어로 배포해주세요.</p><p> </p><h3 id=workflow-실행결과-확인 class="relative group">Workflow 실행결과 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#workflow-%ec%8b%a4%ed%96%89%ea%b2%b0%ea%b3%bc-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h3><p>Argo Workflows 웹페이지에 접속해서 워크플로우가 생성되었는지 확인합니다.</p><p><figure><img class="my-0 rounded-md" src=./3.png alt="Workflows 생성된 화면"></figure></p><p>새 워크플로우가 생성되었습니다.</p><p> </p><p><code>kubectl</code>로 워크플로우 목록을 확인합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get workflows -n argowf
</span></span><span class=line><span class=cl>NAME          STATUS    AGE
</span></span><span class=line><span class=cl>steps-8zf7r   Running   28s
</span></span></code></pre></div><p>새 워크플로우의 상태가 실행중입니다.</p><p> </p><p>잠시 후 다시 확인해보면 워크플로우의 상태가 <code>Running</code>에서 <code>Succeeded</code>로 바뀐 걸 확인할 수 있습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get workflows -n argowf
</span></span><span class=line><span class=cl>NAME          STATUS      AGE
</span></span><span class=line><span class=cl>steps-8zf7r   Succeeded   2m25s
</span></span></code></pre></div><p> </p><p>Argo Workflows 웹페이지에서도 워크플로우가 완료된 걸 확인할 수 있습니다.<br><code>hello-alice</code>가 먼저 처리된 후, <code>hello-bob</code>과 <code>hello-carol</code>이 병렬로 처리되었습니다.</p><p><figure><img class="my-0 rounded-md" src=./4.png alt=처리></figure></p><p> </p><p>각 스탭마다 [MAIN LOGS] 버튼을 클릭하면 웹에서도 실행결과를 확인할 수 있습니다.</p><p><figure><img class="my-0 rounded-md" src=./5.png alt="Main logs 버튼"></figure></p><p> </p><p>hello-alice의 실행결과입니다.</p><p><figure><img class="my-0 rounded-md" src=./6.png alt="hello-alice 실행결과"></figure></p><p>워크플로우 매니페스트에 작성한대로 <code>Hello alice!</code>라고 메세지를 출력했습니다.</p><p> </p><p>INPUTS/OUTPUTS 탭에서도 실행 결과를 확인할 수 있습니다.<br>아래는 hello-carol의 실행결과입니다.</p><p><figure><img class="my-0 rounded-md" src=./7.png alt="hello-carol 실행결과"></figure></p><p> </p><p>Argo Workflows는 각 스탭을 처리하기 위해 파드를 생성해 지정한 일을 수행하는 구조입니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get pod -n argowf
</span></span><span class=line><span class=cl>NAME                                                         READY   STATUS      RESTARTS   AGE
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>steps-8zf7r-3572272947                                       0/2     Completed   <span class=m>0</span>          19m
</span></span><span class=line><span class=cl>steps-8zf7r-3661483429                                       0/2     Completed   <span class=m>0</span>          19m
</span></span><span class=line><span class=cl>steps-8zf7r-414978153                                        0/2     Completed   <span class=m>0</span>          20m
</span></span></code></pre></div><p>3개의 스탭으로 구성되어 있었기 때문에 파드 3개가 생성되었습니다.</p><p>스탭마다 처리가 완료된 이후에는 파드가 자동으로 사라지게 됩니다.<br>덕분에 쿠버네티스 클러스터의 리소스를 효율적으로 사용해서 일련의 작업들을 처리할 수 있게 됩니다.</p><p> </p><h3 id=실습환경-정리 class="relative group">실습환경 정리 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%8b%a4%ec%8a%b5%ed%99%98%ea%b2%bd-%ec%a0%95%eb%a6%ac aria-label=Anchor>#</a></span></h3><p>실습이 끝난 후에는 반드시 minikube 클러스터를 아래 명령어로 삭제해서 리소스 낭비를 방지하세요.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube delete
</span></span><span class=line><span class=cl>🔥  docker 의 <span class=s2>&#34;minikube&#34;</span> 를 삭제하는 중 ...
</span></span><span class=line><span class=cl>🔥  Deleting container <span class=s2>&#34;minikube&#34;</span> ...
</span></span><span class=line><span class=cl>🔥  Deleting container <span class=s2>&#34;minikube-m02&#34;</span> ...
</span></span><span class=line><span class=cl>🔥  Deleting container <span class=s2>&#34;minikube-m03&#34;</span> ...
</span></span><span class=line><span class=cl>🔥  /Users/guest/.minikube/machines/minikube 제거 중 ...
</span></span><span class=line><span class=cl>🔥  /Users/guest/.minikube/machines/minikube-m02 제거 중 ...
</span></span><span class=line><span class=cl>🔥  /Users/guest/.minikube/machines/minikube-m03 제거 중 ...
</span></span><span class=line><span class=cl>💀  <span class=s2>&#34;minikube&#34;</span> 클러스터 관련 정보가 모두 삭제되었습니다
</span></span></code></pre></div><p> </p><p>minikube 클러스터 삭제 후에 노드 목록을 조회해서 삭제결과를 확인합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get node
</span></span><span class=line><span class=cl>The connection to the server localhost:8080 was refused - did you specify the right host or port?
</span></span></code></pre></div><p>모든 노드가 사라졌기 때문에 결과가 조회되지 않습니다.</p><p> </p><h2 id=마치며 class="relative group">마치며 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%a7%88%ec%b9%98%eb%a9%b0 aria-label=Anchor>#</a></span></h2><p>이상으로 Argo Workflows 실습을 마치겠습니다.</p><p>이 튜토리얼은 Argo Workflow 공식문서의 <a href=https://argoproj.github.io/argo-workflows/quick-start/>Getting Started</a>를 참고해서 작성했습니다.</p></div></section><footer class="pt-8 max-w-prose print:hidden"><script src=https://utteranc.es/client.js repo=seyslee/seyslee.github.io issue-term=pathname label=blog-comment theme=github-dark crossorigin=anonymous async></script></footer></article></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Younsung Lee</p></div></div></footer></div></body></html>