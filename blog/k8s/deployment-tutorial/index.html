<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>쿠버네티스 deployment 실습 &#183; seyslee</title><meta name=title content="쿠버네티스 deployment 실습 &#183; seyslee"><meta name=description content="seyslee"><link rel=canonical href=https://seyslee.github.io/blog/k8s/deployment-tutorial/><link type=text/css rel=stylesheet href=/css/main.bundle.min.39b7a5b20cc3e1243a974332de8d5e458dd9f15f0f8e06962e8afb4c2b9ce9805c65a0f9359b396ceb5d5f8c16f9ede5d854c208fb561f4fbc5b9a05f4c3cdec.css integrity="sha512-ObelsgzD4SQ6l0My3o1eRY3Z8V8PjgaWLor7TCuc6YBcZaD5NZs5bOtdX4wW+e3l2FTCCPtWH0+8W5oF9MPN7A=="><script type=text/javascript src=/js/appearance.min.12e98742cd283574d030a7fe55f29597df4ee214f7ff7075b4d19a64d046a602753c715295550be7899b661619cec89c679049d36c624681671a8013c1249896.js integrity="sha512-EumHQs0oNXTQMKf+VfKVl99O4hT3/3B1tNGaZNBGpgJ1PHFSlVUL54mbZhYZzsicZ5BJ02xiRoFnGoATwSSYlg=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9ae0a991bb442898e9bc60cf318b4de3ff878325ff3821625a5564b32b2f66aec0e7f7d0e00ca3ac7df59d9f01c18c88b6bdd213184f86ac9ce06d7bdffbadf8.js integrity="sha512-muCpkbtEKJjpvGDPMYtN4/+HgyX/OCFiWlVksysvZq7A5/fQ4AyjrH31nZ8BwYyItr3SExhPhqyc4G173/ut+A==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="쿠버네티스 deployment 실습"><meta property="og:description" content="minikube 기반의 쿠버네티스 환경에서 deployment를 생성하고 제어하는 실습을 해본다."><meta property="og:type" content="article"><meta property="og:url" content="https://seyslee.github.io/blog/k8s/deployment-tutorial/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-11-10T00:00:15+09:00"><meta property="article:modified_time" content="2021-11-10T00:01:33+09:00"><meta property="og:site_name" content="seyslee"><meta name=twitter:card content="summary"><meta name=twitter:title content="쿠버네티스 deployment 실습"><meta name=twitter:description content="minikube 기반의 쿠버네티스 환경에서 deployment를 생성하고 제어하는 실습을 해본다."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blogs","name":"쿠버네티스 deployment 실습","headline":"쿠버네티스 deployment 실습","description":"minikube 기반의 쿠버네티스 환경에서 deployment를 생성하고 제어하는 실습을 해본다.","abstract":"개요 # minikube 기반의 쿠버네티스 환경에서 deployment를 생성하고 제어하는 실습을 한다.","inLanguage":"en","url":"https:\/\/seyslee.github.io\/blog\/k8s\/deployment-tutorial\/","author":{"@type":"Person","name":"Younsung Lee"},"copyrightYear":"2021","dateCreated":"2021-11-10T00:00:15\u002b09:00","datePublished":"2021-11-10T00:00:15\u002b09:00","dateModified":"2021-11-10T00:01:33\u002b09:00","keywords":["devops","kubernetes"],"mainEntityOfPage":"true","wordCount":"1311"}]</script><meta name=generator content="Hugo 0.97.3"><meta name=author content="Younsung Lee"><link href=mailto:ivecloudblack@gmail.com rel=me><link href=https://github.com/seyslee rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>seyslee</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/ title=Blogs>Post</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>Tag</a></li></ul></nav></header><main id=main-content class="relative grow"><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">쿠버네티스 deployment 실습</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2021-11-10 00:00:15 +0900 +0900">Nov 10, 2021</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2021-11-10 00:01:33 +0900 +0900">Updated: Nov 10, 2021</time></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#개요>개요</a></li><li><a href=#환경>환경</a></li><li><a href=#본문>본문</a><ul><li><a href=#deployment-생성>deployment 생성</a><ul><li><a href=#1-yaml-작성>1. yaml 작성</a></li><li><a href=#2-생성>2. 생성</a></li><li><a href=#3-확인>3. 확인</a></li><li><a href=#4-pod-재생성-테스트>4. pod 재생성 테스트</a></li></ul></li><li><a href=#롤링-업데이트>롤링 업데이트</a><ul><li><a href=#1-롤링-업데이트-실행>1. 롤링 업데이트 실행</a></li><li><a href=#2-결과확인>2. 결과확인</a></li><li><a href=#3-변경기록-확인>3. 변경기록 확인</a></li><li><a href=#4-롤백>4. 롤백</a></li><li><a href=#5-변경사유-기록>5. 변경사유 기록</a></li></ul></li><li><a href=#rollout-재시작>rollout 재시작</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><h1 id=개요 class="relative group">개요 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b0%9c%ec%9a%94 aria-label=Anchor>#</a></span></h1><p>minikube 기반의 쿠버네티스 환경에서 deployment를 생성하고 제어하는 실습을 한다.</p><br><h1 id=환경 class="relative group">환경 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%99%98%ea%b2%bd aria-label=Anchor>#</a></span></h1><ul><li><strong>Hardware</strong> : macBook Pro (13", M1, 2020)</li><li><strong>OS</strong> : macOS Monterey 12.0.1</li><li><strong>minikube v1.24.0</strong> + <strong>docker desktop v4.1.1</strong></li><li><strong>kubectl stable v1.22.3</strong></li></ul><br><h1 id=본문 class="relative group">본문 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%b3%b8%eb%ac%b8 aria-label=Anchor>#</a></span></h1><p>해당 과정은 minikube가 구축된 이후 시점부터 진행된다. 반드시 minikube를 구성한 상태에서 이 실습을 진행해야만 한다.</p><br><h2 id=deployment-생성 class="relative group">deployment 생성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#deployment-%ec%83%9d%ec%84%b1 aria-label=Anchor>#</a></span></h2><ul><li>deployment는 애플리케이션을 배포하고 업데이트하기 위한 리소스이다.</li><li>실제 pod들은 deployment가 아닌 replicaset에 의해 생성, 관리된다.</li><li>deployment를 생성하면 replicaset 리소스가 그 아래에 자동생성된다.</li></ul><p><figure><img class="my-0 rounded-md" src=./1.png alt></figure></p><ul><li>pod를 감시하는 replicaset이 deployment를 지원하는 구조이다.</li></ul><ul><li>현업에서 deployment는 배포 업데이트에 주로 쓰인다. (e.g. 블루-그린 업데이트, 롤링 업데이트, 카나리 업데이트)</li></ul><h3 id=1-yaml-작성 class="relative group">1. yaml 작성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-yaml-%ec%9e%91%ec%84%b1 aria-label=Anchor>#</a></span></h3><p>nginx pod를 3대 배포하는 Deployment의 yaml 파일을 작성한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>$ vi nginx-deploy.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment           </span><span class=w> </span><span class=c># 타입은 Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>               </span><span class=c># 3개의 Pod를 유지한다.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>                 </span><span class=c># Deployment에 속하는 Pod의 조건</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>            </span><span class=c># label의 app 속성의 값이 nginx 인 Pod를 찾아라.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app: nginx          # labels 필드를 사용해서 app</span><span class=p>:</span><span class=w> </span><span class=l>nginx 레이블을 붙힘</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>           </span><span class=c># container에 대한 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx        </span><span class=w> </span><span class=c># container의 이름</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.7.9 </span><span class=w> </span><span class=c># Docker Hub에 업로드된 nginx:1.7.9 이미지를 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></div><p>해당 yaml 코드를 복사 붙여넣기 해서 작성한다.</p><br><h3 id=2-생성 class="relative group">2. 생성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%ec%83%9d%ec%84%b1 aria-label=Anchor>#</a></span></h3><p>작성한 <code>nginx-deploy.yaml</code> 파일을 기반으로 deployment를 생성한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl apply -f nginx-deploy.yaml
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment created
</span></span></code></pre></div><br><h3 id=3-확인 class="relative group">3. 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h3><p><strong>간단한 포맷으로 출력</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get all
</span></span><span class=line><span class=cl>NAME                                    READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-5jfwj   1/1     Running   <span class=m>0</span>          3m51s
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-djrms   1/1     Running   <span class=m>0</span>          90s
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-vkkqp   1/1     Running   <span class=m>0</span>          2m5s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>   AGE
</span></span><span class=line><span class=cl>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   4h34m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment   3/3     <span class=m>3</span>            <span class=m>3</span>           9m34s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                          DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/nginx-deployment-5d59d67564   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       9m34s
</span></span></code></pre></div><p>deployment는 pod 템플릿의 각 버전마다 하나씩 여러 개의 replicaset을 생성한다. pod 템플릿의 해시값을 사용하면 deployment에서 지정된 버전의 pod 템플릿에 관해 항상 동일한(기존의) replicaset을 사용할 수 있다.</p><br><p><strong>자세한 포맷으로 출력</strong></p><p><code>-o wide</code> 옵션을 붙이면 더 자세한 정보를 출력준다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get all -o wide
</span></span><span class=line><span class=cl>NAME                                    READY   STATUS    RESTARTS   AGE     IP           NODE       NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-5jfwj   1/1     Running   <span class=m>0</span>          5m37s   172.17.0.6   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-djrms   1/1     Running   <span class=m>0</span>          3m16s   172.17.0.7   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-vkkqp   1/1     Running   <span class=m>0</span>          3m51s   172.17.0.5   minikube   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>   AGE     SELECTOR
</span></span><span class=line><span class=cl>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   4h36m   &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES        SELECTOR
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment   3/3     <span class=m>3</span>            <span class=m>3</span>           11m   nginx        nginx:1.7.9   <span class=nv>app</span><span class=o>=</span>nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                          DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES        SELECTOR
</span></span><span class=line><span class=cl>replicaset.apps/nginx-deployment-5d59d67564   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       11m   nginx        nginx:1.7.9   <span class=nv>app</span><span class=o>=</span>nginx,pod-template-hash<span class=o>=</span>5d59d67564
</span></span></code></pre></div><br><h3 id=4-pod-재생성-테스트 class="relative group">4. pod 재생성 테스트 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-pod-%ec%9e%ac%ec%83%9d%ec%84%b1-%ed%85%8c%ec%8a%a4%ed%8a%b8 aria-label=Anchor>#</a></span></h3><p>Deployment와 연관된 replicaset은 pod의 개수를 유지하는 역할을 수행한다. pod 1개를 삭제해서 인위적으로 pod 개수를 줄여보자.</p><pre tabindex=0><code>kubectl delete pod nginx-deployment-5d59d67564-djrms
pod &#34;nginx-deployment-5d59d67564-djrms&#34; deleted
</code></pre><p><code>djrms</code> pod를 삭제했다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get all
</span></span><span class=line><span class=cl>NAME                                    READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-5jfwj   1/1     Running   <span class=m>0</span>          8m10s
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-82rvt   1/1     Running   <span class=m>0</span>          88s
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-vkkqp   1/1     Running   <span class=m>0</span>          6m24s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>   AGE
</span></span><span class=line><span class=cl>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   4h38m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment   3/3     <span class=m>3</span>            <span class=m>3</span>           13m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                          DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/nginx-deployment-5d59d67564   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       13m
</span></span></code></pre></div><p><code>djrms</code> pod를 삭제하면 replicaset은 지정된 pod 개수(3개)를 유지하기 위해 <code>82rvt</code> pod를 자동생성한다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl describe pod nginx-deployment-5d59d67564-82rvt <span class=p>|</span> grep -i controlled
</span></span><span class=line><span class=cl>Controlled By:  ReplicaSet/nginx-deployment-5d59d67564
</span></span></code></pre></div><p><code>82rvt</code> pod를 관리하는 컨트롤러는 <code>nginx-deployment-5d59d67564</code> replicaset임을 확인할 수 있다.</p><br><h2 id=롤링-업데이트 class="relative group">롤링 업데이트 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%a1%a4%eb%a7%81-%ec%97%85%eb%8d%b0%ec%9d%b4%ed%8a%b8 aria-label=Anchor>#</a></span></h2><h3 id=1-롤링-업데이트-실행 class="relative group">1. 롤링 업데이트 실행 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%eb%a1%a4%eb%a7%81-%ec%97%85%eb%8d%b0%ec%9d%b4%ed%8a%b8-%ec%8b%a4%ed%96%89 aria-label=Anchor>#</a></span></h3><p><strong>명령어 형식</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl <span class=nb>set</span> image deployment/&lt;deployment 이름&gt; &lt;container 이름&gt;<span class=o>=</span>&lt;이미지 이름&gt;:&lt;이미지 버전&gt;
</span></span></code></pre></div><p><strong>실제 명령어 예시</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl <span class=nb>set</span> image deployment/nginx-deployment <span class=nv>nginx</span><span class=o>=</span>nginx:1.9.1
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment image updated
</span></span></code></pre></div><p>nginx-deployment에 설정된 nginx 1.7.9 버전의 이미지가 1.9.1 버전의 nginx 이미지로 업데이트 되었다.</p><br><h3 id=2-결과확인 class="relative group">2. 결과확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%ea%b2%b0%ea%b3%bc%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get all
</span></span><span class=line><span class=cl>NAME                                    READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/nginx-deployment-69c44dfb78-d97k5   1/1     Running   <span class=m>0</span>          10s
</span></span><span class=line><span class=cl>pod/nginx-deployment-69c44dfb78-kqqk4   1/1     Running   <span class=m>0</span>          9s
</span></span><span class=line><span class=cl>pod/nginx-deployment-69c44dfb78-kv6ms   1/1     Running   <span class=m>0</span>          11s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>   AGE
</span></span><span class=line><span class=cl>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   5h11m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment   3/3     <span class=m>3</span>            <span class=m>3</span>           35s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                          DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/nginx-deployment-5d59d67564   <span class=m>0</span>         <span class=m>0</span>         <span class=m>0</span>       35s
</span></span><span class=line><span class=cl>replicaset.apps/nginx-deployment-69c44dfb78   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       11s
</span></span></code></pre></div><p>기존의 replicaset은 비활성화되고, 새로운 replicaset인 <code>69c44dfb78</code>이 등장했다. 새 replicaset은 3대의 pod를 유지하고 있다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl describe deploy
</span></span><span class=line><span class=cl>Name:                   nginx-deployment
</span></span><span class=line><span class=cl>Namespace:              default
</span></span><span class=line><span class=cl>CreationTimestamp:      Wed, <span class=m>10</span> Nov <span class=m>2021</span> 00:23:05 +0900
</span></span><span class=line><span class=cl>Labels:                 <span class=nv>app</span><span class=o>=</span>nginx
</span></span><span class=line><span class=cl>Annotations:            deployment.kubernetes.io/revision: <span class=m>2</span>
</span></span><span class=line><span class=cl>Selector:               <span class=nv>app</span><span class=o>=</span>nginx
</span></span><span class=line><span class=cl>Replicas:               <span class=m>3</span> desired <span class=p>|</span> <span class=m>3</span> updated <span class=p>|</span> <span class=m>3</span> total <span class=p>|</span> <span class=m>3</span> available <span class=p>|</span> <span class=m>0</span> unavailable
</span></span><span class=line><span class=cl>StrategyType:           RollingUpdate
</span></span><span class=line><span class=cl>MinReadySeconds:        <span class=m>0</span>
</span></span><span class=line><span class=cl>RollingUpdateStrategy:  25% max unavailable, 25% max surge
</span></span><span class=line><span class=cl>Pod Template:
</span></span><span class=line><span class=cl>  Labels:  <span class=nv>app</span><span class=o>=</span>nginx
</span></span><span class=line><span class=cl>  Containers:
</span></span><span class=line><span class=cl>   nginx:
</span></span><span class=line><span class=cl>    Image:        nginx:1.9.1
</span></span></code></pre></div><p><strong>주요 확인사항</strong></p><ul><li>컨테이너의 이미지(<code>Image:</code>) 값이 <code>nginx:1.9.1</code>로 변경된 것을 확인.</li><li>변경 회수(<code>revision</code>) 값이 1에서 2로 증가했다. 즉 1번 deployment의 변경사항이 발생했다는 점이다.</li></ul><br><h3 id=3-변경기록-확인 class="relative group">3. 변경기록 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-%eb%b3%80%ea%b2%bd%ea%b8%b0%eb%a1%9d-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h3><p><strong>명령어 형식</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl rollout <span class=nb>history</span> deployment &lt;deployment 이름&gt;
</span></span></code></pre></div><p><strong>실제 명령어</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl rollout <span class=nb>history</span> deployment nginx-deployment
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment
</span></span><span class=line><span class=cl>REVISION  CHANGE-CAUSE
</span></span><span class=line><span class=cl><span class=m>1</span>         &lt;none&gt;
</span></span><span class=line><span class=cl><span class=m>2</span>         &lt;none&gt;
</span></span></code></pre></div><p>최초에 revision 1에서 시작한다. 변경사유(<code>CHANGE-CAUSE</code>) 값은 지정해주지 않았기 때문에 <code>&lt;none></code>으로 출력된다.</p><br><h3 id=4-롤백 class="relative group">4. 롤백 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-%eb%a1%a4%eb%b0%b1 aria-label=Anchor>#</a></span></h3><p>롤링 업데이트 중에 문제가 발생했을 경우, 롤링 업데이트 실행 전으로 즉시 되돌릴 수 있다.</p><br><p><strong>명령어 형식</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl rollout undo deployment &lt;deployment 이름&gt; --to-revision<span class=o>=</span>&lt;숫자&gt;
</span></span></code></pre></div><br><p><strong>실제 명령어</strong></p><p>deployment를 최초 버전(revision 1)으로 돌린다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl rollout undo deployment nginx-deployment --to-revision<span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment rolled back
</span></span></code></pre></div><br><p><strong>롤백 후 상태확인</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get all
</span></span><span class=line><span class=cl>NAME                                    READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-24cll   1/1     Running   <span class=m>0</span>          51s
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-9kgp8   1/1     Running   <span class=m>0</span>          52s
</span></span><span class=line><span class=cl>pod/nginx-deployment-5d59d67564-dvv8n   1/1     Running   <span class=m>0</span>          50s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>   AGE
</span></span><span class=line><span class=cl>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   5h23m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment   3/3     <span class=m>3</span>            <span class=m>3</span>           12m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                          DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/nginx-deployment-5d59d67564   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       12m
</span></span><span class=line><span class=cl>replicaset.apps/nginx-deployment-69c44dfb78   <span class=m>0</span>         <span class=m>0</span>         <span class=m>0</span>       12m
</span></span></code></pre></div><p>nginx 이미지 버전을 1.9.1로 업그레이드 하면서 사용하지 않았던 <code>5d59d67564</code> replicaset이 다시 pod 관리를 넘겨 받았다.</p><p>여기서 가장 중요한 것은 pod 3대도 기존 pod가 아니라 새로 생성(교체)된 pod라는 사실이다.</p><br><p><strong>deployment 상세정보 확인</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl describe deploy
</span></span><span class=line><span class=cl>Name:                   nginx-deployment
</span></span><span class=line><span class=cl>Namespace:              default
</span></span><span class=line><span class=cl>CreationTimestamp:      Wed, <span class=m>10</span> Nov <span class=m>2021</span> 00:23:05 +0900
</span></span><span class=line><span class=cl>Labels:                 <span class=nv>app</span><span class=o>=</span>nginx
</span></span><span class=line><span class=cl>Annotations:            deployment.kubernetes.io/revision: <span class=m>3</span>
</span></span><span class=line><span class=cl>Selector:               <span class=nv>app</span><span class=o>=</span>nginx
</span></span><span class=line><span class=cl>Replicas:               <span class=m>3</span> desired <span class=p>|</span> <span class=m>3</span> updated <span class=p>|</span> <span class=m>3</span> total <span class=p>|</span> <span class=m>3</span> available <span class=p>|</span> <span class=m>0</span> unavailable
</span></span><span class=line><span class=cl>StrategyType:           RollingUpdate
</span></span><span class=line><span class=cl>MinReadySeconds:        <span class=m>0</span>
</span></span><span class=line><span class=cl>RollingUpdateStrategy:  25% max unavailable, 25% max surge
</span></span><span class=line><span class=cl>Pod Template:
</span></span><span class=line><span class=cl>  Labels:  <span class=nv>app</span><span class=o>=</span>nginx
</span></span><span class=line><span class=cl>  Containers:
</span></span><span class=line><span class=cl>   nginx:
</span></span><span class=line><span class=cl>    Image:        nginx:1.7.9
</span></span></code></pre></div><p><code>Image:</code> 값이 <code>nginx:1.9.1</code>에서 <code>nginx:1.7.9</code>로 rollback 되었다. revision 값도 +1 되어 <code>3</code>이다.</p><br><h3 id=5-변경사유-기록 class="relative group">5. 변경사유 기록 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-%eb%b3%80%ea%b2%bd%ec%82%ac%ec%9c%a0-%ea%b8%b0%eb%a1%9d aria-label=Anchor>#</a></span></h3><p><strong>방법1. Annotation 수정</strong></p><p>Annotation은 Label처럼 키:값 쌍으로 이루어져 있으며, 쿠버네티스 시스템이 필요한 정보들을 담고 있다. Annotation은 쿠버네티스 클라이언트나 라이브러리가 활용하는데 사용된다.</p><br><p><strong>명령어 형식</strong></p><p><code>change-cause</code>에 값을 부여해 수정하는 방식이다. <u>annotation을 수정하는 방식이 현업에서 더 권장되고 안전하다.</u></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl annotate deployment.v1.apps/&lt;deployment 이름&gt; kubernetes.io/change-cause<span class=o>=</span><span class=s2>&#34;&lt;변경사유&gt;&#34;</span>
</span></span></code></pre></div><p><strong>실행 명령어</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl annotate deployment.v1.apps/nginx-deployment kubernetes.io/change-cause<span class=o>=</span><span class=s2>&#34;test update V2&#34;</span>
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment annotated
</span></span></code></pre></div><p><code>nginx-deployment</code>의 <code>change-cause</code> 값이 변경되었다.</p><br><p><strong>변경결과 확인</strong></p><p>describe로 nginx-deployment의 상세정보를 확인해본다. 2번째 Annotation인 <code>change-cause: test update V2</code> 생성되어 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl describe deploy nginx-deployment
</span></span><span class=line><span class=cl>Name:                   nginx-deployment
</span></span><span class=line><span class=cl>Namespace:              default
</span></span><span class=line><span class=cl>CreationTimestamp:      Wed, <span class=m>10</span> Nov <span class=m>2021</span> 18:54:18 +0900
</span></span><span class=line><span class=cl>Labels:                 <span class=nv>app</span><span class=o>=</span>nginx
</span></span><span class=line><span class=cl>Annotations:            deployment.kubernetes.io/revision: <span class=m>1</span>
</span></span><span class=line><span class=cl>                        kubernetes.io/change-cause: <span class=nb>test</span> update V2
</span></span></code></pre></div><br><p>롤링 업데이트 기록도 확인해본다. <code>change-cause</code> annotation의 값과 동일하게 적혀있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl rollout <span class=nb>history</span> deployment nginx-deployment
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment
</span></span><span class=line><span class=cl>REVISION  CHANGE-CAUSE
</span></span><span class=line><span class=cl><span class=m>1</span>         <span class=nb>test</span> update V2
</span></span></code></pre></div><br><p><strong>방법2. 직접 수정</strong></p><p>deployment의 설정이 담긴 manifest 파일을 직접 수정한다. 이 방식은 위험하므로 annotation을 수정하는 방식을 추천한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl edit deployment nginx-deployment
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment edited
</span></span></code></pre></div><p>rollout의 변경사유 기록을 위해 nginx-deployment의 설정파일을 연다.</p><br><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Please edit the object below. Lines beginning with a &#39;#&#39; will be ignored,</span>
</span></span><span class=line><span class=cl><span class=c1># and an empty file will abort the edit. If an error occurs while saving this file will be</span>
</span></span><span class=line><span class=cl><span class=c1># reopened with the relevant failures.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>apiVersion: apps/v1
</span></span><span class=line><span class=cl>kind: Deployment
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  annotations:
</span></span><span class=line><span class=cl>    deployment.kubernetes.io/revision: <span class=s2>&#34;3&#34;</span>
</span></span><span class=line><span class=cl>    kubectl.kubernetes.io/last-applied-configuration: <span class=p>|</span>
</span></span><span class=line><span class=cl>      <span class=o>{</span><span class=s2>&#34;apiVersion&#34;</span>:<span class=s2>&#34;apps/v1&#34;</span>,<span class=s2>&#34;kind&#34;</span>:<span class=s2>&#34;Deployment&#34;</span>,<span class=s2>&#34;metadata&#34;</span>:<span class=o>{</span><span class=s2>&#34;annotations&#34;</span>:<span class=o>{}</span>,<span class=s2>&#34;labels&#34;</span>:<span class=o>{</span><span class=s2>&#34;app&#34;</span>:<span class=s2>&#34;nginx&#34;</span><span class=o>}</span>,<span class=s2>&#34;name&#34;</span>:<span class=s2>&#34;nginx-deployment&#34;</span>,<span class=s2>&#34;namespace&#34;</span>:<span class=s2>&#34;default&#34;</span><span class=o>}</span>,<span class=s2>&#34;spec&#34;</span>:<span class=o>{</span><span class=s2>&#34;replicas&#34;</span>:3,<span class=s2>&#34;selector&#34;</span>:<span class=o>{</span><span class=s2>&#34;matchLabels&#34;</span>:<span class=o>{</span><span class=s2>&#34;app&#34;</span>:<span class=s2>&#34;nginx&#34;</span><span class=o>}}</span>,<span class=s2>&#34;template&#34;</span>:<span class=o>{</span><span class=s2>&#34;metadata&#34;</span>:<span class=o>{</span><span class=s2>&#34;labels&#34;</span>:<span class=o>{</span><span class=s2>&#34;app&#34;</span>:<span class=s2>&#34;nginx&#34;</span><span class=o>}}</span>,<span class=s2>&#34;spec&#34;</span>:<span class=o>{</span><span class=s2>&#34;containers&#34;</span>:<span class=o>[{</span><span class=s2>&#34;image&#34;</span>:<span class=s2>&#34;nginx:1.7.9&#34;</span>,<span class=s2>&#34;name&#34;</span>:<span class=s2>&#34;nginx&#34;</span>,<span class=s2>&#34;ports&#34;</span>:<span class=o>[{</span><span class=s2>&#34;containerPort&#34;</span>:80<span class=o>}]}]}}}}</span>
</span></span><span class=line><span class=cl>    kubernetes.io/change-cause: nginx:1.7.9
</span></span><span class=line><span class=cl>  creationTimestamp: <span class=s2>&#34;2021-11-09T15:23:05Z&#34;</span>
</span></span><span class=line><span class=cl>  generation: <span class=m>5</span>
</span></span></code></pre></div><p><code>annotations</code> 아랫줄에 <code>kubernets.io/change-cause: &lt;사유></code>를 추가 입력해준다. manifest 파일을 수정 후 저장하면 즉시 적용되니 주의하자.</p><br><p>rollout 기록을 다시 조회해본다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl rollout <span class=nb>history</span> deployment nginx-deployment
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment
</span></span><span class=line><span class=cl>REVISION  CHANGE-CAUSE
</span></span><span class=line><span class=cl><span class=m>2</span>         &lt;none&gt;
</span></span><span class=line><span class=cl><span class=m>3</span>         nginx:1.7.9
</span></span></code></pre></div><p><code>annotations</code>에 입력한 <code>nginx:1.7.9</code> 가 그대로 출력된다.</p><br><h2 id=rollout-재시작 class="relative group">rollout 재시작 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rollout-%ec%9e%ac%ec%8b%9c%ec%9e%91 aria-label=Anchor>#</a></span></h2><p>deployment에 속한 전체 pod를 재시작하는 방법</p><br><p><strong>명령어 형식</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl rollout restart deployment/&lt;deployment 이름&gt;
</span></span></code></pre></div><p><strong>실행 명령어</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl rollout restart deployment/nginx-deployment
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment restarted
</span></span></code></pre></div><p><code>nginx-deployment</code>가 재시작되었다.</p><br><p><strong>pod, replicaset 상태 확인</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get all
</span></span><span class=line><span class=cl>NAME                                    READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/nginx-deployment-5468f7bfc5-cpd95   1/1     Running   <span class=m>0</span>          5s
</span></span><span class=line><span class=cl>pod/nginx-deployment-5468f7bfc5-ds7sm   1/1     Running   <span class=m>0</span>          4s
</span></span><span class=line><span class=cl>pod/nginx-deployment-5468f7bfc5-x6jjq   1/1     Running   <span class=m>0</span>          3s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>   AGE
</span></span><span class=line><span class=cl>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   6h8m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment   3/3     <span class=m>3</span>            <span class=m>3</span>           57m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                          DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/nginx-deployment-5468f7bfc5   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       5s
</span></span><span class=line><span class=cl>replicaset.apps/nginx-deployment-5d59d67564   <span class=m>0</span>         <span class=m>0</span>         <span class=m>0</span>       57m
</span></span><span class=line><span class=cl>replicaset.apps/nginx-deployment-69c44dfb78   <span class=m>0</span>         <span class=m>0</span>         <span class=m>0</span>       56m
</span></span></code></pre></div><p>새 replicaset인 <code>5468f7bfc5</code>가 생성되고, 새로운 pod 3대도 함께 생성된다.</p><br><p><strong>rollout 기록 확인</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl rollout <span class=nb>history</span> deployment nginx-deployment
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment
</span></span><span class=line><span class=cl>REVISION  CHANGE-CAUSE
</span></span><span class=line><span class=cl><span class=m>2</span>         &lt;none&gt;
</span></span><span class=line><span class=cl><span class=m>3</span>         nginx:1.7.9
</span></span><span class=line><span class=cl><span class=m>4</span>         nginx:1.7.9
</span></span></code></pre></div><p>rollout 재시작을 실행하면서 revision 3에서 4로 변경되었다. 새로 생성된 revision 4의 <code>CHANGE-CAUSE</code> 값은 revision 3과 동일하게 가져온다.</p></div></section><footer class="pt-8 max-w-prose print:hidden"><script src=https://utteranc.es/client.js repo=seyslee/seyslee.github.io issue-term=pathname label=blog-comment theme=github-dark crossorigin=anonymous async></script></footer></article><div class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-[-5.5rem]"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Younsung Lee</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div></div></footer></body></html>