<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>minikube 멀티노드 구성 &#183; seyslee</title><meta name=title content="minikube 멀티노드 구성 &#183; seyslee"><meta name=description content="seyslee"><link rel=canonical href=https://seyslee.github.io/blog/k8s/multinode-in-minikube/><link type=text/css rel=stylesheet href=/css/main.bundle.min.b48975bbd6c4fb86531cbdd0c02019dd556591de76cb3cd4b65f99408610039504f2f978a70784ae9adde42ca5df40cdbccfea526ba2f1562efcca9d67ee73a1.css integrity="sha512-tIl1u9bE+4ZTHL3QwCAZ3VVlkd52yzzUtl+ZQIYQA5UE8vl4pweErprd5Cyl30DNvM/qUmui8VYu/MqdZ+5zoQ=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9947db70e5b36e741e53f8531bd734741b3fc7a688f7b5d749fc5433c48efc252f47bdf44e471570a550fc051b87712799014040e6349b38d64448b94e84e45a.js integrity="sha512-mUfbcOWzbnQeU/hTG9c0dBs/x6aI97XXSfxUM8SO/CUvR730TkcVcKVQ/AUbh3EnmQFAQOY0mzjWREi5ToTkWg==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="minikube 멀티노드 구성"><meta property="og:description" content="minikube를 이용해 3대의 노드를 생성해서 Kubernetes 클러스터 구성하는 방법을 설명한다."><meta property="og:type" content="article"><meta property="og:url" content="https://seyslee.github.io/blog/k8s/multinode-in-minikube/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-11-10T15:46:40+09:00"><meta property="article:modified_time" content="2021-11-10T15:46:40+09:00"><meta property="og:site_name" content="seyslee"><meta name=twitter:card content="summary"><meta name=twitter:title content="minikube 멀티노드 구성"><meta name=twitter:description content="minikube를 이용해 3대의 노드를 생성해서 Kubernetes 클러스터 구성하는 방법을 설명한다."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blogs","name":"minikube 멀티노드 구성","headline":"minikube 멀티노드 구성","description":"minikube를 이용해 3대의 노드를 생성해서 Kubernetes 클러스터 구성하는 방법을 설명한다.","abstract":"개요 # minikube를 이용해 3대의 노드(1 master node \u002b 2 worker node)를 생성해서 Kubernetes 클러스터 구성하는 방법을 설명합니다.","inLanguage":"en","url":"https:\/\/seyslee.github.io\/blog\/k8s\/multinode-in-minikube\/","author":{"@type":"Person","name":"Younsung Lee"},"copyrightYear":"2021","dateCreated":"2021-11-10T15:46:40\u002b09:00","datePublished":"2021-11-10T15:46:40\u002b09:00","dateModified":"2021-11-10T15:46:40\u002b09:00","keywords":["devops","kubernetes"],"mainEntityOfPage":"true","wordCount":"1098"}]</script><meta name=author content="Younsung Lee"><link href=mailto:ivecloudblack@gmail.com rel=me><link href=https://github.com/seyslee rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>seyslee</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/blog/ title=Blogs>post</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>tag</a></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">minikube 멀티노드 구성</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2021-11-10 15:46:40 +0900 +0900">Nov 10, 2021</time></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#개요>개요</a></li><li><a href=#환경>환경</a></li><li><a href=#전제조건>전제조건</a></li><li><a href=#실습하기>실습하기</a><ul><li><a href=#1-멀티노드-생성>1. 멀티노드 생성</a></li><li><a href=#2-노드-상태-확인>2. 노드 상태 확인</a></li><li><a href=#3-deployment-배포>3. deployment 배포</a></li><li><a href=#4-service-배포>4. service 배포</a></li><li><a href=#5-접속-테스트>5. 접속 테스트</a></li></ul></li><li><a href=#실습환경-정리>실습환경 정리</a><ul><li><a href=#방법-1-minikube-종료>방법 1. minikube 종료</a></li><li><a href=#방법-2-minikube-삭제>방법 2. minikube 삭제</a></li></ul></li><li><a href=#마치며>마치며</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><h2 id=개요 class="relative group">개요 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ea%b0%9c%ec%9a%94 aria-label=Anchor>#</a></span></h2><p>minikube를 이용해 3대의 노드(1 master node + 2 worker node)를 생성해서 Kubernetes 클러스터 구성하는 방법을 설명합니다.</p><p><figure><img class="my-0 rounded-md" src=./1.png alt="Kubernetes cluster architecture"></figure></p><p> </p><h2 id=환경 class="relative group">환경 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ed%99%98%ea%b2%bd aria-label=Anchor>#</a></span></h2><ul><li><strong>Hardware</strong> : macBook Pro (16", M1 Pro, 2021)</li><li><strong>OS</strong> : macOS Monterey 12.4</li><li><strong>minikube v1.26.0</strong></li><li><strong>Docker Desktop 4.8.2 (79419)</strong></li></ul><p>노드 3대를 생성할 예정이기 때문에 하드웨어의 메모리 리소스가 최소 8GB 이상은 되어야 안정적으로 실습할 수 있습니다.</p><p> </p><h2 id=전제조건 class="relative group">전제조건 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%a0%84%ec%a0%9c%ec%a1%b0%ea%b1%b4 aria-label=Anchor>#</a></span></h2><ul><li><p>minikube가 설치되어 있어야 합니다.</p></li><li><p>docker desktop이 설치되어 있어야 합니다.</p></li><li><p>kubectl이 설치되어 있어야 합니다.</p></li></ul><p>이 글에서는 필수 패키지 설치에 대한 가이드는 다루지 않습니다.</p><p> </p><h2 id=실습하기 class="relative group">실습하기 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%8b%a4%ec%8a%b5%ed%95%98%ea%b8%b0 aria-label=Anchor>#</a></span></h2><h3 id=1-멀티노드-생성 class="relative group">1. 멀티노드 생성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-%eb%a9%80%ed%8b%b0%eb%85%b8%eb%93%9c-%ec%83%9d%ec%84%b1 aria-label=Anchor>#</a></span></h3><p>3대의 노드로 구성된 minikube 클러스터를 생성합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube start <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--driver<span class=o>=</span><span class=s1>&#39;docker&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--profile<span class=o>=</span><span class=s1>&#39;multinode-lab&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--cni<span class=o>=</span><span class=s1>&#39;calico&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--kubernetes-version<span class=o>=</span><span class=s1>&#39;stable&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--nodes<span class=o>=</span><span class=m>3</span>
</span></span></code></pre></div><h4 id=명령어-옵션-설명 class="relative group">명령어 옵션 설명 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%aa%85%eb%a0%b9%ec%96%b4-%ec%98%b5%ec%85%98-%ec%84%a4%eb%aa%85 aria-label=Anchor>#</a></span></h4><p><code>--driver='docker'</code> : 도커를 하이퍼바이저로 사용합니다.<br><code>--profile='multinode-lab'</code> : <code>multinode-lab</code>이라는 이름의 프로파일을 생성합니다.<br><code>--cni='calico</code> : 컨테이너 네트워크 인터페이스를 <code>calico</code>로 지정합니다.</p><ul><li>auto, bridge, calico, cilium, flannel, kindnet 중 하나를 선택할 수 있습니다.</li></ul><p><code>--kubernetes-version='stable'</code> : 노드에 설치되는 쿠버네티스 버전을 안정화된 버전으로 지정합니다.<br><code>--nodes=3</code> : 노드 3대로 구성된 클러스터를 생성합니다.</p><p> </p><h3 id=2-노드-상태-확인 class="relative group">2. 노드 상태 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-%eb%85%b8%eb%93%9c-%ec%83%81%ed%83%9c-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h3><h4 id=minikube class="relative group">minikube <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#minikube aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube status -p multinode-lab
</span></span><span class=line><span class=cl>multinode-lab
</span></span><span class=line><span class=cl>type: Control Plane
</span></span><span class=line><span class=cl>host: Running
</span></span><span class=line><span class=cl>kubelet: Running
</span></span><span class=line><span class=cl>apiserver: Running
</span></span><span class=line><span class=cl>kubeconfig: Configured
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>multinode-lab-m02
</span></span><span class=line><span class=cl>type: Worker
</span></span><span class=line><span class=cl>host: Running
</span></span><span class=line><span class=cl>kubelet: Running
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>multinode-lab-m03
</span></span><span class=line><span class=cl>type: Worker
</span></span><span class=line><span class=cl>host: Running
</span></span><span class=line><span class=cl>kubelet: Running
</span></span></code></pre></div><p>3대의 노드가 모두 정상 실행중(<code>Running</code>)이다. <code>type:</code> 값을 보면 해당 노드가 Master node(Control plane)인지 Worker node인지 구분할 수 있습니다.</p><p> </p><h4 id=kubectl class="relative group">kubectl <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#kubectl aria-label=Anchor>#</a></span></h4><p><code>kubectl</code> 명령어를 사용해서도 쿠버네티스 클러스터 노드의 상태를 확인할 수 있습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get node
</span></span><span class=line><span class=cl>NAME                STATUS   ROLES           AGE   VERSION
</span></span><span class=line><span class=cl>multinode-lab       Ready    control-plane   37m   v1.24.1
</span></span><span class=line><span class=cl>multinode-lab-m02   Ready    &lt;none&gt;          36m   v1.24.1
</span></span><span class=line><span class=cl>multinode-lab-m03   Ready    &lt;none&gt;          36m   v1.24.1
</span></span></code></pre></div><p>컨트롤 플레인 1대와 워커노드 2대로 구성된 걸 확인할 수 있습니다.<br>전체 노드에는 2022년 6월 기준으로 안정화 버전인 kubernetes <code>v1.24.1</code>이 설치되었습니다.</p><p> </p><h3 id=3-deployment-배포 class="relative group">3. deployment 배포 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-deployment-%eb%b0%b0%ed%8f%ac aria-label=Anchor>#</a></span></h3><h4 id=deployment-yaml-작성 class="relative group">deployment yaml 작성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#deployment-yaml-%ec%9e%91%ec%84%b1 aria-label=Anchor>#</a></span></h4><p>현재 경로에 <code>nginx-deploy.yaml</code> 파일을 생성합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>$ cat &lt;&lt;EOF &gt;&gt; ./nginx-deploy.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment           </span><span class=w> </span><span class=c># 타입은 Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>               </span><span class=c># 3개의 Pod를 유지한다.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>                 </span><span class=c># Deployment에 속하는 Pod의 조건</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>            </span><span class=c># label의 app 속성의 값이 nginx 인 Pod를 찾아라.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app: nginx          # labels 필드를 사용해서 app</span><span class=p>:</span><span class=w> </span><span class=l>nginx 레이블을 붙힘</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>           </span><span class=c># container에 대한 정의</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx        </span><span class=w> </span><span class=c># container의 이름</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.7.9 </span><span class=w> </span><span class=c># Docker Hub에 업로드된 nginx:1.7.9 이미지를 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>EOF</span><span class=w>
</span></span></span></code></pre></div><p>매니페스트 내용을 간단하게 요약하자면 3개의 nginx 파드를 배포하는 deployment입니다.</p><p><figure><img class="my-0 rounded-md" src=./2.png alt="Deployment, replicaset and pods"></figure></p><p> </p><h4 id=deployment-배포 class="relative group">deployment 배포 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#deployment-%eb%b0%b0%ed%8f%ac aria-label=Anchor>#</a></span></h4><p>작성한 yaml 파일을 사용해서 deployment를 배포합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl apply -f nginx-deploy.yaml
</span></span><span class=line><span class=cl>deployment.apps/nginx-deployment created
</span></span></code></pre></div><p> </p><h4 id=상태확인 class="relative group">상태확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%83%81%ed%83%9c%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h4><p>nginx 파드 상태를 확인합니다.<br>3개의 nginx 파드가 생성되고 있습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get pod
</span></span><span class=line><span class=cl>NAME                                READY   STATUS              RESTARTS   AGE
</span></span><span class=line><span class=cl>nginx-deployment-84df99548d-csxnp   0/1     ContainerCreating   <span class=m>0</span>          8s
</span></span><span class=line><span class=cl>nginx-deployment-84df99548d-fmnx9   0/1     ContainerCreating   <span class=m>0</span>          8s
</span></span><span class=line><span class=cl>nginx-deployment-84df99548d-nsmsf   0/1     ContainerCreating   <span class=m>0</span>          8s
</span></span></code></pre></div><p> </p><p>잠시 기다리면 상태가 <code>Running</code>으로 바뀌며 pod 생성이 완료됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get pod -o wide
</span></span><span class=line><span class=cl>NAME                                READY   STATUS    RESTARTS   AGE     IP               NODE                NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>nginx-deployment-84df99548d-csxnp   1/1     Running   <span class=m>0</span>          2m19s   10.244.150.129   multinode-lab-m02   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>nginx-deployment-84df99548d-fmnx9   1/1     Running   <span class=m>0</span>          2m19s   10.244.166.195   multinode-lab       &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>nginx-deployment-84df99548d-nsmsf   1/1     Running   <span class=m>0</span>          2m19s   10.244.148.65    multinode-lab-m03   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>여기서 중요한 사실은 여러 노드에 걸쳐 3대의 파드가 배포된다는 사실입니다.<br><code>NODE</code> 컬럼을 보면 파드가 어디 노드에 배포되었는지 확인할 수 있습니다.</p><p> </p><p>현재 이 실습환경은 Control Plane이 NoSchedule 상태가 아니라서, Control Plane인 <code>multinode-lab</code> 노드에도 파드가 1개 배포되었습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get node
</span></span><span class=line><span class=cl>NAME                STATUS   ROLES           AGE   VERSION
</span></span><span class=line><span class=cl>multinode-lab       Ready    control-plane   12m   v1.24.1
</span></span><span class=line><span class=cl>multinode-lab-m02   Ready    &lt;none&gt;          12m   v1.24.1
</span></span><span class=line><span class=cl>multinode-lab-m03   Ready    &lt;none&gt;          11m   v1.24.1
</span></span></code></pre></div><p> </p><h3 id=4-service-배포 class="relative group">4. service 배포 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-service-%eb%b0%b0%ed%8f%ac aria-label=Anchor>#</a></span></h3><p>파드에서 실행중인 nginx 웹을 외부에 노출시키려면 service 리소스가 필요합니다.</p><h4 id=service-yaml-작성 class="relative group">service yaml 작성 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#service-yaml-%ec%9e%91%ec%84%b1 aria-label=Anchor>#</a></span></h4><p>service를 생성하기 위해 매니페스트를 작성합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>$ cat &lt;&lt;EOF &gt;&gt; ./nginx-service.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># nodePort is Optional field</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># By default and for convenience,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># the Kubernetes control plane will allocate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># a port from a range (default: 30000-32767)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>EOF</span><span class=w>
</span></span></span></code></pre></div><p> </p><h4 id=service-배포 class="relative group">service 배포 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#service-%eb%b0%b0%ed%8f%ac aria-label=Anchor>#</a></span></h4><p>작성한 yaml 파일을 사용해서 service를 배포합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl apply -f nginx-service.yaml
</span></span><span class=line><span class=cl>service/nginx-service created
</span></span></code></pre></div><p> </p><p>nginx-service가 생성되었습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get service
</span></span><span class=line><span class=cl>NAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>        AGE
</span></span><span class=line><span class=cl>kubernetes      ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        23m
</span></span><span class=line><span class=cl>nginx-service   NodePort    10.107.245.50   &lt;none&gt;        80:30080/TCP   2m16s
</span></span></code></pre></div><p>현재 nginx 파드는 nginx-service를 통해 외부 사용자에게 노출된 상태입니다.</p><p> </p><h3 id=5-접속-테스트 class="relative group">5. 접속 테스트 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-%ec%a0%91%ec%86%8d-%ed%85%8c%ec%8a%a4%ed%8a%b8 aria-label=Anchor>#</a></span></h3><p><code>minikube</code>로 접속 가능한 서비스 목록을 확인합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube service list <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--profile multinode-lab
</span></span><span class=line><span class=cl><span class=p>|</span>-------------<span class=p>|</span>---------------<span class=p>|</span>--------------<span class=p>|</span>-----<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>  NAMESPACE  <span class=p>|</span>     NAME      <span class=p>|</span> TARGET PORT  <span class=p>|</span> URL <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>-------------<span class=p>|</span>---------------<span class=p>|</span>--------------<span class=p>|</span>-----<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> default     <span class=p>|</span> kubernetes    <span class=p>|</span> No node port <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> default     <span class=p>|</span> nginx-service <span class=p>|</span>           <span class=m>80</span> <span class=p>|</span>     <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> kube-system <span class=p>|</span> kube-dns      <span class=p>|</span> No node port <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>-------------<span class=p>|</span>---------------<span class=p>|</span>--------------<span class=p>|</span>-----<span class=p>|</span>
</span></span></code></pre></div><p><code>nginx-service</code>는 <code>default</code> 네임스페이스에 있으며 nginx 파드의 <code>80</code> 포트로 연결됩니다.</p><p> </p><p>minikube의 터널링 기능을 통해 로컬 환경에서 <code>nginx-service</code>로 접속합니다.<br><code>nginx-service</code>는 외부에서 들어온 사용자를 nginx 파드의 80 포트로 연결해줍니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube service nginx-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--profile multinode-lab
</span></span></code></pre></div><p>정상 실행된 결과는 다음과 같이 출력됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=p>|</span>-----------<span class=p>|</span>---------------<span class=p>|</span>-------------<span class=p>|</span>---------------------------<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> NAMESPACE <span class=p>|</span>     NAME      <span class=p>|</span> TARGET PORT <span class=p>|</span>            URL            <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>-----------<span class=p>|</span>---------------<span class=p>|</span>-------------<span class=p>|</span>---------------------------<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> default   <span class=p>|</span> nginx-service <span class=p>|</span>          <span class=m>80</span> <span class=p>|</span> http://192.168.58.2:30080 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>-----------<span class=p>|</span>---------------<span class=p>|</span>-------------<span class=p>|</span>---------------------------<span class=p>|</span>
</span></span><span class=line><span class=cl>🏃  nginx-service 서비스의 터널을 시작하는 중
</span></span><span class=line><span class=cl><span class=p>|</span>-----------<span class=p>|</span>---------------<span class=p>|</span>-------------<span class=p>|</span>------------------------<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> NAMESPACE <span class=p>|</span>     NAME      <span class=p>|</span> TARGET PORT <span class=p>|</span>          URL           <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>-----------<span class=p>|</span>---------------<span class=p>|</span>-------------<span class=p>|</span>------------------------<span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> default   <span class=p>|</span> nginx-service <span class=p>|</span>             <span class=p>|</span> http://127.0.0.1:56757 <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span>-----------<span class=p>|</span>---------------<span class=p>|</span>-------------<span class=p>|</span>------------------------<span class=p>|</span>
</span></span><span class=line><span class=cl>🎉  Opening service default/nginx-service in default browser...
</span></span><span class=line><span class=cl>❗  Because you are using a Docker driver on darwin, the terminal needs to be open to run it.
</span></span></code></pre></div><p> </p><p>명령어가 실행된 후 자동으로 기본 브라우저가 열리며 nginx 파드에 접속됩니다.</p><p><figure><img class="my-0 rounded-md" src=./3.png alt="nginx index page"></figure></p><p> </p><h2 id=실습환경-정리 class="relative group">실습환경 정리 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%ec%8b%a4%ec%8a%b5%ed%99%98%ea%b2%bd-%ec%a0%95%eb%a6%ac aria-label=Anchor>#</a></span></h2><h3 id=방법-1-minikube-종료 class="relative group">방법 1. minikube 종료 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%b0%a9%eb%b2%95-1-minikube-%ec%a2%85%eb%a3%8c aria-label=Anchor>#</a></span></h3><p>minikube는 실습환경의 CPU, 메모리 리소스를 많이 점유합니다.<br>minikube 클러스터를 계속 켜놓는 건 하드웨어에 부담이 많이 가고 배터리 소모도 심하기 때문에 minikube 실습이 끝난 후에는 반드시 종료 또는 삭제해줍니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube stop -p multinode-lab
</span></span><span class=line><span class=cl>✋  Stopping node <span class=s2>&#34;multinode-lab&#34;</span>  ...
</span></span><span class=line><span class=cl>🛑  Powering off <span class=s2>&#34;multinode-lab&#34;</span> via SSH ...
</span></span><span class=line><span class=cl>✋  Stopping node <span class=s2>&#34;multinode-lab-m02&#34;</span>  ...
</span></span><span class=line><span class=cl>🛑  Powering off <span class=s2>&#34;multinode-lab-m02&#34;</span> via SSH ...
</span></span><span class=line><span class=cl>✋  Stopping node <span class=s2>&#34;multinode-lab-m03&#34;</span>  ...
</span></span><span class=line><span class=cl>🛑  Powering off <span class=s2>&#34;multinode-lab-m03&#34;</span> via SSH ...
</span></span><span class=line><span class=cl>🛑  <span class=m>3</span> nodes stopped.
</span></span></code></pre></div><p>모든 노드가 종료되었습니다.</p><p> </p><h4 id=노드상태-확인 class="relative group">노드상태 확인 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%85%b8%eb%93%9c%ec%83%81%ed%83%9c-%ed%99%95%ec%9d%b8 aria-label=Anchor>#</a></span></h4><p><code>minikube</code> 명령어로 노드 3대의 상태를 확인해봅니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube status -p multinode-lab
</span></span><span class=line><span class=cl>multinode-lab
</span></span><span class=line><span class=cl>type: Control Plane
</span></span><span class=line><span class=cl>host: Stopped
</span></span><span class=line><span class=cl>kubelet: Stopped
</span></span><span class=line><span class=cl>apiserver: Stopped
</span></span><span class=line><span class=cl>kubeconfig: Stopped
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>multinode-lab-m02
</span></span><span class=line><span class=cl>type: Worker
</span></span><span class=line><span class=cl>host: Stopped
</span></span><span class=line><span class=cl>kubelet: Stopped
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>multinode-lab-m03
</span></span><span class=line><span class=cl>type: Worker
</span></span><span class=line><span class=cl>host: Stopped
</span></span><span class=line><span class=cl>kubelet: Stopped
</span></span></code></pre></div><p><code>multinode-lab</code>, <code>multinode-lab-m02</code>, <code>multinode-lab-m03</code> 노드가 모두 정상 종료(<code>Stopped</code>)되었습니다.</p><p>이전에 생성한 리소스는 남아있기 때문에 다시 클러스터를 시작하면 그대로 실습 환경을 이어서 사용할 수 있습니다.</p><p> </p><h3 id=방법-2-minikube-삭제 class="relative group">방법 2. minikube 삭제 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%b0%a9%eb%b2%95-2-minikube-%ec%82%ad%ec%a0%9c aria-label=Anchor>#</a></span></h3><p>minikube 클러스터를 더 이상 사용할 필요가 없을 경우, 클러스터의 모든 노드와 리소스를 삭제하면 됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube delete --profile<span class=o>=</span><span class=s1>&#39;multinode-lab&#39;</span>
</span></span></code></pre></div><p>삭제가 정상적으로 완료되었을 경우 메세지는 다음과 같이 표시됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>🔥  docker 의 <span class=s2>&#34;multinode-lab&#34;</span> 를 삭제하는 중 ...
</span></span><span class=line><span class=cl>🔥  /Users/steve/.minikube/machines/multinode-lab 제거 중 ...
</span></span><span class=line><span class=cl>🔥  /Users/steve/.minikube/machines/multinode-lab-m02 제거 중 ...
</span></span><span class=line><span class=cl>🔥  /Users/steve/.minikube/machines/multinode-lab-m03 제거 중 ...
</span></span><span class=line><span class=cl>💀  <span class=s2>&#34;multinode-lab&#34;</span> 클러스터 관련 정보가 모두 삭제되었습니다
</span></span><span class=line><span class=cl>🔥  모든 프로필이 성공적으로 삭제되었습니다
</span></span></code></pre></div><p> </p><p>minikube의 전체 프로파일 리스트를 확인합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ minikube profile list
</span></span></code></pre></div><p>3대의 노드로 구성했던 <code>multinode-lab</code> 프로파일이 삭제된 걸 확인할 수 있습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>🤹  Exiting due to MK_USAGE_NO_PROFILE: No minikube profile was found.
</span></span><span class=line><span class=cl>💡  권장:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    You can create one using <span class=s1>&#39;minikube start&#39;</span>.
</span></span></code></pre></div><p> </p><h2 id=마치며 class="relative group">마치며 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%eb%a7%88%ec%b9%98%eb%a9%b0 aria-label=Anchor>#</a></span></h2><p>지금까지 <code>minikube</code>로 멀티노드를 구성하고 서비스를 배포해보는 실습을 진행해보았습니다.<br>끝까지 읽어주셔서 감사합니다.</p></div></section><footer class="pt-8 max-w-prose print:hidden"><script src=https://utteranc.es/client.js repo=seyslee/seyslee.github.io issue-term=pathname label=blog-comment theme=github-dark crossorigin=anonymous async></script></footer></article></main><footer class="py-10 print:hidden"><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Younsung Lee</p></div></div></footer></div></body></html>